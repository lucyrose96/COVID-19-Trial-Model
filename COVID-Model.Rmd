---
title: "COVID-19 clinical trial model code"
output:  html_document
date: 28/07/2021
---

```{r setup, echo=FALSE, message=FALSE}
library(ggplot2)
library(ggpubr)
library(knitr)
library(kableExtra)
library(dplyr)
library(beepr)
library(rateratio.test)
library(ratesci)
library(foreach)
library(doParallel)
set.seed(23)
```


# 1. Description of model

This model replicates a COVID-19 vaccine trial scenario. It allows for asymptomatic and symptomatic infection, heterogeneity in risk of symptoms, naturally- and vaccine-acquired immunity against infection and disease, and waning immunity. It also allows for evaluation of different testing strategies on estimates of vaccine efficacy (VE); the influence of imperfect test sensitivity and specificity, and changes in test sensitivity over time since infection.

All vaccinated participants start in the Vaccinated compartment (V), while unvaccinated participants start in Susceptible (S). All participants are assumed to be seronegative at baseline.

Participants in V and S can be infected, and move into IAns (infected asymptomatically, never symptomatic) or IS (infected symptomatically) if they have an asymptomatic or a symptomatic infection respectively. Vaccinated participants are assumed to have a lower probability of infection if the vaccine is effective against infection, and/or a lower probability of symptoms given infection, if the vaccine is effective against progression to symptomatic disease.

When participants recover from infection, they are assumed to simultaneously develop antibodies. Time to develop antibodies is estimated at 16 days from infection. This is given by an erlang distribution where $k = 12$ and $u = 0.724$. Participants can be reinfected in the recovered compartments, but at a lower rate than if susceptible. They are also assumed to have a lower risk of developing symptoms, upon infection. Risk of reinfection can be set to be lower for participants who have experienced symptomatic or asymptomatic disease (but currently assuming the same). 

If participants are not infected in the R compartment, they will eventually wane into a waned compartment (W), at a constant rate. We assume that these participants have the same immunity as those in an R compartment, so R->W only corresponds to waning of antibodies, not immunity.

The asymptomatic compartment sequence (I->R->W) is split in two, to participants who have previously experienced symptomatic infection and those who have not. This is necessary for the calculation of the primary outcome, but the parameter estimates do not differ between asymptomatic participants who have experienced symptomatic disease before and those who have not.

Once a vaccinated participant is infected, they are assumed to not benefit from any immunity provided by the vaccine, so their risk of infection is no longer reduced by their vaccination status.

For simplicity, the simulation starts from 15 days after the second dose of vaccine/placebo, when the immune response to the vaccine is assumed to have been stimulated. 

**Layers**

This basic model structure is replicated to give 8 layers, by the:

- Vaccination status (unvaccinated/vaccinated)
- Serology detection status (detected/not detected with serology)
- PCR detection status (detected/not detected asymptomatic infection with PCR)
  - (Specifically PCR detected *asymptomatic* infection because we assume all symptomatic infections are detected, so we can track which participants have had a PCR-detected symptomatic infection (all in IS/RS/WS/IAps/RAps/WAps). By making the PCR-detected layer separate by PCR-detected asymptomatic infection, we will know which participants 1. have had a PCR-detected asym infection, 2. have had a PCR-detected sym infection, 3. have had a PCR detected infection overall.)
  
It is also possible to stratify by age group. Each age category is given by a different position in a vector, or by the column in a matrix. The default model has one age category.

All participants stay in the same vaccinated/unvaccinated group and age group throughout the trial. Participants can move from serology-undetected to serology-detected at the end of a time interval, if they are detected as a true positive or a false positive seroconversion (more details on this below). Participants can also move from PCR-undetected to PCR-detected if they have a true asymptomatic infection detected with PCR, or they have a false positive (also more detail later).

**Risk of SARS-cov-2 infection**

We assume that hazard of exposure to SARS-cov-2 infection depends on vaccination status and whether the participant has experienced a natural infection before. Participants in V's risk of infection is reduced by the vaccine efficacy against infection ($1-VEin$). For participants in R, risk of reinfection is reduced by the level of immunity provided by infection ($si_R$ and $ai_R$ (symptomatic and asymptomatic)), and participants in W, by the level of immunity provided by infection, when antibodies have waned ($si_W$ and $ai_W$). We assume no dependence on risk of reinfection on presence/absence of symptoms in first infection, and no reduction in immunity upon waning of antibodies. Therefore si_R = ai_R = si_W = ai_W.

**Risk of COVID-19 disease**

Upon infection, a patient may experience either asymptomatic or symptomatic disease. The probability of each outcome is assumed to be dependent on vaccination status and whether the participant has experienced a natural infection before (and age if modeling different age categories). Therefore participants in a V, R or W compartment have a reduced risk of symptoms, given infection.

- V: P(symptoms|infection) = $(1-pa)\text{(1-VEdi)}$
- R: P(symptoms|infection) = $(1-pa)(ss_R)$ or $(1-pa)(as_R)$
- W: P(symptoms|infection) = $(1-pa})(ss_W)$ or $(1-pa)(as_W)$

where $(pa_{j})$ denotes probability of asymptomatic infection, VEdi is VE against progression to symptoms, ss_R and as_R are the relative hazard of symptoms, given infection, in the recovered compartments (after symptomatic and asymptomatic infection respectively), and ss_W and as_W are the relative hazard of symptoms, given infection, in the waned compartments. We assume no dependence on risk of symptoms in second infection on presence/absence of symptoms in first infection. Therefore ss_R = as_R = ss_W = as_W.

**Detection of asymptomatic infection**

**Weekly PCR testing**

Weekly PCR swabbing is incorporated into the model by applying a probability of PCR-detection for each asymptomatic infection (= 0.833). Those that are detected move to the asymptomatic PCR detected layer. Those that are not stay in the undetected layer. False positives are modeled by applying a constant risk of false positive, with a daily probability of (1-specificty)/7 (because tests are done once every 7 days). If a participant gets a false positive, they also move to the asymptomatic PCR detected layer. 

We assume that all symptomatic infections are detected (symptomatic PCR sensitivity = 100%) and that no false positives are occur in symptomatic participants that do not have COVID (symptomatic PCR specificity = 100%). Therefore PCR-estimated VE_sym = true observed VE_sym.

**Serology testing**

The probability of being detected with serology testing is incorporated into the model structure. When a participant recovers from infection (->R), they are assumed to also develop antibodies and therefore become detectable by serology testing. Time to seroconversion is assumed to be described by an erlang distribution with k=12 and rate = 0.724, which gives a mean of 16 days (fitted to data from Long et al (2020)). 

Imperfect serology test sensitivity can be modeled in two ways, but option 1 was used in the paper:
1- All participants seroconvert, 100% I->R but at the end of each time intervals the serology test detects only a proportion of the participants who are seropositive
2- A proportion of participants seroconvert, but the serology test detects 100% of seropositives at each time intervals.

When participants' immunity wanes they move to the waned immunity compartment (R->W), their antibodies are also assumed to have waned and therefore to have become undetectable to serology tests. 

Participants who recover and are then reinfected (in R) do not move back to the infected compartment because they are assumed to retain antibodies. Participants who recover, wane and are then reinfected (in W) move to the I compartment but start in the 7th box. This gives a shorter time to recovery/production of detectable antibodies, to reflect immune memory. Time to seroconversion for participants reinfected from W is therefore described by an erlang distribution with k=5 and rate = 0.724. This gives a mean of 4.3 days post infection to seroconversion, and 91% have seroconverted by day 7.

Participants who are in compartments S/V/IAns/WAns and recieve a false positive (FP) test are recorded as an asymptomatic FP. Participants who are in compartments IS/WS/IAps/WAps and recieve a false positive (FP) test are recorded as a symptomatic FP.

# 2. Model Code

Model code is split into parts A-K, by what each section does.

General notation:

- State variables: U_nser_npcr_X notation where U/V =(Un)Vaccinated, nser/yser = detected by serology yes/no, npcr/ypcr = asymptomatic infection detected by PCR, X = compartment in model (see Fig. 1)
- Incidence variables: inc_U_nser_npcr_X notation, where inc = incidence of infection / sym = symptomatic infection / asym = asymptomatic infection / ypcr = yes detected with pcr / npcr = not detected with pcr / rec = recovery from infection / rec.ab = recovered and developed antibodies / wan = waned / lea = leave compartment / fp = false positive / fpinc = false positive or infected / ser = seroconversion
- Cumulative incidence variables: cum_inc_U_nser_npcr_X. These are kept in a vector with one vector position for each time interval. This allows for the results to be given as incidence or cumulative incidence. 


```{r model code, echo=F}

model_run<-function(Lam=0.2/365, VEin=0.5, VEdi=0.5, n=30000, ai.r=0.16, si.r=0.16, ai.w=0.16, si.w=0.16, as.r=0.35, ss.r=0.35, as.w=0.35, ss.w=0.35, wn.a=0.0003023851, wn.s=0.0003023851, wv=0, s.specificity = 0.9984, pcr.specificity=0.99945, p.antibod.asym=1, p.antibod.sym=1, s.sens.sym = 0.95, s.sens.asym = 0.8, pa=0.33, rec.asym=1, rec=0.724,  asym.pcr.prob=0.8335, prop.a=1, days_between_pcr=7, timeintervals.end=c(30,60, 183, 365, 730), timeintervals.start=c(0,30,60, 183, 365) ){
  
  #Details on adjustable parameters
  #Lam=0.2/365 (FOI: 20% chance being infected over 1 year), VEin=0.5, VEdi=0.5 (VE against infection and progression to symptoms), n=30000 (sample size), ai.r=0.16, si.r=0.16, ai.w=0.16, si.w=0.16 (natural immunity in R and W compartments, after asymp or symp infections), wn.a=0.0003023851, wn.s=0.0003023851 (rate of waning R->W), wv=0 (rate of waning of vaccine-induced immunity), s.specificity = 0.9984 (serology specificity), pcr.specificity=0.99945 (PCR specificity), p.antibod.asym=0.95, p.antibod.sym=0.95 (probability of producing detectable antibodies, asym and sym. Option 2 for serology sensitivity, = 1 for option 1), s.sens.sym = 0.95, s.sens.asym = 0.8 (serology test sensitivity, proportion of those in R who are detected, option 1 for serology sensitivity), rec = 0.724 (probability of leaving an I compartment per day), rec.asym=1 (relative probability of leaving an I compartment per day in asym relative to sym (0.5 = double time to seroconversion). 1 = same for sym and asym), asym.pcr.prob = 0.833 (probability of an asymptomatic infection being detected with weekly testing, after 4 tests. This is averaged over when those tests are taken over the course of infection), prop.a=1 (proportion in each age category, 1=no stratification. Vector that sums to 1=stratification), days_between_pcr (days between PCR tests, can be modified as a proxy for adherence).
  
  #Note pa, prop.a, VEin and VEdi must all be vectors of equal length when modeling multiple age categories. Each vector position gives the value for a different age category. To model 1 age category, just put one value for each, and set prop.a to 1.
  
#### Part A) Set fixed parameters ####
  
  rho=1 #proportion s-ve. Now only modelling baseline-seronegatives, but can be adjusted to explore boosting
  pv<- 1/2  #proportion in vaccine group. 
  time=0 #start at 0 days
  pers_years<- (timeintervals.end-timeintervals.start)/365 #person years in each time interval
  dt<-1  #time step (days)
  ncat = length(prop.a)#number of age categories = length of proportion-in-age-categories vector
  n.inf.com<- 12 #number of infected compartments (k=12 gave best fit to data for erlang distribution, time from infection)

    #precalcs
  p.inf<-dt*Lam #daily probability of infection 
  pcr_test_freq= (1*dt)/days_between_pcr #frequency of testing in days (weekly)
  p.fp<- (1-pcr.specificity)*pcr_test_freq #daily probability of false positive  

  #competing hazards calcs
 
    #V (wane/infected/false positive)
  p.leave.v<-wv*dt + (p.inf*(1-VEin)) + p.fp #probability of leaving the V compartment 
  p.fp.inc.v<-(p.inf*(1-VEin)) + p.fp #probability of  leaving the V compartment because of a false positive or being infected
    #S (infected/false positive)
  p.leave.s<- p.inf + p.fp
    #R (wane/infected/false positive)
  p.leave.ra<-wn.a*dt + (p.inf*ai.r) + p.fp 
  p.leave.rs<-wn.s*dt + (p.inf*si.r) + p.fp 
  
  p.fp.inc.ra<- (p.inf*ai.r) + p.fp 
  p.fp.inc.rs<- (p.inf*si.r) + p.fp 
  
    #W (infected/false positive)
  p.leave.wa<-(p.inf*ai.w) + p.fp
  p.leave.ws<-(p.inf*si.w) + p.fp

  #setup results table (nrow = number of time intervals, ncol = number of results)
  res<-array(NA,dim = c(length(timeintervals.end),110)) #incidence results
  res2<-array(NA,dim = c(length(timeintervals.end),110)) #cumulative incidence results

  j<-1 #index for results row (1 for each time interval)

#### Part B) initialise state variables ####

    #U_nser_npcr_X notation where U/V =(Un)Vaccinated, nser/yser = detected by serology yes/no, npcr/ypcr = asymptomatic infection detected PCR, X = compartment in model (see Fig. 1). 
    #Non-I compartments = array with 1 row, and columns determined by the number of age categories. Position in array gives the age category.
    #I compartments = matrix with rows determined by number of I compartments (n.inf.com) giving the best fit with an erlang distribution 
    #All vaccinated participants start in V_nser_npcr_V (vaccinated, not serology or pcr detected, V box), unvaccinated participants start in U_nser_npcr_S (susceptible, not serology or pcr detected, S box).
  
    #Vaccinated, not serology-detected, not pcr-detected
    V_nser_npcr_V<-     round(n*pv*rho*prop.a)  
    V_nser_npcr_IAns<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)#create a 5 by 12 matrix filled with 0's. Ncol = number of age categories. Nrow = number of infected compartments
    V_nser_npcr_RAns<-  rep(0, ncat)
    V_nser_npcr_WAns<-  rep(0, ncat)
    V_nser_npcr_S<-     rep(0, ncat)
    V_nser_npcr_IS<-    matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    V_nser_npcr_RS<-    rep(0, ncat)
    V_nser_npcr_WS<-    rep(0, ncat)
    V_nser_npcr_IAps<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    V_nser_npcr_RAps<-  rep(0, ncat)
    V_nser_npcr_WAps<-  rep(0, ncat)
    
    #Vaccinated, not serology-detected, yes pcr-detected
    V_nser_ypcr_V<-     rep(0, ncat)
    V_nser_ypcr_IAns<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    V_nser_ypcr_RAns<-  rep(0, ncat)
    V_nser_ypcr_WAns<-  rep(0, ncat)
    V_nser_ypcr_S<-     rep(0, ncat)
    V_nser_ypcr_IS<-    matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    V_nser_ypcr_RS<-    rep(0, ncat)
    V_nser_ypcr_WS<-    rep(0, ncat)
    V_nser_ypcr_IAps<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    V_nser_ypcr_RAps<-  rep(0, ncat)
    V_nser_ypcr_WAps<-  rep(0, ncat)

    #Vaccinated, yes serology-detected, not pcr-detected
    V_yser_npcr_V<-     rep(0, ncat)
    V_yser_npcr_IAns<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    V_yser_npcr_RAns<-  rep(0, ncat)
    V_yser_npcr_WAns<-  rep(0, ncat)
    V_yser_npcr_S<-     rep(0, ncat)
    V_yser_npcr_IS<-    matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    V_yser_npcr_RS<-    rep(0, ncat)
    V_yser_npcr_WS<-    rep(0, ncat)
    V_yser_npcr_IAps<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    V_yser_npcr_RAps<-  rep(0, ncat)
    V_yser_npcr_WAps<-  rep(0, ncat)
    
    #Vaccinated, yes serology-detected, yes pcr-detected
    V_yser_ypcr_V<-     rep(0, ncat)
    V_yser_ypcr_IAns<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    V_yser_ypcr_RAns<-  rep(0, ncat)
    V_yser_ypcr_WAns<-  rep(0, ncat)
    V_yser_ypcr_S<-     rep(0, ncat)
    V_yser_ypcr_IS<-    matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    V_yser_ypcr_RS<-    rep(0, ncat)
    V_yser_ypcr_WS<-    rep(0, ncat)
    V_yser_ypcr_IAps<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    V_yser_ypcr_RAps<-  rep(0, ncat)
    V_yser_ypcr_WAps<-  rep(0, ncat)

    #Unvaccinated, not serology-detected, not pcr-detected
    U_nser_npcr_IAns<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_nser_npcr_RAns<-  rep(0, ncat)
    U_nser_npcr_WAns<-  rep(0, ncat)
    U_nser_npcr_S<-     round(n*(1-pv)*rho*prop.a)
    U_nser_npcr_IS<-    matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_nser_npcr_RS<-    rep(0, ncat)
    U_nser_npcr_WS<-    rep(0, ncat)
    U_nser_npcr_IAps<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_nser_npcr_RAps<-  rep(0, ncat)
    U_nser_npcr_WAps<-  rep(0, ncat)
    
    #Unvaccinated, not serology-detected, yes pcr-detected
    U_nser_ypcr_IAns<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_nser_ypcr_RAns<-  rep(0, ncat)
    U_nser_ypcr_WAns<-  rep(0, ncat)
    U_nser_ypcr_S<-     rep(0, ncat)
    U_nser_ypcr_IS<-    matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_nser_ypcr_RS<-    rep(0, ncat)
    U_nser_ypcr_WS<-    rep(0, ncat)
    U_nser_ypcr_IAps<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_nser_ypcr_RAps<-  rep(0, ncat)
    U_nser_ypcr_WAps<-  rep(0, ncat)

    #Unvaccinated, yes serology-detected, not pcr-detected
    U_yser_npcr_IAns<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_yser_npcr_RAns<-  rep(0, ncat)
    U_yser_npcr_WAns<-  rep(0, ncat)
    U_yser_npcr_S<-     rep(0, ncat)
    U_yser_npcr_IS<-    matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_yser_npcr_RS<-    rep(0, ncat)
    U_yser_npcr_WS<-    rep(0, ncat)
    U_yser_npcr_IAps<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_yser_npcr_RAps<-  rep(0, ncat)
    U_yser_npcr_WAps<-  rep(0, ncat)
    
    #Unvaccinated, yes serology-detected, yes pcr-detected
    U_yser_ypcr_IAns<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_yser_ypcr_RAns<-  rep(0, ncat)
    U_yser_ypcr_WAns<-  rep(0, ncat)
    U_yser_ypcr_S<-     rep(0, ncat)
    U_yser_ypcr_IS<-    matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_yser_ypcr_RS<-    rep(0, ncat)
    U_yser_ypcr_WS<-    rep(0, ncat)
    U_yser_ypcr_IAps<-  matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    U_yser_ypcr_RAps<-  rep(0, ncat)
    U_yser_ypcr_WAps<-  rep(0, ncat)



#### Part C) Zero cumulative incidence variables, person-time and seroconversion variables ####
    
  #Vectors with length of the number of time intervals
    
    #Cumulative incidences
cum_sym_U_first<-cum_sym_V_first<-first_sym_U<-first_sym_V<-cum_inf_U_first<-cum_inf_V_first<-first_inf_U<-first_inf_V<-cum_asym_U_first<-cum_asym_V_first<-first_asym_U<-first_asym_V<-cum_asym_U_first2<-cum_asym_V_first2<-cum_sym_U_first2<-cum_sym_V_first2<-cum_pcr_inf_U_first<-cum_pcr_inf_V_first<-first_pcr_U<-first_pcr_V<-cum_pcr_asym_U_first<-cum_pcr_asym_V_first<-first_pcr_asym_U<-first_pcr_asym_V<-cum_pcr_asym_U_first2<-cum_pcr_asym_V_first2<-cum_inf_U<-cum_inf_V<-cum_sym_U<-cum_sym_V<-cum_asym_U<-cum_asym_V<-rep(0, length(timeintervals.end))
    #Person-times
    first_sym_pt_V<-first_sym_pt_U<-first_inf_pt_V<-first_inf_pt_U<-first_asym_pt_V<-first_asym_pt_U<-first_inf_PCR_pt_V<-first_inf_PCR_pt_U<-first_asym_PCR_pt_V<-first_asym_PCR_pt_U<-rep(0, length(timeintervals.end))
    #Seroconversion cumulative incidences
    cum_asym_U_ser<-cum_asym_V_ser<-cum_sym_U_ser<-cum_sym_V_ser<-cum_inf_U_ser<-cum_inf_V_ser<-sero.prop_U<-sero.prop_V<-sero.prop.sym_U<-sero.prop.sym_V<-sero.prop.asym_U<-sero.prop.asym_V<-rep(0, length(timeintervals.end))
    
  #Matrices with nrow = time intervals, ncol = age categories
    
    #Seroconversions
      #True positives
    ser_V_nser_npcr_RAns<-ser_V_nser_npcr_RS<-ser_V_nser_npcr_RAps<-ser_V_nser_ypcr_RAns<-ser_V_nser_ypcr_RS<-ser_V_nser_ypcr_RAps<-ser_U_nser_npcr_RAns<-ser_U_nser_npcr_RS<-ser_U_nser_npcr_RAps<-ser_U_nser_ypcr_RAns<-
ser_U_nser_ypcr_RS<-ser_U_nser_ypcr_RAps<-matrix(rep(0, ncat*length(timeintervals.end)), length(timeintervals.end), ncat)

      #False positives
    ser_V_nser_npcr_V<-ser_V_nser_npcr_IAns1<-ser_V_nser_npcr_IAns2<-ser_V_nser_npcr_IAns3<-ser_V_nser_npcr_IAns4<-ser_V_nser_npcr_IAns5<-ser_V_nser_npcr_IAns6<-ser_V_nser_npcr_IAns7<-ser_V_nser_npcr_IAns8<-ser_V_nser_npcr_IAns9<-ser_V_nser_npcr_IAns10<-ser_V_nser_npcr_IAns11<-ser_V_nser_npcr_IAns12<-ser_V_nser_npcr_WAns<-ser_V_nser_npcr_S<-ser_V_nser_npcr_IS1<-ser_V_nser_npcr_IS2<-ser_V_nser_npcr_IS3<-ser_V_nser_npcr_IS4<-ser_V_nser_npcr_IS5<-ser_V_nser_npcr_IS6<-ser_V_nser_npcr_IS7<-ser_V_nser_npcr_IS8<-ser_V_nser_npcr_IS9<-ser_V_nser_npcr_IS10<-ser_V_nser_npcr_IS11<-ser_V_nser_npcr_IS12<-ser_V_nser_npcr_WS<-ser_V_nser_npcr_IAps1<-ser_V_nser_npcr_IAps2<-ser_V_nser_npcr_IAps3<-ser_V_nser_npcr_IAps4<-ser_V_nser_npcr_IAps5<-ser_V_nser_npcr_IAps6<-ser_V_nser_npcr_IAps7<-ser_V_nser_npcr_IAps8<-ser_V_nser_npcr_IAps9<-ser_V_nser_npcr_IAps10<-ser_V_nser_npcr_IAps11<-ser_V_nser_npcr_IAps12<-ser_V_nser_npcr_WAps<-matrix(rep(0, ncat*length(timeintervals.end)), length(timeintervals.end), ncat)#V_npcr
    ser_V_nser_ypcr_V<-ser_V_nser_ypcr_IAns1<-ser_V_nser_ypcr_IAns2<-ser_V_nser_ypcr_IAns3<-ser_V_nser_ypcr_IAns4<-ser_V_nser_ypcr_IAns5<-ser_V_nser_ypcr_IAns6<-ser_V_nser_ypcr_IAns7<-ser_V_nser_ypcr_IAns8<-ser_V_nser_ypcr_IAns9<-ser_V_nser_ypcr_IAns10<-ser_V_nser_ypcr_IAns11<-ser_V_nser_ypcr_IAns12<-ser_V_nser_ypcr_WAns<-ser_V_nser_ypcr_S<-ser_V_nser_ypcr_IS1<-ser_V_nser_ypcr_IS2<-ser_V_nser_ypcr_IS3<-ser_V_nser_ypcr_IS4<-ser_V_nser_ypcr_IS5<-ser_V_nser_ypcr_IS6<-ser_V_nser_ypcr_IS7<-ser_V_nser_ypcr_IS8<-ser_V_nser_ypcr_IS9<-ser_V_nser_ypcr_IS10<-ser_V_nser_ypcr_IS11<-ser_V_nser_ypcr_IS12<-ser_V_nser_ypcr_WS<-ser_V_nser_ypcr_IAps1<-ser_V_nser_ypcr_IAps2<-ser_V_nser_ypcr_IAps3<-ser_V_nser_ypcr_IAps4<-ser_V_nser_ypcr_IAps5<-ser_V_nser_ypcr_IAps6<-ser_V_nser_ypcr_IAps7<-ser_V_nser_ypcr_IAps8<-ser_V_nser_ypcr_IAps9<-ser_V_nser_ypcr_IAps10<-ser_V_nser_ypcr_IAps11<-ser_V_nser_ypcr_IAps12<-ser_V_nser_ypcr_WAps<-matrix(rep(0, ncat*length(timeintervals.end)), length(timeintervals.end), ncat)#V_ypcr
    ser_U_nser_npcr_V<-ser_U_nser_npcr_IAns1<-ser_U_nser_npcr_IAns2<-ser_U_nser_npcr_IAns3<-ser_U_nser_npcr_IAns4<-ser_U_nser_npcr_IAns5<-ser_U_nser_npcr_IAns6<-ser_U_nser_npcr_IAns7<-ser_U_nser_npcr_IAns8<-ser_U_nser_npcr_IAns9<-ser_U_nser_npcr_IAns10<-ser_U_nser_npcr_IAns11<-ser_U_nser_npcr_IAns12<-ser_U_nser_npcr_WAns<-ser_U_nser_npcr_S<-ser_U_nser_npcr_IS1<-ser_U_nser_npcr_IS2<-ser_U_nser_npcr_IS3<-ser_U_nser_npcr_IS4<-ser_U_nser_npcr_IS5<-ser_U_nser_npcr_IS6<-ser_U_nser_npcr_IS7<-ser_U_nser_npcr_IS8<-ser_U_nser_npcr_IS9<-ser_U_nser_npcr_IS10<-ser_U_nser_npcr_IS11<-ser_U_nser_npcr_IS12<-ser_U_nser_npcr_WS<-ser_U_nser_npcr_IAps1<-ser_U_nser_npcr_IAps2<-ser_U_nser_npcr_IAps3<-ser_U_nser_npcr_IAps4<-ser_U_nser_npcr_IAps5<-ser_U_nser_npcr_IAps6<-ser_U_nser_npcr_IAps7<-ser_U_nser_npcr_IAps8<-ser_U_nser_npcr_IAps9<-ser_U_nser_npcr_IAps10<-ser_U_nser_npcr_IAps11<-ser_U_nser_npcr_IAps12<-ser_U_nser_npcr_WAps<-matrix(rep(0, ncat*length(timeintervals.end)), length(timeintervals.end), ncat)#U_npcr
    ser_U_nser_ypcr_V<-ser_U_nser_ypcr_IAns1<-ser_U_nser_ypcr_IAns2<-ser_U_nser_ypcr_IAns3<-ser_U_nser_ypcr_IAns4<-ser_U_nser_ypcr_IAns5<-ser_U_nser_ypcr_IAns6<-ser_U_nser_ypcr_IAns7<-ser_U_nser_ypcr_IAns8<-ser_U_nser_ypcr_IAns9<-ser_U_nser_ypcr_IAns10<-ser_U_nser_ypcr_IAns11<-ser_U_nser_ypcr_IAns12<-ser_U_nser_ypcr_WAns<-ser_U_nser_ypcr_S<-ser_U_nser_ypcr_IS1<-ser_U_nser_ypcr_IS2<-ser_U_nser_ypcr_IS3<-ser_U_nser_ypcr_IS4<-ser_U_nser_ypcr_IS5<-ser_U_nser_ypcr_IS6<-ser_U_nser_ypcr_IS7<-ser_U_nser_ypcr_IS8<-ser_U_nser_ypcr_IS9<-ser_U_nser_ypcr_IS10<-ser_U_nser_ypcr_IS11<-ser_U_nser_ypcr_IS12<-ser_U_nser_ypcr_WS<-ser_U_nser_ypcr_IAps1<-ser_U_nser_ypcr_IAps2<-ser_U_nser_ypcr_IAps3<-ser_U_nser_ypcr_IAps4<-ser_U_nser_ypcr_IAps5<-ser_U_nser_ypcr_IAps6<-ser_U_nser_ypcr_IAps7<-ser_U_nser_ypcr_IAps8<-ser_U_nser_ypcr_IAps9<-ser_U_nser_ypcr_IAps10<-ser_U_nser_ypcr_IAps11<-ser_U_nser_ypcr_IAps12<-ser_U_nser_ypcr_WAps<-matrix(rep(0, ncat*length(timeintervals.end)), length(timeintervals.end), ncat)#U_ypcr
    
    
#fixed time step stochastic simulation
  #run consecutively for each time interval  
  for(yy in timeintervals.end){
    
#### Part D) Zero incidence variables ####
    
    #These incidence variables must be reset each day because they're vectors or matrices. All others are a single value so are reset within the model run.
    
    #Vaccinated nser npcr
    lea_V_nser_npcr_V<-fpinc_V_nser_npcr_V<-fp_V_nser_npcr_V<-inc_V_nser_npcr_V<-sym_V_nser_npcr_V<-asym_V_nser_npcr_V<-ypcr_asym_V_nser_npcr_V<-npcr_asym_V_nser_npcr_V<-wan_V_nser_npcr_V<-rep(0, ncat)
    rec_V_nser_npcr_IAns<-rec_V_nser_npcr_IS<-rec_V_nser_npcr_IAps<- matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)#(infected compartments are matrices so these variables are too, others are vectors)
    rec.ab_V_nser_npcr_IAns<-rec.ab_V_nser_npcr_IAps<-rec.ab_V_nser_npcr_IS<-rep(0, ncat)
    #Vaccinated nser ypcr
    lea_V_nser_ypcr_V<-fpinc_V_nser_ypcr_V<-fp_V_nser_ypcr_V<-inc_V_nser_ypcr_V<-sym_V_nser_ypcr_V<-asym_V_nser_ypcr_V<-ypcr_asym_V_nser_ypcr_V<-npcr_asym_V_nser_ypcr_V<-wan_V_nser_ypcr_V<-rep(0, ncat)
    rec_V_nser_ypcr_IAns<-rec_V_nser_ypcr_IS<-rec_V_nser_ypcr_IAps<- matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    rec.ab_V_nser_ypcr_IAns<-rec.ab_V_nser_ypcr_IAps<-rec.ab_V_nser_ypcr_IS<-rep(0, ncat)
    #Vaccinated yser npcr
    lea_V_yser_npcr_V<-fpinc_V_yser_npcr_V<-fp_V_yser_npcr_V<-inc_V_yser_npcr_V<-sym_V_yser_npcr_V<-asym_V_yser_npcr_V<-ypcr_asym_V_yser_npcr_V<-npcr_asym_V_yser_npcr_V<-wan_V_yser_npcr_V<-rep(0, ncat)
    rec_V_yser_npcr_IAns<-rec_V_yser_npcr_IS<-rec_V_yser_npcr_IAps<- matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    rec.ab_V_yser_npcr_IAns<-rec.ab_V_yser_npcr_IAps<-rec.ab_V_yser_npcr_IS<-rep(0, ncat)
    #Vaccinated yser ypcr
    lea_V_yser_ypcr_V<-fpinc_V_yser_ypcr_V<-fp_V_yser_ypcr_V<-inc_V_yser_ypcr_V<-sym_V_yser_ypcr_V<-asym_V_yser_ypcr_V<-ypcr_asym_V_yser_ypcr_V<-npcr_asym_V_yser_ypcr_V<-wan_V_yser_ypcr_V<-rep(0, ncat)
    rec_V_yser_ypcr_IAns<-rec_V_yser_ypcr_IS<-rec_V_yser_ypcr_IAps<- matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    rec.ab_V_yser_ypcr_IAns<-rec.ab_V_yser_ypcr_IAps<-rec.ab_V_yser_ypcr_IS<-rep(0, ncat)
    #Unvaccinated nser npcr
    rec_U_nser_npcr_IAns<-rec_U_nser_npcr_IS<-rec_U_nser_npcr_IAps<- matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    rec.ab_U_nser_npcr_IAns<-rec.ab_U_nser_npcr_IAps<-rec.ab_U_nser_npcr_IS<-rep(0, ncat)
    #Unvaccinated nser ypcr
    rec_U_nser_ypcr_IAns<-rec_U_nser_ypcr_IS<-rec_U_nser_ypcr_IAps<- matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    rec.ab_U_nser_ypcr_IAns<-rec.ab_U_nser_ypcr_IAps<-rec.ab_U_nser_ypcr_IS<-rep(0, ncat)
    #Unvaccinated yser npcr
    rec_U_yser_npcr_IAns<-rec_U_yser_npcr_IS<-rec_U_yser_npcr_IAps<- matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    rec.ab_U_yser_npcr_IAns<-rec.ab_U_yser_npcr_IAps<-rec.ab_U_yser_npcr_IS<-rep(0, ncat)
    #Unvaccinated yser ypcr
    rec_U_yser_ypcr_IAns<-rec_U_yser_ypcr_IS<-rec_U_yser_ypcr_IAps<- matrix(rep(0, ncat*n.inf.com), n.inf.com, ncat)
    rec.ab_U_yser_ypcr_IAns<-rec.ab_U_yser_ypcr_IAps<-rec.ab_U_yser_ypcr_IS<-rep(0, ncat)
    
  
#### Part E) Calculate number of participants at risk at the start of the time interval ####
    #(for person-time calculations later)
    
    #1. number never infected symptomatically (primary outcome - first symptomatic infection) (all boxes except IS/RS/WS or IAps/RAps/WAps)
    at.risk.start.first.sym.V<- sum(V_nser_npcr_V) + sum(V_nser_npcr_S) + sum(V_nser_npcr_IAns) + sum(V_nser_npcr_RAns) + sum(V_nser_npcr_WAns) +
                                sum(V_nser_ypcr_V) + sum(V_nser_ypcr_S) + sum(V_nser_ypcr_IAns) + sum(V_nser_ypcr_RAns) + sum(V_nser_ypcr_WAns) +
                                sum(V_yser_npcr_V) + sum(V_yser_npcr_S) + sum(V_yser_npcr_IAns) + sum(V_yser_npcr_RAns) + sum(V_yser_npcr_WAns) +
                                sum(V_yser_ypcr_V) + sum(V_yser_ypcr_S) + sum(V_yser_ypcr_IAns) + sum(V_yser_ypcr_RAns) + sum(V_yser_ypcr_WAns)
    at.risk.start.first.sym.U<- sum(U_nser_npcr_S) + sum(U_nser_npcr_IAns) + sum(U_nser_npcr_RAns) + sum(U_nser_npcr_WAns) +
                                sum(U_nser_ypcr_S) + sum(U_nser_ypcr_IAns) + sum(U_nser_ypcr_RAns) + sum(U_nser_ypcr_WAns) +
                                sum(U_yser_npcr_S) + sum(U_yser_npcr_IAns) + sum(U_yser_npcr_RAns) + sum(U_yser_npcr_WAns) +
                                sum(U_yser_ypcr_S) + sum(U_yser_ypcr_IAns) + sum(U_yser_ypcr_RAns) + sum(U_yser_ypcr_WAns) 
      

    #2. number never infected (first infection) (S and V boxes)
    at.risk.start.first.inf.V<- sum(V_nser_npcr_V)+sum(V_nser_npcr_S)+
                                sum(V_nser_ypcr_V)+sum(V_nser_ypcr_S)+
                                sum(V_yser_npcr_V)+sum(V_yser_npcr_S)+
                                sum(V_yser_ypcr_V)+sum(V_yser_ypcr_S)
                                  
    at.risk.start.first.inf.U<- sum(U_nser_npcr_S)+
                                sum(U_nser_ypcr_S)+
                                sum(U_yser_npcr_S)+
                                sum(U_yser_ypcr_S)
    
    
    #3. number never infected asymptomatically (first asymptomatic infection)
      #(this is done differently to above because I don't separate the symptomatic boxes to people who have been infected asymptomatically before and those who haven't)
      #instead I subtract the cumulative incidence of first-time asymptomatic infections from the total at risk at the start of the trial.
      #This relies on the assumption that there are no 3rd infections (I can distinguish between 1st and 2nd but no more). But it is unlikely that there will be any/many 3rd infections because natural immunity is high. However be careful with setting FOI too high when looking at VE_asym.
    at.risk.start.first.asym.V<- (n*pv*rho) 
    at.risk.start.first.asym.U<- (n*(1-pv)*rho)  
    
    #4. number never PCR-detected (first PCR-detected infection) (all ypcr have had an asymptomatic infection detected, all IS/RS/WS/IAps/RAps/WAps have had a symptomatic infection detected. Therefore at risk are all npcr in S/V/IAns/RAns/WAns)
    at.risk.start.first.PCR.inf.V<- sum(V_nser_npcr_V) + sum(V_nser_npcr_S) + sum(V_nser_npcr_IAns) + sum(V_nser_npcr_RAns) + sum(V_nser_npcr_WAns) + 
                                    sum(V_yser_npcr_V) + sum(V_yser_npcr_S) + sum(V_yser_npcr_IAns) + sum(V_yser_npcr_RAns) + sum(V_yser_npcr_WAns)
    
    at.risk.start.first.PCR.inf.U<- sum(U_nser_npcr_S) + sum(U_nser_npcr_IAns) + sum(U_nser_npcr_RAns) + sum(U_nser_npcr_WAns) + 
                                    sum(U_yser_npcr_S) + sum(U_yser_npcr_IAns) + sum(U_yser_npcr_RAns) + sum(U_yser_npcr_WAns)
                          
    #5. number never PCR-detected asymptomatic infection (all npcr)
    at.risk.start.first.PCR.asym.V<- sum(V_nser_npcr_V) + sum(V_nser_npcr_S) + sum(V_nser_npcr_IAns) + sum(V_nser_npcr_RAns) + sum(V_nser_npcr_WAns) + sum(V_nser_npcr_IAps) + sum(V_nser_npcr_RAps) + sum(V_nser_npcr_WAps) +  sum(V_nser_npcr_IS) + sum(V_nser_npcr_RS) + sum(V_nser_npcr_WS) +
                                     sum(V_yser_npcr_V) + sum(V_yser_npcr_S) + sum(V_yser_npcr_IAns) + sum(V_yser_npcr_RAns) + sum(V_yser_npcr_WAns) + sum(V_yser_npcr_IAps) + sum(V_yser_npcr_RAps) + sum(V_yser_npcr_WAps) +  sum(V_yser_npcr_IS) + sum(V_yser_npcr_RS) + sum(V_yser_npcr_WS) 
    
    at.risk.start.first.PCR.asym.U<- sum(U_nser_npcr_S) + sum(U_nser_npcr_IAns) + sum(U_nser_npcr_RAns) + sum(U_nser_npcr_WAns) + sum(U_nser_npcr_IAps) + sum(U_nser_npcr_RAps) + sum(U_nser_npcr_WAps) +  sum(U_nser_npcr_IS) + sum(U_nser_npcr_RS) + sum(U_nser_npcr_WS) +
                                     sum(U_yser_npcr_S) + sum(U_yser_npcr_IAns) + sum(U_yser_npcr_RAns) + sum(U_yser_npcr_WAns) + sum(U_yser_npcr_IAps) + sum(U_yser_npcr_RAps) + sum(U_yser_npcr_WAps) +  sum(U_yser_npcr_IS) + sum(U_yser_npcr_RS) + sum(U_yser_npcr_WS) 


#### Part F) Calculate incidences and update state variables ####
    
    #run separately for each layer (trial arm [V/U] /serology detected in trial [nser/yser] /asymptomatic pcr detected in trial [ypcr/npcr]). The process is the same for each layer, only difference is the unvaccinated groups don't have a V compartment. Runs for each day in the time interval. Only the first layer is annotated because the rest are the same.
     
    while(time < yy){
    
    # VACCINATED - not serology-detected #
      #incidences
      
      #1. not PCR-detected
          #V
          for (i in 1:ncat) { #for each age category 
          if (p.leave.v[i] > 0) { 
            lea_V_nser_npcr_V[i]<- rbinom(1, V_nser_npcr_V[i], p.leave.v[i])#number leaving V
            fpinc_V_nser_npcr_V[i]<- rbinom(1, lea_V_nser_npcr_V[i], p.fp.inc.v[i]/p.leave.v[i])#number leaving because they are infected or get a false +ve
            fp_V_nser_npcr_V[i]<- rbinom(1, fpinc_V_nser_npcr_V[i], p.fp/p.fp.inc.v[i])#number leaving because they get a false +ve
            inc_V_nser_npcr_V[i]<- fpinc_V_nser_npcr_V[i] - fp_V_nser_npcr_V[i] #number leaving because they're infected
            sym_V_nser_npcr_V[i]<- rbinom(1,inc_V_nser_npcr_V[i], (1-pa[i])*(1-VEdi[i]))#...symptomatically
            asym_V_nser_npcr_V[i]<- inc_V_nser_npcr_V[i]-sym_V_nser_npcr_V[i]#... or asymptomatically
            ypcr_asym_V_nser_npcr_V[i]<- rbinom(1, asym_V_nser_npcr_V[i], asym.pcr.prob)#number of asymptomatic infections that are detected by pcr
            npcr_asym_V_nser_npcr_V[i]<- asym_V_nser_npcr_V[i]-ypcr_asym_V_nser_npcr_V[i]#number of asymptomatic infections that are not detected by pcr
            wan_V_nser_npcr_V[i]<- lea_V_nser_npcr_V[i]-fpinc_V_nser_npcr_V[i] #remainder of those leaving are because their immunity wanes (leavers minus infecteds and false +ves)
          }}
          #S
          if (p.leave.s > 0){
            lea_V_nser_npcr_S<- rbinom(ncat,V_nser_npcr_S, p.leave.s)
            inc_V_nser_npcr_S<- rbinom(ncat,lea_V_nser_npcr_S, p.inf/p.leave.s)
            sym_V_nser_npcr_S<- rbinom(ncat,inc_V_nser_npcr_S, (1-pa))
            asym_V_nser_npcr_S<- inc_V_nser_npcr_S-sym_V_nser_npcr_S
            ypcr_asym_V_nser_npcr_S<- rbinom(ncat, asym_V_nser_npcr_S, asym.pcr.prob)
            npcr_asym_V_nser_npcr_S<- asym_V_nser_npcr_S-ypcr_asym_V_nser_npcr_S
            fp_V_nser_npcr_S <- lea_V_nser_npcr_S - inc_V_nser_npcr_S
          }
          #IAns/IS/IAps
            #(assuming you can't get a false positive when you're infected)
              #1. number transitioning to next stage
          for (i in 1:n.inf.com) { #for each infected compartment (given by rows in the matrix)
            rec_V_nser_npcr_IAns[i,]<- rbinom(ncat,V_nser_npcr_IAns[i,], rec*rec.asym)
            rec_V_nser_npcr_IS[i,]<- rbinom(ncat,V_nser_npcr_IS[i,], rec)
            rec_V_nser_npcr_IAps[i,]<- rbinom(ncat,V_nser_npcr_IAps[i,], rec*rec.asym)
          }
              #2. number recovering at end of I12 that develop antibodies(->R) (rec.ab), or do not (->W) (rec - rec.ab)
            rec.ab_V_nser_npcr_IAns<- rbinom(ncat, rec_V_nser_npcr_IAns[n.inf.com,], p.antibod.asym)
            rec.ab_V_nser_npcr_IAps<- rbinom(ncat, rec_V_nser_npcr_IAps[n.inf.com,], p.antibod.sym)
            rec.ab_V_nser_npcr_IS<- rbinom(ncat, rec_V_nser_npcr_IS[n.inf.com,], p.antibod.sym)
          
          #RAns
          if (p.leave.ra > 0)  {
            lea_V_nser_npcr_RAns<- rbinom(ncat, V_nser_npcr_RAns, p.leave.ra)#number leaving RAns
            fpinc_V_nser_npcr_RAns<- rbinom(ncat, lea_V_nser_npcr_RAns, p.fp.inc.ra/p.leave.ra)#... because they're infected or false positive
            fp_V_nser_npcr_RAns<- rbinom(ncat, fpinc_V_nser_npcr_RAns, p.fp/p.fp.inc.ra)#false positive
            inc_V_nser_npcr_RAns<- fpinc_V_nser_npcr_RAns-fp_V_nser_npcr_RAns#infected
            sym_V_nser_npcr_RAns<- rbinom(ncat,inc_V_nser_npcr_RAns, (1-pa)*as.r)#...symptomatically
            asym_V_nser_npcr_RAns<- inc_V_nser_npcr_RAns-sym_V_nser_npcr_RAns#...asymptomatically
            ypcr_asym_V_nser_npcr_RAns<- rbinom(ncat, asym_V_nser_npcr_RAns, asym.pcr.prob)# asymptomatic infections detected by pcr
            npcr_asym_V_nser_npcr_RAns<- asym_V_nser_npcr_RAns-ypcr_asym_V_nser_npcr_RAns# asymptomatic infections not detected by pcr
            wan_V_nser_npcr_RAns<- lea_V_nser_npcr_RAns - fpinc_V_nser_npcr_RAns #remainder of those leaving are because their immunity wanes (leavers minus infecteds and false +ves)
          }
          #WAns 
          if(p.leave.wa > 0){
            lea_V_nser_npcr_WAns<- rbinom(ncat, V_nser_npcr_WAns, p.leave.wa) #leaving
            inc_V_nser_npcr_WAns<- rbinom(ncat, lea_V_nser_npcr_WAns, (p.inf*ai.w)/p.leave.wa) #infected
            sym_V_nser_npcr_WAns<- rbinom(ncat, inc_V_nser_npcr_WAns, (1-pa)*as.w) #symptomatic
            asym_V_nser_npcr_WAns<- inc_V_nser_npcr_WAns-sym_V_nser_npcr_WAns #asymptomatic
            ypcr_asym_V_nser_npcr_WAns<- rbinom(ncat, asym_V_nser_npcr_WAns, asym.pcr.prob) #pcr detected asymptomatic
            npcr_asym_V_nser_npcr_WAns<- asym_V_nser_npcr_WAns-ypcr_asym_V_nser_npcr_WAns #not pcr detected asymptomatic
            fp_V_nser_npcr_WAns<- lea_V_nser_npcr_WAns-inc_V_nser_npcr_WAns #false positive
          }
          #RS
          if (p.leave.rs > 0)  {
            lea_V_nser_npcr_RS<- rbinom(ncat, V_nser_npcr_RS, p.leave.rs)
            fpinc_V_nser_npcr_RS<- rbinom(ncat, lea_V_nser_npcr_RS, p.fp.inc.rs/p.leave.rs)
            fp_V_nser_npcr_RS<- rbinom(ncat, fpinc_V_nser_npcr_RS, p.fp/p.fp.inc.rs)
            inc_V_nser_npcr_RS<- fpinc_V_nser_npcr_RS-fp_V_nser_npcr_RS
            sym_V_nser_npcr_RS<- rbinom(ncat,inc_V_nser_npcr_RS, (1-pa)*as.r)
            asym_V_nser_npcr_RS<- inc_V_nser_npcr_RS-sym_V_nser_npcr_RS
            ypcr_asym_V_nser_npcr_RS<- rbinom(ncat, asym_V_nser_npcr_RS, asym.pcr.prob)
            npcr_asym_V_nser_npcr_RS<- asym_V_nser_npcr_RS-ypcr_asym_V_nser_npcr_RS
            wan_V_nser_npcr_RS<- lea_V_nser_npcr_RS - fpinc_V_nser_npcr_RS 
          }
          #WS
          if(p.leave.ws > 0){
            lea_V_nser_npcr_WS<- rbinom(ncat, V_nser_npcr_WS, p.leave.ws)
            inc_V_nser_npcr_WS<- rbinom(ncat, lea_V_nser_npcr_WS, (p.inf*si.w)/p.leave.ws)
            sym_V_nser_npcr_WS<- rbinom(ncat, inc_V_nser_npcr_WS, (1-pa)*ss.w)
            asym_V_nser_npcr_WS<- inc_V_nser_npcr_WS-sym_V_nser_npcr_WS
            ypcr_asym_V_nser_npcr_WS<- rbinom(ncat, asym_V_nser_npcr_WS, asym.pcr.prob)
            npcr_asym_V_nser_npcr_WS<- asym_V_nser_npcr_WS-ypcr_asym_V_nser_npcr_WS
            fp_V_nser_npcr_WS<- lea_V_nser_npcr_WS-inc_V_nser_npcr_WS
          }
          #RAps
          if (p.leave.ra > 0)  {
            lea_V_nser_npcr_RAps<- rbinom(ncat, V_nser_npcr_RAps, p.leave.ra)
            fpinc_V_nser_npcr_RAps<- rbinom(ncat, lea_V_nser_npcr_RAps, p.fp.inc.ra/p.leave.ra)
            fp_V_nser_npcr_RAps<- rbinom(ncat, fpinc_V_nser_npcr_RAps, p.fp/p.fp.inc.ra)
            inc_V_nser_npcr_RAps<- fpinc_V_nser_npcr_RAps-fp_V_nser_npcr_RAps
            sym_V_nser_npcr_RAps<- rbinom(ncat,inc_V_nser_npcr_RAps, (1-pa)*as.r)
            asym_V_nser_npcr_RAps<- inc_V_nser_npcr_RAps-sym_V_nser_npcr_RAps
            ypcr_asym_V_nser_npcr_RAps<- rbinom(ncat, asym_V_nser_npcr_RAps, asym.pcr.prob)
            npcr_asym_V_nser_npcr_RAps<- asym_V_nser_npcr_RAps-ypcr_asym_V_nser_npcr_RAps
            wan_V_nser_npcr_RAps<- lea_V_nser_npcr_RAps - fpinc_V_nser_npcr_RAps 
          } 
          #WAps
          if(p.leave.wa > 0){
            lea_V_nser_npcr_WAps<- rbinom(ncat, V_nser_npcr_WAps, p.leave.wa)
            inc_V_nser_npcr_WAps<- rbinom(ncat, lea_V_nser_npcr_WAps, (p.inf*ai.w)/p.leave.wa)
            sym_V_nser_npcr_WAps<- rbinom(ncat, inc_V_nser_npcr_WAps, (1-pa)*as.w)
            asym_V_nser_npcr_WAps<- inc_V_nser_npcr_WAps-sym_V_nser_npcr_WAps
            ypcr_asym_V_nser_npcr_WAps<- rbinom(ncat, asym_V_nser_npcr_WAps, asym.pcr.prob)
            npcr_asym_V_nser_npcr_WAps<- asym_V_nser_npcr_WAps-ypcr_asym_V_nser_npcr_WAps
            fp_V_nser_npcr_WAps<- lea_V_nser_npcr_WAps-inc_V_nser_npcr_WAps
          }
     
        #2. yes PCR-detected
        #V
          for (i in 1:ncat) { 
          if (p.leave.v[i] > 0) { 
            lea_V_nser_ypcr_V[i]<- rbinom(1, V_nser_ypcr_V[i], p.leave.v[i])
            fpinc_V_nser_ypcr_V[i]<- rbinom(1, lea_V_nser_ypcr_V[i], p.fp.inc.v[i]/p.leave.v[i])
            fp_V_nser_ypcr_V[i]<- rbinom(1, fpinc_V_nser_ypcr_V[i], p.fp/p.fp.inc.v[i])
            inc_V_nser_ypcr_V[i]<- fpinc_V_nser_ypcr_V[i] - fp_V_nser_ypcr_V[i]
            sym_V_nser_ypcr_V[i]<- rbinom(1,inc_V_nser_ypcr_V[i], (1-pa[i])*(1-VEdi[i]))
            asym_V_nser_ypcr_V[i]<- inc_V_nser_ypcr_V[i]-sym_V_nser_ypcr_V[i]
            ypcr_asym_V_nser_ypcr_V[i]<- rbinom(1, asym_V_nser_ypcr_V[i], asym.pcr.prob)
            npcr_asym_V_nser_ypcr_V[i]<- asym_V_nser_ypcr_V[i]-ypcr_asym_V_nser_ypcr_V[i]
            wan_V_nser_ypcr_V[i]<- lea_V_nser_ypcr_V[i]-fpinc_V_nser_ypcr_V[i] 
          }}
          #S
          if (p.leave.s > 0){
            lea_V_nser_ypcr_S<- rbinom(ncat,V_nser_ypcr_S, p.leave.s)
            inc_V_nser_ypcr_S<- rbinom(ncat,lea_V_nser_ypcr_S, p.inf/p.leave.s)
            sym_V_nser_ypcr_S<- rbinom(ncat,inc_V_nser_ypcr_S, (1-pa))
            asym_V_nser_ypcr_S<- inc_V_nser_ypcr_S-sym_V_nser_ypcr_S
            ypcr_asym_V_nser_ypcr_S<- rbinom(ncat, asym_V_nser_ypcr_S, asym.pcr.prob)
            npcr_asym_V_nser_ypcr_S<- asym_V_nser_ypcr_S-ypcr_asym_V_nser_ypcr_S
            fp_V_nser_ypcr_S <- lea_V_nser_ypcr_S - inc_V_nser_ypcr_S
          }
          #IAns/IS/IAps
          for (i in 1:n.inf.com) { 
            rec_V_nser_ypcr_IAns[i,]<- rbinom(ncat,V_nser_ypcr_IAns[i,], rec*rec.asym)
            rec_V_nser_ypcr_IS[i,]<- rbinom(ncat,V_nser_ypcr_IS[i,], rec)
            rec_V_nser_ypcr_IAps[i,]<- rbinom(ncat,V_nser_ypcr_IAps[i,], rec*rec.asym)
          }
            rec.ab_V_nser_ypcr_IAns<- rbinom(ncat, rec_V_nser_ypcr_IAns[n.inf.com,], p.antibod.asym)
            rec.ab_V_nser_ypcr_IAps<- rbinom(ncat, rec_V_nser_ypcr_IAps[n.inf.com,], p.antibod.sym)
            rec.ab_V_nser_ypcr_IS<- rbinom(ncat, rec_V_nser_ypcr_IS[n.inf.com,], p.antibod.sym)
          
          #RAns
          if (p.leave.ra > 0)  {
            lea_V_nser_ypcr_RAns<- rbinom(ncat, V_nser_ypcr_RAns, p.leave.ra)
            fpinc_V_nser_ypcr_RAns<- rbinom(ncat, lea_V_nser_ypcr_RAns, p.fp.inc.ra/p.leave.ra)
            fp_V_nser_ypcr_RAns<- rbinom(ncat, fpinc_V_nser_ypcr_RAns, p.fp/p.fp.inc.ra)
            inc_V_nser_ypcr_RAns<- fpinc_V_nser_ypcr_RAns-fp_V_nser_ypcr_RAns
            sym_V_nser_ypcr_RAns<- rbinom(ncat,inc_V_nser_ypcr_RAns, (1-pa)*as.r)
            asym_V_nser_ypcr_RAns<- inc_V_nser_ypcr_RAns-sym_V_nser_ypcr_RAns
            ypcr_asym_V_nser_ypcr_RAns<- rbinom(ncat, asym_V_nser_ypcr_RAns, asym.pcr.prob)
            npcr_asym_V_nser_ypcr_RAns<- asym_V_nser_ypcr_RAns-ypcr_asym_V_nser_ypcr_RAns
            wan_V_nser_ypcr_RAns<- lea_V_nser_ypcr_RAns - fpinc_V_nser_ypcr_RAns 
          }
          #WAns 
          if(p.leave.wa > 0){
            lea_V_nser_ypcr_WAns<- rbinom(ncat, V_nser_ypcr_WAns, p.leave.wa)
            inc_V_nser_ypcr_WAns<- rbinom(ncat, lea_V_nser_ypcr_WAns, (p.inf*ai.w)/p.leave.wa)
            sym_V_nser_ypcr_WAns<- rbinom(ncat, inc_V_nser_ypcr_WAns, (1-pa)*as.w)
            asym_V_nser_ypcr_WAns<- inc_V_nser_ypcr_WAns-sym_V_nser_ypcr_WAns
            ypcr_asym_V_nser_ypcr_WAns<- rbinom(ncat, asym_V_nser_ypcr_WAns, asym.pcr.prob)
            npcr_asym_V_nser_ypcr_WAns<- asym_V_nser_ypcr_WAns-ypcr_asym_V_nser_ypcr_WAns
            fp_V_nser_ypcr_WAns<- lea_V_nser_ypcr_WAns-inc_V_nser_ypcr_WAns
          }
          #RS
          if (p.leave.rs > 0)  {
            lea_V_nser_ypcr_RS<- rbinom(ncat, V_nser_ypcr_RS, p.leave.rs)
            fpinc_V_nser_ypcr_RS<- rbinom(ncat, lea_V_nser_ypcr_RS, p.fp.inc.rs/p.leave.rs)
            fp_V_nser_ypcr_RS<- rbinom(ncat, fpinc_V_nser_ypcr_RS, p.fp/p.fp.inc.rs)
            inc_V_nser_ypcr_RS<- fpinc_V_nser_ypcr_RS-fp_V_nser_ypcr_RS
            sym_V_nser_ypcr_RS<- rbinom(ncat,inc_V_nser_ypcr_RS, (1-pa)*as.r)
            asym_V_nser_ypcr_RS<- inc_V_nser_ypcr_RS-sym_V_nser_ypcr_RS
            ypcr_asym_V_nser_ypcr_RS<- rbinom(ncat, asym_V_nser_ypcr_RS, asym.pcr.prob)
            npcr_asym_V_nser_ypcr_RS<- asym_V_nser_ypcr_RS-ypcr_asym_V_nser_ypcr_RS
            wan_V_nser_ypcr_RS<- lea_V_nser_ypcr_RS - fpinc_V_nser_ypcr_RS 
          }
          #WS
          if(p.leave.ws > 0){
            lea_V_nser_ypcr_WS<- rbinom(ncat, V_nser_ypcr_WS, p.leave.ws)
            inc_V_nser_ypcr_WS<- rbinom(ncat, lea_V_nser_ypcr_WS, (p.inf*si.w)/p.leave.ws)
            sym_V_nser_ypcr_WS<- rbinom(ncat, inc_V_nser_ypcr_WS, (1-pa)*ss.w)
            asym_V_nser_ypcr_WS<- inc_V_nser_ypcr_WS-sym_V_nser_ypcr_WS
            ypcr_asym_V_nser_ypcr_WS<- rbinom(ncat, asym_V_nser_ypcr_WS, asym.pcr.prob)
            npcr_asym_V_nser_ypcr_WS<- asym_V_nser_ypcr_WS-ypcr_asym_V_nser_ypcr_WS
            fp_V_nser_ypcr_WS<- lea_V_nser_ypcr_WS-inc_V_nser_ypcr_WS
          }
          #RAps
          if (p.leave.ra > 0)  {
            lea_V_nser_ypcr_RAps<- rbinom(ncat, V_nser_ypcr_RAps, p.leave.ra)
            fpinc_V_nser_ypcr_RAps<- rbinom(ncat, lea_V_nser_ypcr_RAps, p.fp.inc.ra/p.leave.ra)
            fp_V_nser_ypcr_RAps<- rbinom(ncat, fpinc_V_nser_ypcr_RAps, p.fp/p.fp.inc.ra)
            inc_V_nser_ypcr_RAps<- fpinc_V_nser_ypcr_RAps-fp_V_nser_ypcr_RAps
            sym_V_nser_ypcr_RAps<- rbinom(ncat,inc_V_nser_ypcr_RAps, (1-pa)*as.r)
            asym_V_nser_ypcr_RAps<- inc_V_nser_ypcr_RAps-sym_V_nser_ypcr_RAps
            ypcr_asym_V_nser_ypcr_RAps<- rbinom(ncat, asym_V_nser_ypcr_RAps, asym.pcr.prob)
            npcr_asym_V_nser_ypcr_RAps<- asym_V_nser_ypcr_RAps-ypcr_asym_V_nser_ypcr_RAps
            wan_V_nser_ypcr_RAps<- lea_V_nser_ypcr_RAps - fpinc_V_nser_ypcr_RAps 
          } 
          #WAps
          if(p.leave.wa > 0){
            lea_V_nser_ypcr_WAps<- rbinom(ncat, V_nser_ypcr_WAps, p.leave.wa)
            inc_V_nser_ypcr_WAps<- rbinom(ncat, lea_V_nser_ypcr_WAps, (p.inf*ai.w)/p.leave.wa)
            sym_V_nser_ypcr_WAps<- rbinom(ncat, inc_V_nser_ypcr_WAps, (1-pa)*as.w)
            asym_V_nser_ypcr_WAps<- inc_V_nser_ypcr_WAps-sym_V_nser_ypcr_WAps
            ypcr_asym_V_nser_ypcr_WAps<- rbinom(ncat, asym_V_nser_ypcr_WAps, asym.pcr.prob)
            npcr_asym_V_nser_ypcr_WAps<- asym_V_nser_ypcr_WAps-ypcr_asym_V_nser_ypcr_WAps
            fp_V_nser_ypcr_WAps<- lea_V_nser_ypcr_WAps-inc_V_nser_ypcr_WAps
          }      
              
      #update state variables
              
      #1. not pcr detected  
              
        V_nser_npcr_V<-                 V_nser_npcr_V - wan_V_nser_npcr_V - inc_V_nser_npcr_V - fp_V_nser_npcr_V # minus wane/infected/false +ve
        V_nser_npcr_IAns[1,]<-          V_nser_npcr_IAns[1,] + npcr_asym_V_nser_npcr_V + npcr_asym_V_nser_npcr_S  - rec_V_nser_npcr_IAns[1,]#1st infected box (plus asym not pcr detected (V/S), minus transitions to next box)
        V_nser_npcr_IAns[2:6,]<-        V_nser_npcr_IAns[2:6,] + rec_V_nser_npcr_IAns[1:5,] - rec_V_nser_npcr_IAns[2:6,] #2nd-6th infected boxes (as some infections need to be added to the 7th), adding those who transition from the previous box, and removing those who move into the next box
        V_nser_npcr_IAns[7,]<-          V_nser_npcr_IAns[7,] + rec_V_nser_npcr_IAns[6,] - rec_V_nser_npcr_IAns[7,] + npcr_asym_V_nser_npcr_WAns #as above, but adding those who are infected asymptomatically from the waned box but not pcr detected (so they have a shorter time to seroconversion).
        V_nser_npcr_IAns[8:n.inf.com,]<-V_nser_npcr_IAns[8:n.inf.com,] + rec_V_nser_npcr_IAns[7:(n.inf.com-1),] - rec_V_nser_npcr_IAns[8:n.inf.com,] #8th up to last I box - transitions in from previous box, and out to next box
        V_nser_npcr_RAns<-              V_nser_npcr_RAns + rec.ab_V_nser_npcr_IAns - sym_V_nser_npcr_RAns - ypcr_asym_V_nser_npcr_RAns - wan_V_nser_npcr_RAns - fp_V_nser_npcr_RAns #plus people who recover and develop antibodies, minus symptomatic infections, detected asymptomatic infections, waners and false +ves
        V_nser_npcr_WAns<-              V_nser_npcr_WAns + (rec_V_nser_npcr_IAns[n.inf.com,] - rec.ab_V_nser_npcr_IAns) + wan_V_nser_npcr_RAns - inc_V_nser_npcr_WAns - fp_V_nser_npcr_WAns #plus people who recover but don't develop antibodies, waners, minus infecteds and false +ves.
        V_nser_npcr_S<-                 V_nser_npcr_S + wan_V_nser_npcr_V - inc_V_nser_npcr_S - fp_V_nser_npcr_S #plus waners from V, minus infecteds and false +ves
        V_nser_npcr_IS[1,]<-            V_nser_npcr_IS[1,] + sym_V_nser_npcr_S + sym_V_nser_npcr_V - rec_V_nser_npcr_IS[1,] # plus sym (V/S), minus transitions to next box
        V_nser_npcr_IS[2:6,]<-          V_nser_npcr_IS[2:6,] + rec_V_nser_npcr_IS[1:5,] - rec_V_nser_npcr_IS[2:6,] 
        V_nser_npcr_IS[7,]<-            V_nser_npcr_IS[7,] + rec_V_nser_npcr_IS[6,] - rec_V_nser_npcr_IS[7,] + sym_V_nser_npcr_WAns + sym_V_nser_npcr_WS + sym_V_nser_npcr_WAps # plus transitions from previous box and symptomatic infections from waned compartments, minus transitions to next I box
        V_nser_npcr_IS[8:n.inf.com,]<-  V_nser_npcr_IS[8:n.inf.com,] + rec_V_nser_npcr_IS[7:(n.inf.com-1),] - rec_V_nser_npcr_IS[8:n.inf.com,] #plus
        V_nser_npcr_RS<-                V_nser_npcr_RS + rec.ab_V_nser_npcr_IS + sym_V_nser_npcr_RAns + sym_V_nser_npcr_RAps - wan_V_nser_npcr_RS - asym_V_nser_npcr_RS - fp_V_nser_npcr_RS #plus people who recover and develop antibodies, symptomatic infections (RAns/RAps), minus waners, asymptomatic infections, and false +ves
        V_nser_npcr_WS<-                V_nser_npcr_WS + (rec_V_nser_npcr_IS[n.inf.com,] - rec.ab_V_nser_npcr_IS) + wan_V_nser_npcr_RS - inc_V_nser_npcr_WS - fp_V_nser_npcr_WS # plus people who recover but don't develop antibodies, waners, minus infecteds and false +ves
        V_nser_npcr_IAps[1,]<-          V_nser_npcr_IAps[1,] - rec_V_nser_npcr_IAps[1,] # will always be 0
        V_nser_npcr_IAps[2:6,]<-        V_nser_npcr_IAps[2:6,] + rec_V_nser_npcr_IAps[1:5,] - rec_V_nser_npcr_IAps[2:6,] #will always be 0
        V_nser_npcr_IAps[7,]<-          V_nser_npcr_IAps[7,] + rec_V_nser_npcr_IAps[6,] - rec_V_nser_npcr_IAps[7,] + npcr_asym_V_nser_npcr_WAps +  npcr_asym_V_nser_npcr_WS #transitions, plus asymptomatic infections that aren't detected (WAps/WS)
        V_nser_npcr_IAps[8:n.inf.com,]<-V_nser_npcr_IAps[8:n.inf.com,] + rec_V_nser_npcr_IAps[7:(n.inf.com-1),] - rec_V_nser_npcr_IAps[8:n.inf.com,] #transitions in from previous box, and out to next box
        V_nser_npcr_RAps<-              V_nser_npcr_RAps + rec.ab_V_nser_npcr_IAps + npcr_asym_V_nser_npcr_RS - sym_V_nser_npcr_RAps - wan_V_nser_npcr_RAps - fp_V_nser_npcr_RAps - ypcr_asym_V_nser_npcr_RAps #plus people who recover and develop antibodies, not-detected asymptomatic infections (RS), minus waners, symptomatic infections, false +ves and detected asymptomatic infections
        V_nser_npcr_WAps<-              V_nser_npcr_WAps + (rec_V_nser_npcr_IAps[n.inf.com,] - rec.ab_V_nser_npcr_IAps) + wan_V_nser_npcr_RAps - inc_V_nser_npcr_WAps - fp_V_nser_npcr_WAps # plus people who recover but don't develop antibodies, waners, minus infecteds and false +ves

      #2. yes pcr detected
        
        V_nser_ypcr_V<-                 V_nser_ypcr_V - wan_V_nser_ypcr_V - inc_V_nser_ypcr_V + fp_V_nser_npcr_V # minus wane/infected, plus false +ve
        V_nser_ypcr_IAns[1,]<-          V_nser_ypcr_IAns[1,] + ypcr_asym_V_nser_npcr_V + ypcr_asym_V_nser_npcr_S + asym_V_nser_ypcr_V + asym_V_nser_ypcr_S - rec_V_nser_ypcr_IAns[1,]#plus asym detected from npcr (V/S), all asym from ypcr, minus transitions to next box)
        V_nser_ypcr_IAns[2:6,]<-        V_nser_ypcr_IAns[2:6,] + rec_V_nser_ypcr_IAns[1:5,] - rec_V_nser_ypcr_IAns[2:6,] #transitions in and out
        V_nser_ypcr_IAns[7,]<-          V_nser_ypcr_IAns[7,] + rec_V_nser_ypcr_IAns[6,] - rec_V_nser_ypcr_IAns[7,] + ypcr_asym_V_nser_npcr_WAns + asym_V_nser_ypcr_WAns #transitions, plus detected asymptomatics from npcr and all asymptomatics from ypcr.
        V_nser_ypcr_IAns[8:n.inf.com,]<-V_nser_ypcr_IAns[8:n.inf.com,] + rec_V_nser_ypcr_IAns[7:(n.inf.com-1),] - rec_V_nser_ypcr_IAns[8:n.inf.com,] #transitions
        V_nser_ypcr_RAns<-              V_nser_ypcr_RAns + rec.ab_V_nser_ypcr_IAns + fp_V_nser_npcr_RAns + ypcr_asym_V_nser_npcr_RAns - sym_V_nser_ypcr_RAns - wan_V_nser_ypcr_RAns  #plus people who recover and develop antibodies, false positives and detected asymptomatic infections from npcr, minus symptomatic infections and waners.
        V_nser_ypcr_WAns<-              V_nser_ypcr_WAns + (rec_V_nser_ypcr_IAns[n.inf.com,] - rec.ab_V_nser_ypcr_IAns) + wan_V_nser_ypcr_RAns + fp_V_nser_npcr_WAns - inc_V_nser_ypcr_WAns #plus people who recover but don't develop antibodies, waners, and false +ves from npcr,  minus infecteds.
        V_nser_ypcr_S<-                 V_nser_ypcr_S + wan_V_nser_ypcr_V + fp_V_nser_npcr_S - inc_V_nser_ypcr_S #plus waners and false +ves, minus infecteds
        V_nser_ypcr_IS[1,]<-            V_nser_ypcr_IS[1,] + sym_V_nser_ypcr_S + sym_V_nser_ypcr_V - rec_V_nser_ypcr_IS[1,] # plus sym (V/S), minus transitions to next box
        V_nser_ypcr_IS[2:6,]<-          V_nser_ypcr_IS[2:6,] + rec_V_nser_ypcr_IS[1:5,] - rec_V_nser_ypcr_IS[2:6,] #transitions
        V_nser_ypcr_IS[7,]<-            V_nser_ypcr_IS[7,] + rec_V_nser_ypcr_IS[6,] - rec_V_nser_ypcr_IS[7,] + sym_V_nser_ypcr_WAns + sym_V_nser_ypcr_WS + sym_V_nser_ypcr_WAps
        V_nser_ypcr_IS[8:n.inf.com,]<-  V_nser_ypcr_IS[8:n.inf.com,] + rec_V_nser_ypcr_IS[7:(n.inf.com-1),] - rec_V_nser_ypcr_IS[8:n.inf.com,]
        V_nser_ypcr_RS<-                V_nser_ypcr_RS + rec.ab_V_nser_ypcr_IS + sym_V_nser_ypcr_RAns + sym_V_nser_ypcr_RAps - wan_V_nser_ypcr_RS - asym_V_nser_ypcr_RS + fp_V_nser_npcr_RS #plus people who recover and develop antibodies, symptomatic infections (RAns/RAps) and false +ves, minus waners and asymptomatic infections.
        V_nser_ypcr_WS<-                V_nser_ypcr_WS + (rec_V_nser_ypcr_IS[n.inf.com,] - rec.ab_V_nser_ypcr_IS) + wan_V_nser_ypcr_RS + fp_V_nser_npcr_WS - inc_V_nser_ypcr_WS  # plus people who recover but don't develop antibodies, waners and false +ves from npcr, minus infecteds. 
        V_nser_ypcr_IAps[1,]<-          V_nser_ypcr_IAps[1,] - rec_V_nser_ypcr_IAps[1,] # will always be 0 (people enter IAps only from W, box 7)
        V_nser_ypcr_IAps[2:6,]<-        V_nser_ypcr_IAps[2:6,] + rec_V_nser_ypcr_IAps[1:5,] - rec_V_nser_ypcr_IAps[2:6,] #will always be 0 (people enter IAps only from W, box 7)
        V_nser_ypcr_IAps[7,]<-          V_nser_ypcr_IAps[7,] + rec_V_nser_ypcr_IAps[6,] - rec_V_nser_ypcr_IAps[7,] + asym_V_nser_ypcr_WAps + asym_V_nser_ypcr_WS + ypcr_asym_V_nser_npcr_WAps + ypcr_asym_V_nser_npcr_WS #transitions, plus asymptomatic infections from ypcr, and detected asymptomatic infections from npcr (WAps/WS).
        V_nser_ypcr_IAps[8:n.inf.com,]<-V_nser_ypcr_IAps[8:n.inf.com,] + rec_V_nser_ypcr_IAps[7:(n.inf.com-1),] - rec_V_nser_ypcr_IAps[8:n.inf.com,]#transitions
        V_nser_ypcr_RAps<-              V_nser_ypcr_RAps + rec.ab_V_nser_ypcr_IAps + ypcr_asym_V_nser_npcr_RS + ypcr_asym_V_nser_npcr_RAps + fp_V_nser_npcr_RAps + asym_V_nser_ypcr_RS - sym_V_nser_ypcr_RAps - wan_V_nser_ypcr_RAps #plus people who recover and develop antibodies, detected asymptomatic infections (RS/RAps) and false +ves from npcr, all asymptomatic infections from ypcr (RS), minus waners and symptomatic infections
        V_nser_ypcr_WAps<-              V_nser_ypcr_WAps + (rec_V_nser_ypcr_IAps[n.inf.com,] - rec.ab_V_nser_ypcr_IAps) + wan_V_nser_ypcr_RAps + fp_V_nser_npcr_WAps - inc_V_nser_ypcr_WAps # plus people who recover but don't develop antibodies, waners, and false +ves, minus infecteds 

        
        
        
  # VACCINATED - yes serology-detected #
      #incidences
      
      #1. not PCR-detected
          #V
          for (i in 1:ncat) { 
          if (p.leave.v[i] > 0) { 
            lea_V_yser_npcr_V[i]<- rbinom(1, V_yser_npcr_V[i], p.leave.v[i])
            fpinc_V_yser_npcr_V[i]<- rbinom(1, lea_V_yser_npcr_V[i], p.fp.inc.v[i]/p.leave.v[i])
            fp_V_yser_npcr_V[i]<- rbinom(1, fpinc_V_yser_npcr_V[i], p.fp/p.fp.inc.v[i])
            inc_V_yser_npcr_V[i]<- fpinc_V_yser_npcr_V[i] - fp_V_yser_npcr_V[i]
            sym_V_yser_npcr_V[i]<- rbinom(1,inc_V_yser_npcr_V[i], (1-pa[i])*(1-VEdi[i]))
            asym_V_yser_npcr_V[i]<- inc_V_yser_npcr_V[i]-sym_V_yser_npcr_V[i]
            ypcr_asym_V_yser_npcr_V[i]<- rbinom(1, asym_V_yser_npcr_V[i], asym.pcr.prob)
            npcr_asym_V_yser_npcr_V[i]<- asym_V_yser_npcr_V[i]-ypcr_asym_V_yser_npcr_V[i]
            wan_V_yser_npcr_V[i]<- lea_V_yser_npcr_V[i]-fpinc_V_yser_npcr_V[i]
          }}
          #S
          if (p.leave.s > 0){
            lea_V_yser_npcr_S<- rbinom(ncat,V_yser_npcr_S, p.leave.s)
            inc_V_yser_npcr_S<- rbinom(ncat,lea_V_yser_npcr_S, p.inf/p.leave.s)
            sym_V_yser_npcr_S<- rbinom(ncat,inc_V_yser_npcr_S, (1-pa))
            asym_V_yser_npcr_S<- inc_V_yser_npcr_S-sym_V_yser_npcr_S
            ypcr_asym_V_yser_npcr_S<- rbinom(ncat, asym_V_yser_npcr_S, asym.pcr.prob)
            npcr_asym_V_yser_npcr_S<- asym_V_yser_npcr_S-ypcr_asym_V_yser_npcr_S
            fp_V_yser_npcr_S <- lea_V_yser_npcr_S - inc_V_yser_npcr_S
          }
          #IAns/IS/IAps
          for (i in 1:n.inf.com) { 
            rec_V_yser_npcr_IAns[i,]<- rbinom(ncat,V_yser_npcr_IAns[i,], rec*rec.asym)
            rec_V_yser_npcr_IS[i,]<- rbinom(ncat,V_yser_npcr_IS[i,], rec)
            rec_V_yser_npcr_IAps[i,]<- rbinom(ncat,V_yser_npcr_IAps[i,], rec*rec.asym)
          }
            rec.ab_V_yser_npcr_IAns<- rbinom(ncat, rec_V_yser_npcr_IAns[n.inf.com,], p.antibod.asym)
            rec.ab_V_yser_npcr_IAps<- rbinom(ncat, rec_V_yser_npcr_IAps[n.inf.com,], p.antibod.sym)
            rec.ab_V_yser_npcr_IS<- rbinom(ncat, rec_V_yser_npcr_IS[n.inf.com,], p.antibod.sym)
          
          #RAns
          if (p.leave.ra > 0)  {
            lea_V_yser_npcr_RAns<- rbinom(ncat, V_yser_npcr_RAns, p.leave.ra)
            fpinc_V_yser_npcr_RAns<- rbinom(ncat, lea_V_yser_npcr_RAns, p.fp.inc.ra/p.leave.ra)
            fp_V_yser_npcr_RAns<- rbinom(ncat, fpinc_V_yser_npcr_RAns, p.fp/p.fp.inc.ra)
            inc_V_yser_npcr_RAns<- fpinc_V_yser_npcr_RAns-fp_V_yser_npcr_RAns
            sym_V_yser_npcr_RAns<- rbinom(ncat,inc_V_yser_npcr_RAns, (1-pa)*as.r)
            asym_V_yser_npcr_RAns<- inc_V_yser_npcr_RAns-sym_V_yser_npcr_RAns
            ypcr_asym_V_yser_npcr_RAns<- rbinom(ncat, asym_V_yser_npcr_RAns, asym.pcr.prob)
            npcr_asym_V_yser_npcr_RAns<- asym_V_yser_npcr_RAns-ypcr_asym_V_yser_npcr_RAns
            wan_V_yser_npcr_RAns<- lea_V_yser_npcr_RAns - fpinc_V_yser_npcr_RAns 
          }
          #WAns 
          if(p.leave.wa > 0){
            lea_V_yser_npcr_WAns<- rbinom(ncat, V_yser_npcr_WAns, p.leave.wa)
            inc_V_yser_npcr_WAns<- rbinom(ncat, lea_V_yser_npcr_WAns, (p.inf*ai.w)/p.leave.wa)
            sym_V_yser_npcr_WAns<- rbinom(ncat, inc_V_yser_npcr_WAns, (1-pa)*as.w)
            asym_V_yser_npcr_WAns<- inc_V_yser_npcr_WAns-sym_V_yser_npcr_WAns
            ypcr_asym_V_yser_npcr_WAns<- rbinom(ncat, asym_V_yser_npcr_WAns, asym.pcr.prob)
            npcr_asym_V_yser_npcr_WAns<- asym_V_yser_npcr_WAns-ypcr_asym_V_yser_npcr_WAns
            fp_V_yser_npcr_WAns<- lea_V_yser_npcr_WAns-inc_V_yser_npcr_WAns
          }
          #RS
          if (p.leave.rs > 0)  {
            lea_V_yser_npcr_RS<- rbinom(ncat, V_yser_npcr_RS, p.leave.rs)
            fpinc_V_yser_npcr_RS<- rbinom(ncat, lea_V_yser_npcr_RS, p.fp.inc.rs/p.leave.rs)
            fp_V_yser_npcr_RS<- rbinom(ncat, fpinc_V_yser_npcr_RS, p.fp/p.fp.inc.rs)
            inc_V_yser_npcr_RS<- fpinc_V_yser_npcr_RS-fp_V_yser_npcr_RS
            sym_V_yser_npcr_RS<- rbinom(ncat,inc_V_yser_npcr_RS, (1-pa)*as.r)
            asym_V_yser_npcr_RS<- inc_V_yser_npcr_RS-sym_V_yser_npcr_RS
            ypcr_asym_V_yser_npcr_RS<- rbinom(ncat, asym_V_yser_npcr_RS, asym.pcr.prob)
            npcr_asym_V_yser_npcr_RS<- asym_V_yser_npcr_RS-ypcr_asym_V_yser_npcr_RS
            wan_V_yser_npcr_RS<- lea_V_yser_npcr_RS - fpinc_V_yser_npcr_RS 
          }
          #WS
          if(p.leave.ws > 0){
            lea_V_yser_npcr_WS<- rbinom(ncat, V_yser_npcr_WS, p.leave.ws)
            inc_V_yser_npcr_WS<- rbinom(ncat, lea_V_yser_npcr_WS, (p.inf*si.w)/p.leave.ws)
            sym_V_yser_npcr_WS<- rbinom(ncat, inc_V_yser_npcr_WS, (1-pa)*ss.w)
            asym_V_yser_npcr_WS<- inc_V_yser_npcr_WS-sym_V_yser_npcr_WS
            ypcr_asym_V_yser_npcr_WS<- rbinom(ncat, asym_V_yser_npcr_WS, asym.pcr.prob)
            npcr_asym_V_yser_npcr_WS<- asym_V_yser_npcr_WS-ypcr_asym_V_yser_npcr_WS
            fp_V_yser_npcr_WS<- lea_V_yser_npcr_WS-inc_V_yser_npcr_WS
          }
          #RAps
          if (p.leave.ra > 0)  {
            lea_V_yser_npcr_RAps<- rbinom(ncat, V_yser_npcr_RAps, p.leave.ra)
            fpinc_V_yser_npcr_RAps<- rbinom(ncat, lea_V_yser_npcr_RAps, p.fp.inc.ra/p.leave.ra)
            fp_V_yser_npcr_RAps<- rbinom(ncat, fpinc_V_yser_npcr_RAps, p.fp/p.fp.inc.ra)
            inc_V_yser_npcr_RAps<- fpinc_V_yser_npcr_RAps-fp_V_yser_npcr_RAps
            sym_V_yser_npcr_RAps<- rbinom(ncat,inc_V_yser_npcr_RAps, (1-pa)*as.r)
            asym_V_yser_npcr_RAps<- inc_V_yser_npcr_RAps-sym_V_yser_npcr_RAps
            ypcr_asym_V_yser_npcr_RAps<- rbinom(ncat, asym_V_yser_npcr_RAps, asym.pcr.prob)
            npcr_asym_V_yser_npcr_RAps<- asym_V_yser_npcr_RAps-ypcr_asym_V_yser_npcr_RAps
            wan_V_yser_npcr_RAps<- lea_V_yser_npcr_RAps - fpinc_V_yser_npcr_RAps 
          } 
          #WAps
          if(p.leave.wa > 0){
            lea_V_yser_npcr_WAps<- rbinom(ncat, V_yser_npcr_WAps, p.leave.wa)
            inc_V_yser_npcr_WAps<- rbinom(ncat, lea_V_yser_npcr_WAps, (p.inf*ai.w)/p.leave.wa)
            sym_V_yser_npcr_WAps<- rbinom(ncat, inc_V_yser_npcr_WAps, (1-pa)*as.w)
            asym_V_yser_npcr_WAps<- inc_V_yser_npcr_WAps-sym_V_yser_npcr_WAps
            ypcr_asym_V_yser_npcr_WAps<- rbinom(ncat, asym_V_yser_npcr_WAps, asym.pcr.prob)
            npcr_asym_V_yser_npcr_WAps<- asym_V_yser_npcr_WAps-ypcr_asym_V_yser_npcr_WAps
            fp_V_yser_npcr_WAps<- lea_V_yser_npcr_WAps-inc_V_yser_npcr_WAps
          }
     
        #2. yes PCR-detected
        #V
          for (i in 1:ncat) { 
          if (p.leave.v[i] > 0) { 
            lea_V_yser_ypcr_V[i]<- rbinom(1, V_yser_ypcr_V[i], p.leave.v[i])
            fpinc_V_yser_ypcr_V[i]<- rbinom(1, lea_V_yser_ypcr_V[i], p.fp.inc.v[i]/p.leave.v[i])
            fp_V_yser_ypcr_V[i]<- rbinom(1, fpinc_V_yser_ypcr_V[i], p.fp/p.fp.inc.v[i])
            inc_V_yser_ypcr_V[i]<- fpinc_V_yser_ypcr_V[i] - fp_V_yser_ypcr_V[i]
            sym_V_yser_ypcr_V[i]<- rbinom(1,inc_V_yser_ypcr_V[i], (1-pa[i])*(1-VEdi[i]))
            asym_V_yser_ypcr_V[i]<- inc_V_yser_ypcr_V[i]-sym_V_yser_ypcr_V[i]
            ypcr_asym_V_yser_ypcr_V[i]<- rbinom(1, asym_V_yser_ypcr_V[i], asym.pcr.prob)
            npcr_asym_V_yser_ypcr_V[i]<- asym_V_yser_ypcr_V[i]-ypcr_asym_V_yser_ypcr_V[i]
            wan_V_yser_ypcr_V[i]<- lea_V_yser_ypcr_V[i]-fpinc_V_yser_ypcr_V[i] 
          }}
          #S
          if (p.leave.s > 0){
            lea_V_yser_ypcr_S<- rbinom(ncat,V_yser_ypcr_S, p.leave.s)
            inc_V_yser_ypcr_S<- rbinom(ncat,lea_V_yser_ypcr_S, p.inf/p.leave.s)
            sym_V_yser_ypcr_S<- rbinom(ncat,inc_V_yser_ypcr_S, (1-pa))
            asym_V_yser_ypcr_S<- inc_V_yser_ypcr_S-sym_V_yser_ypcr_S
            ypcr_asym_V_yser_ypcr_S<- rbinom(ncat, asym_V_yser_ypcr_S, asym.pcr.prob)
            npcr_asym_V_yser_ypcr_S<- asym_V_yser_ypcr_S-ypcr_asym_V_yser_ypcr_S
            fp_V_yser_ypcr_S <- lea_V_yser_ypcr_S - inc_V_yser_ypcr_S
          }
          #IAns/IS/IAps
          for (i in 1:n.inf.com) { 
            rec_V_yser_ypcr_IAns[i,]<- rbinom(ncat,V_yser_ypcr_IAns[i,], rec*rec.asym)
            rec_V_yser_ypcr_IS[i,]<- rbinom(ncat,V_yser_ypcr_IS[i,], rec)
            rec_V_yser_ypcr_IAps[i,]<- rbinom(ncat,V_yser_ypcr_IAps[i,], rec*rec.asym)
          }
            rec.ab_V_yser_ypcr_IAns<- rbinom(ncat, rec_V_yser_ypcr_IAns[n.inf.com,], p.antibod.asym)
            rec.ab_V_yser_ypcr_IAps<- rbinom(ncat, rec_V_yser_ypcr_IAps[n.inf.com,], p.antibod.sym)
            rec.ab_V_yser_ypcr_IS<- rbinom(ncat, rec_V_yser_ypcr_IS[n.inf.com,], p.antibod.sym)
          
          #RAns
          if (p.leave.ra > 0)  {
            lea_V_yser_ypcr_RAns<- rbinom(ncat, V_yser_ypcr_RAns, p.leave.ra)
            fpinc_V_yser_ypcr_RAns<- rbinom(ncat, lea_V_yser_ypcr_RAns, p.fp.inc.ra/p.leave.ra)
            fp_V_yser_ypcr_RAns<- rbinom(ncat, fpinc_V_yser_ypcr_RAns, p.fp/p.fp.inc.ra)
            inc_V_yser_ypcr_RAns<- fpinc_V_yser_ypcr_RAns-fp_V_yser_ypcr_RAns
            sym_V_yser_ypcr_RAns<- rbinom(ncat,inc_V_yser_ypcr_RAns, (1-pa)*as.r)
            asym_V_yser_ypcr_RAns<- inc_V_yser_ypcr_RAns-sym_V_yser_ypcr_RAns
            ypcr_asym_V_yser_ypcr_RAns<- rbinom(ncat, asym_V_yser_ypcr_RAns, asym.pcr.prob)
            npcr_asym_V_yser_ypcr_RAns<- asym_V_yser_ypcr_RAns-ypcr_asym_V_yser_ypcr_RAns
            wan_V_yser_ypcr_RAns<- lea_V_yser_ypcr_RAns - fpinc_V_yser_ypcr_RAns 
          }
          #WAns 
          if(p.leave.wa > 0){
            lea_V_yser_ypcr_WAns<- rbinom(ncat, V_yser_ypcr_WAns, p.leave.wa)
            inc_V_yser_ypcr_WAns<- rbinom(ncat, lea_V_yser_ypcr_WAns, (p.inf*ai.w)/p.leave.wa)
            sym_V_yser_ypcr_WAns<- rbinom(ncat, inc_V_yser_ypcr_WAns, (1-pa)*as.w)
            asym_V_yser_ypcr_WAns<- inc_V_yser_ypcr_WAns-sym_V_yser_ypcr_WAns
            ypcr_asym_V_yser_ypcr_WAns<- rbinom(ncat, asym_V_yser_ypcr_WAns, asym.pcr.prob)
            npcr_asym_V_yser_ypcr_WAns<- asym_V_yser_ypcr_WAns-ypcr_asym_V_yser_ypcr_WAns
            fp_V_yser_ypcr_WAns<- lea_V_yser_ypcr_WAns-inc_V_yser_ypcr_WAns
          }
          #RS
          if (p.leave.rs > 0)  {
            lea_V_yser_ypcr_RS<- rbinom(ncat, V_yser_ypcr_RS, p.leave.rs)
            fpinc_V_yser_ypcr_RS<- rbinom(ncat, lea_V_yser_ypcr_RS, p.fp.inc.rs/p.leave.rs)
            fp_V_yser_ypcr_RS<- rbinom(ncat, fpinc_V_yser_ypcr_RS, p.fp/p.fp.inc.rs)
            inc_V_yser_ypcr_RS<- fpinc_V_yser_ypcr_RS-fp_V_yser_ypcr_RS
            sym_V_yser_ypcr_RS<- rbinom(ncat,inc_V_yser_ypcr_RS, (1-pa)*as.r)
            asym_V_yser_ypcr_RS<- inc_V_yser_ypcr_RS-sym_V_yser_ypcr_RS
            ypcr_asym_V_yser_ypcr_RS<- rbinom(ncat, asym_V_yser_ypcr_RS, asym.pcr.prob)
            npcr_asym_V_yser_ypcr_RS<- asym_V_yser_ypcr_RS-ypcr_asym_V_yser_ypcr_RS
            wan_V_yser_ypcr_RS<- lea_V_yser_ypcr_RS - fpinc_V_yser_ypcr_RS 
          }
          #WS
          if(p.leave.ws > 0){
            lea_V_yser_ypcr_WS<- rbinom(ncat, V_yser_ypcr_WS, p.leave.ws)
            inc_V_yser_ypcr_WS<- rbinom(ncat, lea_V_yser_ypcr_WS, (p.inf*si.w)/p.leave.ws)
            sym_V_yser_ypcr_WS<- rbinom(ncat, inc_V_yser_ypcr_WS, (1-pa)*ss.w)
            asym_V_yser_ypcr_WS<- inc_V_yser_ypcr_WS-sym_V_yser_ypcr_WS
            ypcr_asym_V_yser_ypcr_WS<- rbinom(ncat, asym_V_yser_ypcr_WS, asym.pcr.prob)
            npcr_asym_V_yser_ypcr_WS<- asym_V_yser_ypcr_WS-ypcr_asym_V_yser_ypcr_WS
            fp_V_yser_ypcr_WS<- lea_V_yser_ypcr_WS-inc_V_yser_ypcr_WS
          }
          #RAps
          if (p.leave.ra > 0)  {
            lea_V_yser_ypcr_RAps<- rbinom(ncat, V_yser_ypcr_RAps, p.leave.ra)
            fpinc_V_yser_ypcr_RAps<- rbinom(ncat, lea_V_yser_ypcr_RAps, p.fp.inc.ra/p.leave.ra)
            fp_V_yser_ypcr_RAps<- rbinom(ncat, fpinc_V_yser_ypcr_RAps, p.fp/p.fp.inc.ra)
            inc_V_yser_ypcr_RAps<- fpinc_V_yser_ypcr_RAps-fp_V_yser_ypcr_RAps
            sym_V_yser_ypcr_RAps<- rbinom(ncat,inc_V_yser_ypcr_RAps, (1-pa)*as.r)
            asym_V_yser_ypcr_RAps<- inc_V_yser_ypcr_RAps-sym_V_yser_ypcr_RAps
            ypcr_asym_V_yser_ypcr_RAps<- rbinom(ncat, asym_V_yser_ypcr_RAps, asym.pcr.prob)
            npcr_asym_V_yser_ypcr_RAps<- asym_V_yser_ypcr_RAps-ypcr_asym_V_yser_ypcr_RAps
            wan_V_yser_ypcr_RAps<- lea_V_yser_ypcr_RAps - fpinc_V_yser_ypcr_RAps 
          } 
          #WAps
          if(p.leave.wa > 0){
            lea_V_yser_ypcr_WAps<- rbinom(ncat, V_yser_ypcr_WAps, p.leave.wa)
            inc_V_yser_ypcr_WAps<- rbinom(ncat, lea_V_yser_ypcr_WAps, (p.inf*ai.w)/p.leave.wa)
            sym_V_yser_ypcr_WAps<- rbinom(ncat, inc_V_yser_ypcr_WAps, (1-pa)*as.w)
            asym_V_yser_ypcr_WAps<- inc_V_yser_ypcr_WAps-sym_V_yser_ypcr_WAps
            ypcr_asym_V_yser_ypcr_WAps<- rbinom(ncat, asym_V_yser_ypcr_WAps, asym.pcr.prob)
            npcr_asym_V_yser_ypcr_WAps<- asym_V_yser_ypcr_WAps-ypcr_asym_V_yser_ypcr_WAps
            fp_V_yser_ypcr_WAps<- lea_V_yser_ypcr_WAps-inc_V_yser_ypcr_WAps
          }      
              
      #update state variables
              
      #1. not pcr detected  
              
        V_yser_npcr_V<-                 V_yser_npcr_V - wan_V_yser_npcr_V - inc_V_yser_npcr_V - fp_V_yser_npcr_V
        V_yser_npcr_IAns[1,]<-          V_yser_npcr_IAns[1,] + npcr_asym_V_yser_npcr_V + npcr_asym_V_yser_npcr_S  - rec_V_yser_npcr_IAns[1,]
        V_yser_npcr_IAns[2:6,]<-        V_yser_npcr_IAns[2:6,] + rec_V_yser_npcr_IAns[1:5,] - rec_V_yser_npcr_IAns[2:6,] 
        V_yser_npcr_IAns[7,]<-          V_yser_npcr_IAns[7,] + rec_V_yser_npcr_IAns[6,] - rec_V_yser_npcr_IAns[7,] + npcr_asym_V_yser_npcr_WAns 
        V_yser_npcr_IAns[8:n.inf.com,]<-V_yser_npcr_IAns[8:n.inf.com,] + rec_V_yser_npcr_IAns[7:(n.inf.com-1),] - rec_V_yser_npcr_IAns[8:n.inf.com,] 
        V_yser_npcr_RAns<-              V_yser_npcr_RAns + rec.ab_V_yser_npcr_IAns - sym_V_yser_npcr_RAns - ypcr_asym_V_yser_npcr_RAns - wan_V_yser_npcr_RAns - fp_V_yser_npcr_RAns 
        V_yser_npcr_WAns<-              V_yser_npcr_WAns + (rec_V_yser_npcr_IAns[n.inf.com,] - rec.ab_V_yser_npcr_IAns) + wan_V_yser_npcr_RAns - inc_V_yser_npcr_WAns - fp_V_yser_npcr_WAns 
        V_yser_npcr_S<-                 V_yser_npcr_S + wan_V_yser_npcr_V - inc_V_yser_npcr_S - fp_V_yser_npcr_S 
        V_yser_npcr_IS[1,]<-            V_yser_npcr_IS[1,] + sym_V_yser_npcr_S + sym_V_yser_npcr_V - rec_V_yser_npcr_IS[1,]
        V_yser_npcr_IS[2:6,]<-          V_yser_npcr_IS[2:6,] + rec_V_yser_npcr_IS[1:5,] - rec_V_yser_npcr_IS[2:6,]
        V_yser_npcr_IS[7,]<-            V_yser_npcr_IS[7,] + rec_V_yser_npcr_IS[6,] - rec_V_yser_npcr_IS[7,] + sym_V_yser_npcr_WAns + sym_V_yser_npcr_WS + sym_V_yser_npcr_WAps
        V_yser_npcr_IS[8:n.inf.com,]<-  V_yser_npcr_IS[8:n.inf.com,] + rec_V_yser_npcr_IS[7:(n.inf.com-1),] - rec_V_yser_npcr_IS[8:n.inf.com,]
        V_yser_npcr_RS<-                V_yser_npcr_RS + rec.ab_V_yser_npcr_IS + sym_V_yser_npcr_RAns + sym_V_yser_npcr_RAps - wan_V_yser_npcr_RS - asym_V_yser_npcr_RS - fp_V_yser_npcr_RS 
        V_yser_npcr_WS<-                V_yser_npcr_WS + (rec_V_yser_npcr_IS[n.inf.com,] - rec.ab_V_yser_npcr_IS) + wan_V_yser_npcr_RS - inc_V_yser_npcr_WS - fp_V_yser_npcr_WS 
        V_yser_npcr_IAps[1,]<-          V_yser_npcr_IAps[1,] - rec_V_yser_npcr_IAps[1,] 
        V_yser_npcr_IAps[2:6,]<-        V_yser_npcr_IAps[2:6,] + rec_V_yser_npcr_IAps[1:5,] - rec_V_yser_npcr_IAps[2:6,]
        V_yser_npcr_IAps[7,]<-          V_yser_npcr_IAps[7,] + rec_V_yser_npcr_IAps[6,] - rec_V_yser_npcr_IAps[7,] + npcr_asym_V_yser_npcr_WAps +  npcr_asym_V_yser_npcr_WS 
        V_yser_npcr_IAps[8:n.inf.com,]<-V_yser_npcr_IAps[8:n.inf.com,] + rec_V_yser_npcr_IAps[7:(n.inf.com-1),] - rec_V_yser_npcr_IAps[8:n.inf.com,] 
        V_yser_npcr_RAps<-              V_yser_npcr_RAps + rec.ab_V_yser_npcr_IAps + npcr_asym_V_yser_npcr_RS - sym_V_yser_npcr_RAps - wan_V_yser_npcr_RAps - fp_V_yser_npcr_RAps - ypcr_asym_V_yser_npcr_RAps 
        V_yser_npcr_WAps<-              V_yser_npcr_WAps + (rec_V_yser_npcr_IAps[n.inf.com,] - rec.ab_V_yser_npcr_IAps) + wan_V_yser_npcr_RAps - inc_V_yser_npcr_WAps - fp_V_yser_npcr_WAps 

      #2. yes pcr detected
        
        V_yser_ypcr_V<-                 V_yser_ypcr_V - wan_V_yser_ypcr_V - inc_V_yser_ypcr_V + fp_V_yser_npcr_V
        V_yser_ypcr_IAns[1,]<-          V_yser_ypcr_IAns[1,] + ypcr_asym_V_yser_npcr_V + ypcr_asym_V_yser_npcr_S + asym_V_yser_ypcr_V + asym_V_yser_ypcr_S - rec_V_yser_ypcr_IAns[1,]
        V_yser_ypcr_IAns[2:6,]<-        V_yser_ypcr_IAns[2:6,] + rec_V_yser_ypcr_IAns[1:5,] - rec_V_yser_ypcr_IAns[2:6,]
        V_yser_ypcr_IAns[7,]<-          V_yser_ypcr_IAns[7,] + rec_V_yser_ypcr_IAns[6,] - rec_V_yser_ypcr_IAns[7,] + ypcr_asym_V_yser_npcr_WAns + asym_V_yser_ypcr_WAns 
        V_yser_ypcr_IAns[8:n.inf.com,]<-V_yser_ypcr_IAns[8:n.inf.com,] + rec_V_yser_ypcr_IAns[7:(n.inf.com-1),] - rec_V_yser_ypcr_IAns[8:n.inf.com,] 
        V_yser_ypcr_RAns<-              V_yser_ypcr_RAns + rec.ab_V_yser_ypcr_IAns + fp_V_yser_npcr_RAns + ypcr_asym_V_yser_npcr_RAns - sym_V_yser_ypcr_RAns - wan_V_yser_ypcr_RAns  
        V_yser_ypcr_WAns<-              V_yser_ypcr_WAns + (rec_V_yser_ypcr_IAns[n.inf.com,] - rec.ab_V_yser_ypcr_IAns) + wan_V_yser_ypcr_RAns + fp_V_yser_npcr_WAns - inc_V_yser_ypcr_WAns 
        V_yser_ypcr_S<-                 V_yser_ypcr_S + wan_V_yser_ypcr_V + fp_V_yser_npcr_S - inc_V_yser_ypcr_S 
        V_yser_ypcr_IS[1,]<-            V_yser_ypcr_IS[1,] + sym_V_yser_ypcr_S + sym_V_yser_ypcr_V - rec_V_yser_ypcr_IS[1,] 
        V_yser_ypcr_IS[2:6,]<-          V_yser_ypcr_IS[2:6,] + rec_V_yser_ypcr_IS[1:5,] - rec_V_yser_ypcr_IS[2:6,] 
        V_yser_ypcr_IS[7,]<-            V_yser_ypcr_IS[7,] + rec_V_yser_ypcr_IS[6,] - rec_V_yser_ypcr_IS[7,] + sym_V_yser_ypcr_WAns + sym_V_yser_ypcr_WS + sym_V_yser_ypcr_WAps
        V_yser_ypcr_IS[8:n.inf.com,]<-  V_yser_ypcr_IS[8:n.inf.com,] + rec_V_yser_ypcr_IS[7:(n.inf.com-1),] - rec_V_yser_ypcr_IS[8:n.inf.com,]
        V_yser_ypcr_RS<-                V_yser_ypcr_RS + rec.ab_V_yser_ypcr_IS + sym_V_yser_ypcr_RAns + sym_V_yser_ypcr_RAps - wan_V_yser_ypcr_RS - asym_V_yser_ypcr_RS + fp_V_yser_npcr_RS 
        V_yser_ypcr_WS<-                V_yser_ypcr_WS + (rec_V_yser_ypcr_IS[n.inf.com,] - rec.ab_V_yser_ypcr_IS) + wan_V_yser_ypcr_RS + fp_V_yser_npcr_WS - inc_V_yser_ypcr_WS  
        V_yser_ypcr_IAps[1,]<-          V_yser_ypcr_IAps[1,] - rec_V_yser_ypcr_IAps[1,] 
        V_yser_ypcr_IAps[2:6,]<-        V_yser_ypcr_IAps[2:6,] + rec_V_yser_ypcr_IAps[1:5,] - rec_V_yser_ypcr_IAps[2:6,] 
        V_yser_ypcr_IAps[7,]<-          V_yser_ypcr_IAps[7,] + rec_V_yser_ypcr_IAps[6,] - rec_V_yser_ypcr_IAps[7,] + asym_V_yser_ypcr_WAps + asym_V_yser_ypcr_WS + ypcr_asym_V_yser_npcr_WAps + ypcr_asym_V_yser_npcr_WS 
        V_yser_ypcr_IAps[8:n.inf.com,]<-V_yser_ypcr_IAps[8:n.inf.com,] + rec_V_yser_ypcr_IAps[7:(n.inf.com-1),] - rec_V_yser_ypcr_IAps[8:n.inf.com,]
        V_yser_ypcr_RAps<-              V_yser_ypcr_RAps + rec.ab_V_yser_ypcr_IAps + ypcr_asym_V_yser_npcr_RS + ypcr_asym_V_yser_npcr_RAps + fp_V_yser_npcr_RAps + asym_V_yser_ypcr_RS - sym_V_yser_ypcr_RAps - wan_V_yser_ypcr_RAps 
        V_yser_ypcr_WAps<-              V_yser_ypcr_WAps + (rec_V_yser_ypcr_IAps[n.inf.com,] - rec.ab_V_yser_ypcr_IAps) + wan_V_yser_ypcr_RAps + fp_V_yser_npcr_WAps - inc_V_yser_ypcr_WAps 
    
            
  # UNVACCINATED - not serology-detected #
      #incidences
      
      #1. not PCR-detected
          #S
          if (p.leave.s > 0){
            lea_U_nser_npcr_S<- rbinom(ncat,U_nser_npcr_S, p.leave.s)
            inc_U_nser_npcr_S<- rbinom(ncat,lea_U_nser_npcr_S, p.inf/p.leave.s)
            sym_U_nser_npcr_S<- rbinom(ncat,inc_U_nser_npcr_S, (1-pa))
            asym_U_nser_npcr_S<- inc_U_nser_npcr_S-sym_U_nser_npcr_S
            ypcr_asym_U_nser_npcr_S<- rbinom(ncat, asym_U_nser_npcr_S, asym.pcr.prob)
            npcr_asym_U_nser_npcr_S<- asym_U_nser_npcr_S-ypcr_asym_U_nser_npcr_S
            fp_U_nser_npcr_S <- lea_U_nser_npcr_S - inc_U_nser_npcr_S
          }
          #IAns/IS/IAps
          for (i in 1:n.inf.com) { 
            rec_U_nser_npcr_IAns[i,]<- rbinom(ncat,U_nser_npcr_IAns[i,], rec*rec.asym)
            rec_U_nser_npcr_IS[i,]<- rbinom(ncat,U_nser_npcr_IS[i,], rec)
            rec_U_nser_npcr_IAps[i,]<- rbinom(ncat,U_nser_npcr_IAps[i,], rec*rec.asym)
          }
            rec.ab_U_nser_npcr_IAns<- rbinom(ncat, rec_U_nser_npcr_IAns[n.inf.com,], p.antibod.asym)
            rec.ab_U_nser_npcr_IAps<- rbinom(ncat, rec_U_nser_npcr_IAps[n.inf.com,], p.antibod.sym)
            rec.ab_U_nser_npcr_IS<- rbinom(ncat, rec_U_nser_npcr_IS[n.inf.com,], p.antibod.sym)
          
          #RAns
          if (p.leave.ra > 0)  {
            lea_U_nser_npcr_RAns<- rbinom(ncat, U_nser_npcr_RAns, p.leave.ra)
            fpinc_U_nser_npcr_RAns<- rbinom(ncat, lea_U_nser_npcr_RAns, p.fp.inc.ra/p.leave.ra)
            fp_U_nser_npcr_RAns<- rbinom(ncat, fpinc_U_nser_npcr_RAns, p.fp/p.fp.inc.ra)
            inc_U_nser_npcr_RAns<- fpinc_U_nser_npcr_RAns-fp_U_nser_npcr_RAns
            sym_U_nser_npcr_RAns<- rbinom(ncat,inc_U_nser_npcr_RAns, (1-pa)*as.r)
            asym_U_nser_npcr_RAns<- inc_U_nser_npcr_RAns-sym_U_nser_npcr_RAns
            ypcr_asym_U_nser_npcr_RAns<- rbinom(ncat, asym_U_nser_npcr_RAns, asym.pcr.prob)
            npcr_asym_U_nser_npcr_RAns<- asym_U_nser_npcr_RAns-ypcr_asym_U_nser_npcr_RAns
            wan_U_nser_npcr_RAns<- lea_U_nser_npcr_RAns - fpinc_U_nser_npcr_RAns
          }
          #WAns 
          if(p.leave.wa > 0){
            lea_U_nser_npcr_WAns<- rbinom(ncat, U_nser_npcr_WAns, p.leave.wa)
            inc_U_nser_npcr_WAns<- rbinom(ncat, lea_U_nser_npcr_WAns, (p.inf*ai.w)/p.leave.wa)
            sym_U_nser_npcr_WAns<- rbinom(ncat, inc_U_nser_npcr_WAns, (1-pa)*as.w)
            asym_U_nser_npcr_WAns<- inc_U_nser_npcr_WAns-sym_U_nser_npcr_WAns
            ypcr_asym_U_nser_npcr_WAns<- rbinom(ncat, asym_U_nser_npcr_WAns, asym.pcr.prob)
            npcr_asym_U_nser_npcr_WAns<- asym_U_nser_npcr_WAns-ypcr_asym_U_nser_npcr_WAns
            fp_U_nser_npcr_WAns<- lea_U_nser_npcr_WAns-inc_U_nser_npcr_WAns
          }
          #RS
          if (p.leave.rs > 0)  {
            lea_U_nser_npcr_RS<- rbinom(ncat, U_nser_npcr_RS, p.leave.rs)
            fpinc_U_nser_npcr_RS<- rbinom(ncat, lea_U_nser_npcr_RS, p.fp.inc.rs/p.leave.rs)
            fp_U_nser_npcr_RS<- rbinom(ncat, fpinc_U_nser_npcr_RS, p.fp/p.fp.inc.rs)
            inc_U_nser_npcr_RS<- fpinc_U_nser_npcr_RS-fp_U_nser_npcr_RS
            sym_U_nser_npcr_RS<- rbinom(ncat,inc_U_nser_npcr_RS, (1-pa)*as.r)
            asym_U_nser_npcr_RS<- inc_U_nser_npcr_RS-sym_U_nser_npcr_RS
            ypcr_asym_U_nser_npcr_RS<- rbinom(ncat, asym_U_nser_npcr_RS, asym.pcr.prob)
            npcr_asym_U_nser_npcr_RS<- asym_U_nser_npcr_RS-ypcr_asym_U_nser_npcr_RS
            wan_U_nser_npcr_RS<- lea_U_nser_npcr_RS - fpinc_U_nser_npcr_RS 
          }
          #WS
          if(p.leave.ws > 0){
            lea_U_nser_npcr_WS<- rbinom(ncat, U_nser_npcr_WS, p.leave.ws)
            inc_U_nser_npcr_WS<- rbinom(ncat, lea_U_nser_npcr_WS, (p.inf*si.w)/p.leave.ws)
            sym_U_nser_npcr_WS<- rbinom(ncat, inc_U_nser_npcr_WS, (1-pa)*ss.w)
            asym_U_nser_npcr_WS<- inc_U_nser_npcr_WS-sym_U_nser_npcr_WS
            ypcr_asym_U_nser_npcr_WS<- rbinom(ncat, asym_U_nser_npcr_WS, asym.pcr.prob)
            npcr_asym_U_nser_npcr_WS<- asym_U_nser_npcr_WS-ypcr_asym_U_nser_npcr_WS
            fp_U_nser_npcr_WS<- lea_U_nser_npcr_WS-inc_U_nser_npcr_WS
          }
          #RAps
          if (p.leave.ra > 0)  {
            lea_U_nser_npcr_RAps<- rbinom(ncat, U_nser_npcr_RAps, p.leave.ra)
            fpinc_U_nser_npcr_RAps<- rbinom(ncat, lea_U_nser_npcr_RAps, p.fp.inc.ra/p.leave.ra)
            fp_U_nser_npcr_RAps<- rbinom(ncat, fpinc_U_nser_npcr_RAps, p.fp/p.fp.inc.ra)
            inc_U_nser_npcr_RAps<- fpinc_U_nser_npcr_RAps-fp_U_nser_npcr_RAps
            sym_U_nser_npcr_RAps<- rbinom(ncat,inc_U_nser_npcr_RAps, (1-pa)*as.r)
            asym_U_nser_npcr_RAps<- inc_U_nser_npcr_RAps-sym_U_nser_npcr_RAps
            ypcr_asym_U_nser_npcr_RAps<- rbinom(ncat, asym_U_nser_npcr_RAps, asym.pcr.prob)
            npcr_asym_U_nser_npcr_RAps<- asym_U_nser_npcr_RAps-ypcr_asym_U_nser_npcr_RAps
            wan_U_nser_npcr_RAps<- lea_U_nser_npcr_RAps - fpinc_U_nser_npcr_RAps 
          } 
          #WAps
          if(p.leave.wa > 0){
            lea_U_nser_npcr_WAps<- rbinom(ncat, U_nser_npcr_WAps, p.leave.wa)
            inc_U_nser_npcr_WAps<- rbinom(ncat, lea_U_nser_npcr_WAps, (p.inf*ai.w)/p.leave.wa)
            sym_U_nser_npcr_WAps<- rbinom(ncat, inc_U_nser_npcr_WAps, (1-pa)*as.w)
            asym_U_nser_npcr_WAps<- inc_U_nser_npcr_WAps-sym_U_nser_npcr_WAps
            ypcr_asym_U_nser_npcr_WAps<- rbinom(ncat, asym_U_nser_npcr_WAps, asym.pcr.prob)
            npcr_asym_U_nser_npcr_WAps<- asym_U_nser_npcr_WAps-ypcr_asym_U_nser_npcr_WAps
            fp_U_nser_npcr_WAps<- lea_U_nser_npcr_WAps-inc_U_nser_npcr_WAps
          }
     
        #2. yes PCR-detected
          #S
          if (p.leave.s > 0){
            lea_U_nser_ypcr_S<- rbinom(ncat,U_nser_ypcr_S, p.leave.s)
            inc_U_nser_ypcr_S<- rbinom(ncat,lea_U_nser_ypcr_S, p.inf/p.leave.s)
            sym_U_nser_ypcr_S<- rbinom(ncat,inc_U_nser_ypcr_S, (1-pa))
            asym_U_nser_ypcr_S<- inc_U_nser_ypcr_S-sym_U_nser_ypcr_S
            ypcr_asym_U_nser_ypcr_S<- rbinom(ncat, asym_U_nser_ypcr_S, asym.pcr.prob)
            npcr_asym_U_nser_ypcr_S<- asym_U_nser_ypcr_S-ypcr_asym_U_nser_ypcr_S
            fp_U_nser_ypcr_S <- lea_U_nser_ypcr_S - inc_U_nser_ypcr_S
          }
          #IAns/IS/IAps
          for (i in 1:n.inf.com) { 
            rec_U_nser_ypcr_IAns[i,]<- rbinom(ncat,U_nser_ypcr_IAns[i,], rec*rec.asym)
            rec_U_nser_ypcr_IS[i,]<- rbinom(ncat,U_nser_ypcr_IS[i,], rec)
            rec_U_nser_ypcr_IAps[i,]<- rbinom(ncat,U_nser_ypcr_IAps[i,], rec*rec.asym)
          }
            rec.ab_U_nser_ypcr_IAns<- rbinom(ncat, rec_U_nser_ypcr_IAns[n.inf.com,], p.antibod.asym)
            rec.ab_U_nser_ypcr_IAps<- rbinom(ncat, rec_U_nser_ypcr_IAps[n.inf.com,], p.antibod.sym)
            rec.ab_U_nser_ypcr_IS<- rbinom(ncat, rec_U_nser_ypcr_IS[n.inf.com,], p.antibod.sym)
          
          #RAns
          if (p.leave.ra > 0)  {
            lea_U_nser_ypcr_RAns<- rbinom(ncat, U_nser_ypcr_RAns, p.leave.ra)
            fpinc_U_nser_ypcr_RAns<- rbinom(ncat, lea_U_nser_ypcr_RAns, p.fp.inc.ra/p.leave.ra)
            fp_U_nser_ypcr_RAns<- rbinom(ncat, fpinc_U_nser_ypcr_RAns, p.fp/p.fp.inc.ra)
            inc_U_nser_ypcr_RAns<- fpinc_U_nser_ypcr_RAns-fp_U_nser_ypcr_RAns
            sym_U_nser_ypcr_RAns<- rbinom(ncat,inc_U_nser_ypcr_RAns, (1-pa)*as.r)
            asym_U_nser_ypcr_RAns<- inc_U_nser_ypcr_RAns-sym_U_nser_ypcr_RAns
            ypcr_asym_U_nser_ypcr_RAns<- rbinom(ncat, asym_U_nser_ypcr_RAns, asym.pcr.prob)
            npcr_asym_U_nser_ypcr_RAns<- asym_U_nser_ypcr_RAns-ypcr_asym_U_nser_ypcr_RAns
            wan_U_nser_ypcr_RAns<- lea_U_nser_ypcr_RAns - fpinc_U_nser_ypcr_RAns 
          }
          #WAns 
          if(p.leave.wa > 0){
            lea_U_nser_ypcr_WAns<- rbinom(ncat, U_nser_ypcr_WAns, p.leave.wa)
            inc_U_nser_ypcr_WAns<- rbinom(ncat, lea_U_nser_ypcr_WAns, (p.inf*ai.w)/p.leave.wa)
            sym_U_nser_ypcr_WAns<- rbinom(ncat, inc_U_nser_ypcr_WAns, (1-pa)*as.w)
            asym_U_nser_ypcr_WAns<- inc_U_nser_ypcr_WAns-sym_U_nser_ypcr_WAns
            ypcr_asym_U_nser_ypcr_WAns<- rbinom(ncat, asym_U_nser_ypcr_WAns, asym.pcr.prob)
            npcr_asym_U_nser_ypcr_WAns<- asym_U_nser_ypcr_WAns-ypcr_asym_U_nser_ypcr_WAns
            fp_U_nser_ypcr_WAns<- lea_U_nser_ypcr_WAns-inc_U_nser_ypcr_WAns
          }
          #RS
          if (p.leave.rs > 0)  {
            lea_U_nser_ypcr_RS<- rbinom(ncat, U_nser_ypcr_RS, p.leave.rs)
            fpinc_U_nser_ypcr_RS<- rbinom(ncat, lea_U_nser_ypcr_RS, p.fp.inc.rs/p.leave.rs)
            fp_U_nser_ypcr_RS<- rbinom(ncat, fpinc_U_nser_ypcr_RS, p.fp/p.fp.inc.rs)
            inc_U_nser_ypcr_RS<- fpinc_U_nser_ypcr_RS-fp_U_nser_ypcr_RS
            sym_U_nser_ypcr_RS<- rbinom(ncat,inc_U_nser_ypcr_RS, (1-pa)*as.r)
            asym_U_nser_ypcr_RS<- inc_U_nser_ypcr_RS-sym_U_nser_ypcr_RS
            ypcr_asym_U_nser_ypcr_RS<- rbinom(ncat, asym_U_nser_ypcr_RS, asym.pcr.prob)
            npcr_asym_U_nser_ypcr_RS<- asym_U_nser_ypcr_RS-ypcr_asym_U_nser_ypcr_RS
            wan_U_nser_ypcr_RS<- lea_U_nser_ypcr_RS - fpinc_U_nser_ypcr_RS 
          }
          #WS
          if(p.leave.ws > 0){
            lea_U_nser_ypcr_WS<- rbinom(ncat, U_nser_ypcr_WS, p.leave.ws)
            inc_U_nser_ypcr_WS<- rbinom(ncat, lea_U_nser_ypcr_WS, (p.inf*si.w)/p.leave.ws)
            sym_U_nser_ypcr_WS<- rbinom(ncat, inc_U_nser_ypcr_WS, (1-pa)*ss.w)
            asym_U_nser_ypcr_WS<- inc_U_nser_ypcr_WS-sym_U_nser_ypcr_WS
            ypcr_asym_U_nser_ypcr_WS<- rbinom(ncat, asym_U_nser_ypcr_WS, asym.pcr.prob)
            npcr_asym_U_nser_ypcr_WS<- asym_U_nser_ypcr_WS-ypcr_asym_U_nser_ypcr_WS
            fp_U_nser_ypcr_WS<- lea_U_nser_ypcr_WS-inc_U_nser_ypcr_WS
          }
          #RAps
          if (p.leave.ra > 0)  {
            lea_U_nser_ypcr_RAps<- rbinom(ncat, U_nser_ypcr_RAps, p.leave.ra)
            fpinc_U_nser_ypcr_RAps<- rbinom(ncat, lea_U_nser_ypcr_RAps, p.fp.inc.ra/p.leave.ra)
            fp_U_nser_ypcr_RAps<- rbinom(ncat, fpinc_U_nser_ypcr_RAps, p.fp/p.fp.inc.ra)
            inc_U_nser_ypcr_RAps<- fpinc_U_nser_ypcr_RAps-fp_U_nser_ypcr_RAps
            sym_U_nser_ypcr_RAps<- rbinom(ncat,inc_U_nser_ypcr_RAps, (1-pa)*as.r)
            asym_U_nser_ypcr_RAps<- inc_U_nser_ypcr_RAps-sym_U_nser_ypcr_RAps
            ypcr_asym_U_nser_ypcr_RAps<- rbinom(ncat, asym_U_nser_ypcr_RAps, asym.pcr.prob)
            npcr_asym_U_nser_ypcr_RAps<- asym_U_nser_ypcr_RAps-ypcr_asym_U_nser_ypcr_RAps
            wan_U_nser_ypcr_RAps<- lea_U_nser_ypcr_RAps - fpinc_U_nser_ypcr_RAps 
          } 
          #WAps
          if(p.leave.wa > 0){
            lea_U_nser_ypcr_WAps<- rbinom(ncat, U_nser_ypcr_WAps, p.leave.wa)
            inc_U_nser_ypcr_WAps<- rbinom(ncat, lea_U_nser_ypcr_WAps, (p.inf*ai.w)/p.leave.wa)
            sym_U_nser_ypcr_WAps<- rbinom(ncat, inc_U_nser_ypcr_WAps, (1-pa)*as.w)
            asym_U_nser_ypcr_WAps<- inc_U_nser_ypcr_WAps-sym_U_nser_ypcr_WAps
            ypcr_asym_U_nser_ypcr_WAps<- rbinom(ncat, asym_U_nser_ypcr_WAps, asym.pcr.prob)
            npcr_asym_U_nser_ypcr_WAps<- asym_U_nser_ypcr_WAps-ypcr_asym_U_nser_ypcr_WAps
            fp_U_nser_ypcr_WAps<- lea_U_nser_ypcr_WAps-inc_U_nser_ypcr_WAps
          }      
              
      #update state variables
              
      #1. not pcr detected  
              
        U_nser_npcr_IAns[1,]<-          U_nser_npcr_IAns[1,] + npcr_asym_U_nser_npcr_S  - rec_U_nser_npcr_IAns[1,]
        U_nser_npcr_IAns[2:6,]<-        U_nser_npcr_IAns[2:6,] + rec_U_nser_npcr_IAns[1:5,] - rec_U_nser_npcr_IAns[2:6,] 
        U_nser_npcr_IAns[7,]<-          U_nser_npcr_IAns[7,] + rec_U_nser_npcr_IAns[6,] - rec_U_nser_npcr_IAns[7,] + npcr_asym_U_nser_npcr_WAns 
        U_nser_npcr_IAns[8:n.inf.com,]<-U_nser_npcr_IAns[8:n.inf.com,] + rec_U_nser_npcr_IAns[7:(n.inf.com-1),] - rec_U_nser_npcr_IAns[8:n.inf.com,] 
        U_nser_npcr_RAns<-              U_nser_npcr_RAns + rec.ab_U_nser_npcr_IAns - sym_U_nser_npcr_RAns - ypcr_asym_U_nser_npcr_RAns - wan_U_nser_npcr_RAns - fp_U_nser_npcr_RAns 
        U_nser_npcr_WAns<-              U_nser_npcr_WAns + (rec_U_nser_npcr_IAns[n.inf.com,] - rec.ab_U_nser_npcr_IAns) + wan_U_nser_npcr_RAns - inc_U_nser_npcr_WAns - fp_U_nser_npcr_WAns 
        U_nser_npcr_S<-                 U_nser_npcr_S - inc_U_nser_npcr_S - fp_U_nser_npcr_S 
        U_nser_npcr_IS[1,]<-            U_nser_npcr_IS[1,] + sym_U_nser_npcr_S - rec_U_nser_npcr_IS[1,] 
        U_nser_npcr_IS[2:6,]<-          U_nser_npcr_IS[2:6,] + rec_U_nser_npcr_IS[1:5,] - rec_U_nser_npcr_IS[2:6,]
        U_nser_npcr_IS[7,]<-            U_nser_npcr_IS[7,] + rec_U_nser_npcr_IS[6,] - rec_U_nser_npcr_IS[7,] + sym_U_nser_npcr_WAns + sym_U_nser_npcr_WS + sym_U_nser_npcr_WAps
        U_nser_npcr_IS[8:n.inf.com,]<-  U_nser_npcr_IS[8:n.inf.com,] + rec_U_nser_npcr_IS[7:(n.inf.com-1),] - rec_U_nser_npcr_IS[8:n.inf.com,]
        U_nser_npcr_RS<-                U_nser_npcr_RS + rec.ab_U_nser_npcr_IS + sym_U_nser_npcr_RAns + sym_U_nser_npcr_RAps - wan_U_nser_npcr_RS - asym_U_nser_npcr_RS - fp_U_nser_npcr_RS 
        U_nser_npcr_WS<-                U_nser_npcr_WS + (rec_U_nser_npcr_IS[n.inf.com,] - rec.ab_U_nser_npcr_IS) + wan_U_nser_npcr_RS - inc_U_nser_npcr_WS - fp_U_nser_npcr_WS 
        U_nser_npcr_IAps[1,]<-          U_nser_npcr_IAps[1,] - rec_U_nser_npcr_IAps[1,] 
        U_nser_npcr_IAps[2:6,]<-        U_nser_npcr_IAps[2:6,] + rec_U_nser_npcr_IAps[1:5,] - rec_U_nser_npcr_IAps[2:6,]
        U_nser_npcr_IAps[7,]<-          U_nser_npcr_IAps[7,] + rec_U_nser_npcr_IAps[6,] - rec_U_nser_npcr_IAps[7,] + npcr_asym_U_nser_npcr_WAps +  npcr_asym_U_nser_npcr_WS 
        U_nser_npcr_IAps[8:n.inf.com,]<-U_nser_npcr_IAps[8:n.inf.com,] + rec_U_nser_npcr_IAps[7:(n.inf.com-1),] - rec_U_nser_npcr_IAps[8:n.inf.com,] 
        U_nser_npcr_RAps<-              U_nser_npcr_RAps + rec.ab_U_nser_npcr_IAps + npcr_asym_U_nser_npcr_RS - sym_U_nser_npcr_RAps - wan_U_nser_npcr_RAps - fp_U_nser_npcr_RAps - ypcr_asym_U_nser_npcr_RAps 
        U_nser_npcr_WAps<-              U_nser_npcr_WAps + (rec_U_nser_npcr_IAps[n.inf.com,] - rec.ab_U_nser_npcr_IAps) + wan_U_nser_npcr_RAps - inc_U_nser_npcr_WAps - fp_U_nser_npcr_WAps 

      #2. yes pcr detected
        
        U_nser_ypcr_IAns[1,]<-          U_nser_ypcr_IAns[1,] + ypcr_asym_U_nser_npcr_S + asym_U_nser_ypcr_S - rec_U_nser_ypcr_IAns[1,]
        U_nser_ypcr_IAns[2:6,]<-        U_nser_ypcr_IAns[2:6,] + rec_U_nser_ypcr_IAns[1:5,] - rec_U_nser_ypcr_IAns[2:6,] 
        U_nser_ypcr_IAns[7,]<-          U_nser_ypcr_IAns[7,] + rec_U_nser_ypcr_IAns[6,] - rec_U_nser_ypcr_IAns[7,] + ypcr_asym_U_nser_npcr_WAns + asym_U_nser_ypcr_WAns 
        U_nser_ypcr_IAns[8:n.inf.com,]<-U_nser_ypcr_IAns[8:n.inf.com,] + rec_U_nser_ypcr_IAns[7:(n.inf.com-1),] - rec_U_nser_ypcr_IAns[8:n.inf.com,] 
        U_nser_ypcr_RAns<-              U_nser_ypcr_RAns + rec.ab_U_nser_ypcr_IAns + fp_U_nser_npcr_RAns + ypcr_asym_U_nser_npcr_RAns - sym_U_nser_ypcr_RAns - wan_U_nser_ypcr_RAns  
        U_nser_ypcr_WAns<-              U_nser_ypcr_WAns + (rec_U_nser_ypcr_IAns[n.inf.com,] - rec.ab_U_nser_ypcr_IAns) + wan_U_nser_ypcr_RAns + fp_U_nser_npcr_WAns - inc_U_nser_ypcr_WAns 
        U_nser_ypcr_S<-                 U_nser_ypcr_S + fp_U_nser_npcr_S - inc_U_nser_ypcr_S 
        U_nser_ypcr_IS[1,]<-            U_nser_ypcr_IS[1,] + sym_U_nser_ypcr_S - rec_U_nser_ypcr_IS[1,] 
        U_nser_ypcr_IS[2:6,]<-          U_nser_ypcr_IS[2:6,] + rec_U_nser_ypcr_IS[1:5,] - rec_U_nser_ypcr_IS[2:6,] 
        U_nser_ypcr_IS[7,]<-            U_nser_ypcr_IS[7,] + rec_U_nser_ypcr_IS[6,] - rec_U_nser_ypcr_IS[7,] + sym_U_nser_ypcr_WAns + sym_U_nser_ypcr_WS + sym_U_nser_ypcr_WAps
        U_nser_ypcr_IS[8:n.inf.com,]<-  U_nser_ypcr_IS[8:n.inf.com,] + rec_U_nser_ypcr_IS[7:(n.inf.com-1),] - rec_U_nser_ypcr_IS[8:n.inf.com,]
        U_nser_ypcr_RS<-                U_nser_ypcr_RS + rec.ab_U_nser_ypcr_IS + sym_U_nser_ypcr_RAns + sym_U_nser_ypcr_RAps - wan_U_nser_ypcr_RS - asym_U_nser_ypcr_RS + fp_U_nser_npcr_RS 
        U_nser_ypcr_WS<-                U_nser_ypcr_WS + (rec_U_nser_ypcr_IS[n.inf.com,] - rec.ab_U_nser_ypcr_IS) + wan_U_nser_ypcr_RS + fp_U_nser_npcr_WS - inc_U_nser_ypcr_WS  
        U_nser_ypcr_IAps[1,]<-          U_nser_ypcr_IAps[1,] - rec_U_nser_ypcr_IAps[1,] 
        U_nser_ypcr_IAps[2:6,]<-        U_nser_ypcr_IAps[2:6,] + rec_U_nser_ypcr_IAps[1:5,] - rec_U_nser_ypcr_IAps[2:6,] 
        U_nser_ypcr_IAps[7,]<-          U_nser_ypcr_IAps[7,] + rec_U_nser_ypcr_IAps[6,] - rec_U_nser_ypcr_IAps[7,] + asym_U_nser_ypcr_WAps + asym_U_nser_ypcr_WS + ypcr_asym_U_nser_npcr_WAps + ypcr_asym_U_nser_npcr_WS 
        U_nser_ypcr_IAps[8:n.inf.com,]<-U_nser_ypcr_IAps[8:n.inf.com,] + rec_U_nser_ypcr_IAps[7:(n.inf.com-1),] - rec_U_nser_ypcr_IAps[8:n.inf.com,]
        U_nser_ypcr_RAps<-              U_nser_ypcr_RAps + rec.ab_U_nser_ypcr_IAps + ypcr_asym_U_nser_npcr_RS + ypcr_asym_U_nser_npcr_RAps + fp_U_nser_npcr_RAps + asym_U_nser_ypcr_RS - sym_U_nser_ypcr_RAps - wan_U_nser_ypcr_RAps 
        U_nser_ypcr_WAps<-              U_nser_ypcr_WAps + (rec_U_nser_ypcr_IAps[n.inf.com,] - rec.ab_U_nser_ypcr_IAps) + wan_U_nser_ypcr_RAps + fp_U_nser_npcr_WAps - inc_U_nser_ypcr_WAps 

         
  # UNVACCINATED - yes serology-detected #
      #incidences
      
      #1. not PCR-detected
          #S
          if (p.leave.s > 0){
            lea_U_yser_npcr_S<- rbinom(ncat,U_yser_npcr_S, p.leave.s)
            inc_U_yser_npcr_S<- rbinom(ncat,lea_U_yser_npcr_S, p.inf/p.leave.s)
            sym_U_yser_npcr_S<- rbinom(ncat,inc_U_yser_npcr_S, (1-pa))
            asym_U_yser_npcr_S<- inc_U_yser_npcr_S-sym_U_yser_npcr_S
            ypcr_asym_U_yser_npcr_S<- rbinom(ncat, asym_U_yser_npcr_S, asym.pcr.prob)
            npcr_asym_U_yser_npcr_S<- asym_U_yser_npcr_S-ypcr_asym_U_yser_npcr_S
            fp_U_yser_npcr_S <- lea_U_yser_npcr_S - inc_U_yser_npcr_S
          }
          #IAns/IS/IAps
          for (i in 1:n.inf.com) { 
            rec_U_yser_npcr_IAns[i,]<- rbinom(ncat,U_yser_npcr_IAns[i,], rec*rec.asym)
            rec_U_yser_npcr_IS[i,]<- rbinom(ncat,U_yser_npcr_IS[i,], rec)
            rec_U_yser_npcr_IAps[i,]<- rbinom(ncat,U_yser_npcr_IAps[i,], rec*rec.asym)
          }
            rec.ab_U_yser_npcr_IAns<- rbinom(ncat, rec_U_yser_npcr_IAns[n.inf.com,], p.antibod.asym)
            rec.ab_U_yser_npcr_IAps<- rbinom(ncat, rec_U_yser_npcr_IAps[n.inf.com,], p.antibod.sym)
            rec.ab_U_yser_npcr_IS<- rbinom(ncat, rec_U_yser_npcr_IS[n.inf.com,], p.antibod.sym)
          
          #RAns
          if (p.leave.ra > 0)  {
            lea_U_yser_npcr_RAns<- rbinom(ncat, U_yser_npcr_RAns, p.leave.ra)
            fpinc_U_yser_npcr_RAns<- rbinom(ncat, lea_U_yser_npcr_RAns, p.fp.inc.ra/p.leave.ra)
            fp_U_yser_npcr_RAns<- rbinom(ncat, fpinc_U_yser_npcr_RAns, p.fp/p.fp.inc.ra)
            inc_U_yser_npcr_RAns<- fpinc_U_yser_npcr_RAns-fp_U_yser_npcr_RAns
            sym_U_yser_npcr_RAns<- rbinom(ncat,inc_U_yser_npcr_RAns, (1-pa)*as.r)
            asym_U_yser_npcr_RAns<- inc_U_yser_npcr_RAns-sym_U_yser_npcr_RAns
            ypcr_asym_U_yser_npcr_RAns<- rbinom(ncat, asym_U_yser_npcr_RAns, asym.pcr.prob)
            npcr_asym_U_yser_npcr_RAns<- asym_U_yser_npcr_RAns-ypcr_asym_U_yser_npcr_RAns
            wan_U_yser_npcr_RAns<- lea_U_yser_npcr_RAns - fpinc_U_yser_npcr_RAns
          }
          #WAns 
          if(p.leave.wa > 0){
            lea_U_yser_npcr_WAns<- rbinom(ncat, U_yser_npcr_WAns, p.leave.wa)
            inc_U_yser_npcr_WAns<- rbinom(ncat, lea_U_yser_npcr_WAns, (p.inf*ai.w)/p.leave.wa)
            sym_U_yser_npcr_WAns<- rbinom(ncat, inc_U_yser_npcr_WAns, (1-pa)*as.w)
            asym_U_yser_npcr_WAns<- inc_U_yser_npcr_WAns-sym_U_yser_npcr_WAns
            ypcr_asym_U_yser_npcr_WAns<- rbinom(ncat, asym_U_yser_npcr_WAns, asym.pcr.prob)
            npcr_asym_U_yser_npcr_WAns<- asym_U_yser_npcr_WAns-ypcr_asym_U_yser_npcr_WAns
            fp_U_yser_npcr_WAns<- lea_U_yser_npcr_WAns-inc_U_yser_npcr_WAns
          }
          #RS
          if (p.leave.rs > 0)  {
            lea_U_yser_npcr_RS<- rbinom(ncat, U_yser_npcr_RS, p.leave.rs)
            fpinc_U_yser_npcr_RS<- rbinom(ncat, lea_U_yser_npcr_RS, p.fp.inc.rs/p.leave.rs)
            fp_U_yser_npcr_RS<- rbinom(ncat, fpinc_U_yser_npcr_RS, p.fp/p.fp.inc.rs)
            inc_U_yser_npcr_RS<- fpinc_U_yser_npcr_RS-fp_U_yser_npcr_RS
            sym_U_yser_npcr_RS<- rbinom(ncat,inc_U_yser_npcr_RS, (1-pa)*as.r)
            asym_U_yser_npcr_RS<- inc_U_yser_npcr_RS-sym_U_yser_npcr_RS
            ypcr_asym_U_yser_npcr_RS<- rbinom(ncat, asym_U_yser_npcr_RS, asym.pcr.prob)
            npcr_asym_U_yser_npcr_RS<- asym_U_yser_npcr_RS-ypcr_asym_U_yser_npcr_RS
            wan_U_yser_npcr_RS<- lea_U_yser_npcr_RS - fpinc_U_yser_npcr_RS 
          }
          #WS
          if(p.leave.ws > 0){
            lea_U_yser_npcr_WS<- rbinom(ncat, U_yser_npcr_WS, p.leave.ws)
            inc_U_yser_npcr_WS<- rbinom(ncat, lea_U_yser_npcr_WS, (p.inf*si.w)/p.leave.ws)
            sym_U_yser_npcr_WS<- rbinom(ncat, inc_U_yser_npcr_WS, (1-pa)*ss.w)
            asym_U_yser_npcr_WS<- inc_U_yser_npcr_WS-sym_U_yser_npcr_WS
            ypcr_asym_U_yser_npcr_WS<- rbinom(ncat, asym_U_yser_npcr_WS, asym.pcr.prob)
            npcr_asym_U_yser_npcr_WS<- asym_U_yser_npcr_WS-ypcr_asym_U_yser_npcr_WS
            fp_U_yser_npcr_WS<- lea_U_yser_npcr_WS-inc_U_yser_npcr_WS
          }
          #RAps
          if (p.leave.ra > 0)  {
            lea_U_yser_npcr_RAps<- rbinom(ncat, U_yser_npcr_RAps, p.leave.ra)
            fpinc_U_yser_npcr_RAps<- rbinom(ncat, lea_U_yser_npcr_RAps, p.fp.inc.ra/p.leave.ra)
            fp_U_yser_npcr_RAps<- rbinom(ncat, fpinc_U_yser_npcr_RAps, p.fp/p.fp.inc.ra)
            inc_U_yser_npcr_RAps<- fpinc_U_yser_npcr_RAps-fp_U_yser_npcr_RAps
            sym_U_yser_npcr_RAps<- rbinom(ncat,inc_U_yser_npcr_RAps, (1-pa)*as.r)
            asym_U_yser_npcr_RAps<- inc_U_yser_npcr_RAps-sym_U_yser_npcr_RAps
            ypcr_asym_U_yser_npcr_RAps<- rbinom(ncat, asym_U_yser_npcr_RAps, asym.pcr.prob)
            npcr_asym_U_yser_npcr_RAps<- asym_U_yser_npcr_RAps-ypcr_asym_U_yser_npcr_RAps
            wan_U_yser_npcr_RAps<- lea_U_yser_npcr_RAps - fpinc_U_yser_npcr_RAps 
          } 
          #WAps
          if(p.leave.wa > 0){
            lea_U_yser_npcr_WAps<- rbinom(ncat, U_yser_npcr_WAps, p.leave.wa)
            inc_U_yser_npcr_WAps<- rbinom(ncat, lea_U_yser_npcr_WAps, (p.inf*ai.w)/p.leave.wa)
            sym_U_yser_npcr_WAps<- rbinom(ncat, inc_U_yser_npcr_WAps, (1-pa)*as.w)
            asym_U_yser_npcr_WAps<- inc_U_yser_npcr_WAps-sym_U_yser_npcr_WAps
            ypcr_asym_U_yser_npcr_WAps<- rbinom(ncat, asym_U_yser_npcr_WAps, asym.pcr.prob)
            npcr_asym_U_yser_npcr_WAps<- asym_U_yser_npcr_WAps-ypcr_asym_U_yser_npcr_WAps
            fp_U_yser_npcr_WAps<- lea_U_yser_npcr_WAps-inc_U_yser_npcr_WAps
          }
     
        #2. yes PCR-detected
          #S
          if (p.leave.s > 0){
            lea_U_yser_ypcr_S<- rbinom(ncat,U_yser_ypcr_S, p.leave.s)
            inc_U_yser_ypcr_S<- rbinom(ncat,lea_U_yser_ypcr_S, p.inf/p.leave.s)
            sym_U_yser_ypcr_S<- rbinom(ncat,inc_U_yser_ypcr_S, (1-pa))
            asym_U_yser_ypcr_S<- inc_U_yser_ypcr_S-sym_U_yser_ypcr_S
            ypcr_asym_U_yser_ypcr_S<- rbinom(ncat, asym_U_yser_ypcr_S, asym.pcr.prob)
            npcr_asym_U_yser_ypcr_S<- asym_U_yser_ypcr_S-ypcr_asym_U_yser_ypcr_S
            fp_U_yser_ypcr_S <- lea_U_yser_ypcr_S - inc_U_yser_ypcr_S
          }
          #IAns/IS/IAps
          for (i in 1:n.inf.com) { 
            rec_U_yser_ypcr_IAns[i,]<- rbinom(ncat,U_yser_ypcr_IAns[i,], rec*rec.asym)
            rec_U_yser_ypcr_IS[i,]<- rbinom(ncat,U_yser_ypcr_IS[i,], rec)
            rec_U_yser_ypcr_IAps[i,]<- rbinom(ncat,U_yser_ypcr_IAps[i,], rec*rec.asym)
          }
            rec.ab_U_yser_ypcr_IAns<- rbinom(ncat, rec_U_yser_ypcr_IAns[n.inf.com,], p.antibod.asym)
            rec.ab_U_yser_ypcr_IAps<- rbinom(ncat, rec_U_yser_ypcr_IAps[n.inf.com,], p.antibod.sym)
            rec.ab_U_yser_ypcr_IS<- rbinom(ncat, rec_U_yser_ypcr_IS[n.inf.com,], p.antibod.sym)
          
          #RAns
          if (p.leave.ra > 0)  {
            lea_U_yser_ypcr_RAns<- rbinom(ncat, U_yser_ypcr_RAns, p.leave.ra)
            fpinc_U_yser_ypcr_RAns<- rbinom(ncat, lea_U_yser_ypcr_RAns, p.fp.inc.ra/p.leave.ra)
            fp_U_yser_ypcr_RAns<- rbinom(ncat, fpinc_U_yser_ypcr_RAns, p.fp/p.fp.inc.ra)
            inc_U_yser_ypcr_RAns<- fpinc_U_yser_ypcr_RAns-fp_U_yser_ypcr_RAns
            sym_U_yser_ypcr_RAns<- rbinom(ncat,inc_U_yser_ypcr_RAns, (1-pa)*as.r)
            asym_U_yser_ypcr_RAns<- inc_U_yser_ypcr_RAns-sym_U_yser_ypcr_RAns
            ypcr_asym_U_yser_ypcr_RAns<- rbinom(ncat, asym_U_yser_ypcr_RAns, asym.pcr.prob)
            npcr_asym_U_yser_ypcr_RAns<- asym_U_yser_ypcr_RAns-ypcr_asym_U_yser_ypcr_RAns
            wan_U_yser_ypcr_RAns<- lea_U_yser_ypcr_RAns - fpinc_U_yser_ypcr_RAns 
          }
          #WAns 
          if(p.leave.wa > 0){
            lea_U_yser_ypcr_WAns<- rbinom(ncat, U_yser_ypcr_WAns, p.leave.wa)
            inc_U_yser_ypcr_WAns<- rbinom(ncat, lea_U_yser_ypcr_WAns, (p.inf*ai.w)/p.leave.wa)
            sym_U_yser_ypcr_WAns<- rbinom(ncat, inc_U_yser_ypcr_WAns, (1-pa)*as.w)
            asym_U_yser_ypcr_WAns<- inc_U_yser_ypcr_WAns-sym_U_yser_ypcr_WAns
            ypcr_asym_U_yser_ypcr_WAns<- rbinom(ncat, asym_U_yser_ypcr_WAns, asym.pcr.prob)
            npcr_asym_U_yser_ypcr_WAns<- asym_U_yser_ypcr_WAns-ypcr_asym_U_yser_ypcr_WAns
            fp_U_yser_ypcr_WAns<- lea_U_yser_ypcr_WAns-inc_U_yser_ypcr_WAns
          }
          #RS
          if (p.leave.rs > 0)  {
            lea_U_yser_ypcr_RS<- rbinom(ncat, U_yser_ypcr_RS, p.leave.rs)
            fpinc_U_yser_ypcr_RS<- rbinom(ncat, lea_U_yser_ypcr_RS, p.fp.inc.rs/p.leave.rs)
            fp_U_yser_ypcr_RS<- rbinom(ncat, fpinc_U_yser_ypcr_RS, p.fp/p.fp.inc.rs)
            inc_U_yser_ypcr_RS<- fpinc_U_yser_ypcr_RS-fp_U_yser_ypcr_RS
            sym_U_yser_ypcr_RS<- rbinom(ncat,inc_U_yser_ypcr_RS, (1-pa)*as.r)
            asym_U_yser_ypcr_RS<- inc_U_yser_ypcr_RS-sym_U_yser_ypcr_RS
            ypcr_asym_U_yser_ypcr_RS<- rbinom(ncat, asym_U_yser_ypcr_RS, asym.pcr.prob)
            npcr_asym_U_yser_ypcr_RS<- asym_U_yser_ypcr_RS-ypcr_asym_U_yser_ypcr_RS
            wan_U_yser_ypcr_RS<- lea_U_yser_ypcr_RS - fpinc_U_yser_ypcr_RS 
          }
          #WS
          if(p.leave.ws > 0){
            lea_U_yser_ypcr_WS<- rbinom(ncat, U_yser_ypcr_WS, p.leave.ws)
            inc_U_yser_ypcr_WS<- rbinom(ncat, lea_U_yser_ypcr_WS, (p.inf*si.w)/p.leave.ws)
            sym_U_yser_ypcr_WS<- rbinom(ncat, inc_U_yser_ypcr_WS, (1-pa)*ss.w)
            asym_U_yser_ypcr_WS<- inc_U_yser_ypcr_WS-sym_U_yser_ypcr_WS
            ypcr_asym_U_yser_ypcr_WS<- rbinom(ncat, asym_U_yser_ypcr_WS, asym.pcr.prob)
            npcr_asym_U_yser_ypcr_WS<- asym_U_yser_ypcr_WS-ypcr_asym_U_yser_ypcr_WS
            fp_U_yser_ypcr_WS<- lea_U_yser_ypcr_WS-inc_U_yser_ypcr_WS
          }
          #RAps
          if (p.leave.ra > 0)  {
            lea_U_yser_ypcr_RAps<- rbinom(ncat, U_yser_ypcr_RAps, p.leave.ra)
            fpinc_U_yser_ypcr_RAps<- rbinom(ncat, lea_U_yser_ypcr_RAps, p.fp.inc.ra/p.leave.ra)
            fp_U_yser_ypcr_RAps<- rbinom(ncat, fpinc_U_yser_ypcr_RAps, p.fp/p.fp.inc.ra)
            inc_U_yser_ypcr_RAps<- fpinc_U_yser_ypcr_RAps-fp_U_yser_ypcr_RAps
            sym_U_yser_ypcr_RAps<- rbinom(ncat,inc_U_yser_ypcr_RAps, (1-pa)*as.r)
            asym_U_yser_ypcr_RAps<- inc_U_yser_ypcr_RAps-sym_U_yser_ypcr_RAps
            ypcr_asym_U_yser_ypcr_RAps<- rbinom(ncat, asym_U_yser_ypcr_RAps, asym.pcr.prob)
            npcr_asym_U_yser_ypcr_RAps<- asym_U_yser_ypcr_RAps-ypcr_asym_U_yser_ypcr_RAps
            wan_U_yser_ypcr_RAps<- lea_U_yser_ypcr_RAps - fpinc_U_yser_ypcr_RAps 
          } 
          #WAps
          if(p.leave.wa > 0){
            lea_U_yser_ypcr_WAps<- rbinom(ncat, U_yser_ypcr_WAps, p.leave.wa)
            inc_U_yser_ypcr_WAps<- rbinom(ncat, lea_U_yser_ypcr_WAps, (p.inf*ai.w)/p.leave.wa)
            sym_U_yser_ypcr_WAps<- rbinom(ncat, inc_U_yser_ypcr_WAps, (1-pa)*as.w)
            asym_U_yser_ypcr_WAps<- inc_U_yser_ypcr_WAps-sym_U_yser_ypcr_WAps
            ypcr_asym_U_yser_ypcr_WAps<- rbinom(ncat, asym_U_yser_ypcr_WAps, asym.pcr.prob)
            npcr_asym_U_yser_ypcr_WAps<- asym_U_yser_ypcr_WAps-ypcr_asym_U_yser_ypcr_WAps
            fp_U_yser_ypcr_WAps<- lea_U_yser_ypcr_WAps-inc_U_yser_ypcr_WAps
          }      
              
      #update state variables
              
      #1. not pcr detected  
              
        U_yser_npcr_IAns[1,]<-          U_yser_npcr_IAns[1,] + npcr_asym_U_yser_npcr_S  - rec_U_yser_npcr_IAns[1,]
        U_yser_npcr_IAns[2:6,]<-        U_yser_npcr_IAns[2:6,] + rec_U_yser_npcr_IAns[1:5,] - rec_U_yser_npcr_IAns[2:6,] 
        U_yser_npcr_IAns[7,]<-          U_yser_npcr_IAns[7,] + rec_U_yser_npcr_IAns[6,] - rec_U_yser_npcr_IAns[7,] + npcr_asym_U_yser_npcr_WAns 
        U_yser_npcr_IAns[8:n.inf.com,]<-U_yser_npcr_IAns[8:n.inf.com,] + rec_U_yser_npcr_IAns[7:(n.inf.com-1),] - rec_U_yser_npcr_IAns[8:n.inf.com,] 
        U_yser_npcr_RAns<-              U_yser_npcr_RAns + rec.ab_U_yser_npcr_IAns - sym_U_yser_npcr_RAns - ypcr_asym_U_yser_npcr_RAns - wan_U_yser_npcr_RAns - fp_U_yser_npcr_RAns 
        U_yser_npcr_WAns<-              U_yser_npcr_WAns + (rec_U_yser_npcr_IAns[n.inf.com,] - rec.ab_U_yser_npcr_IAns) + wan_U_yser_npcr_RAns - inc_U_yser_npcr_WAns - fp_U_yser_npcr_WAns 
        U_yser_npcr_S<-                 U_yser_npcr_S - inc_U_yser_npcr_S - fp_U_yser_npcr_S 
        U_yser_npcr_IS[1,]<-            U_yser_npcr_IS[1,] + sym_U_yser_npcr_S - rec_U_yser_npcr_IS[1,] 
        U_yser_npcr_IS[2:6,]<-          U_yser_npcr_IS[2:6,] + rec_U_yser_npcr_IS[1:5,] - rec_U_yser_npcr_IS[2:6,]
        U_yser_npcr_IS[7,]<-            U_yser_npcr_IS[7,] + rec_U_yser_npcr_IS[6,] - rec_U_yser_npcr_IS[7,] + sym_U_yser_npcr_WAns + sym_U_yser_npcr_WS + sym_U_yser_npcr_WAps
        U_yser_npcr_IS[8:n.inf.com,]<-  U_yser_npcr_IS[8:n.inf.com,] + rec_U_yser_npcr_IS[7:(n.inf.com-1),] - rec_U_yser_npcr_IS[8:n.inf.com,]
        U_yser_npcr_RS<-                U_yser_npcr_RS + rec.ab_U_yser_npcr_IS + sym_U_yser_npcr_RAns + sym_U_yser_npcr_RAps - wan_U_yser_npcr_RS - asym_U_yser_npcr_RS - fp_U_yser_npcr_RS 
        U_yser_npcr_WS<-                U_yser_npcr_WS + (rec_U_yser_npcr_IS[n.inf.com,] - rec.ab_U_yser_npcr_IS) + wan_U_yser_npcr_RS - inc_U_yser_npcr_WS - fp_U_yser_npcr_WS 
        U_yser_npcr_IAps[1,]<-          U_yser_npcr_IAps[1,] - rec_U_yser_npcr_IAps[1,] 
        U_yser_npcr_IAps[2:6,]<-        U_yser_npcr_IAps[2:6,] + rec_U_yser_npcr_IAps[1:5,] - rec_U_yser_npcr_IAps[2:6,]
        U_yser_npcr_IAps[7,]<-          U_yser_npcr_IAps[7,] + rec_U_yser_npcr_IAps[6,] - rec_U_yser_npcr_IAps[7,] + npcr_asym_U_yser_npcr_WAps +  npcr_asym_U_yser_npcr_WS 
        U_yser_npcr_IAps[8:n.inf.com,]<-U_yser_npcr_IAps[8:n.inf.com,] + rec_U_yser_npcr_IAps[7:(n.inf.com-1),] - rec_U_yser_npcr_IAps[8:n.inf.com,] 
        U_yser_npcr_RAps<-              U_yser_npcr_RAps + rec.ab_U_yser_npcr_IAps + npcr_asym_U_yser_npcr_RS - sym_U_yser_npcr_RAps - wan_U_yser_npcr_RAps - fp_U_yser_npcr_RAps - ypcr_asym_U_yser_npcr_RAps 
        U_yser_npcr_WAps<-              U_yser_npcr_WAps + (rec_U_yser_npcr_IAps[n.inf.com,] - rec.ab_U_yser_npcr_IAps) + wan_U_yser_npcr_RAps - inc_U_yser_npcr_WAps - fp_U_yser_npcr_WAps 

      #2. yes pcr detected
        
        U_yser_ypcr_IAns[1,]<-          U_yser_ypcr_IAns[1,] + ypcr_asym_U_yser_npcr_S + asym_U_yser_ypcr_S - rec_U_yser_ypcr_IAns[1,]
        U_yser_ypcr_IAns[2:6,]<-        U_yser_ypcr_IAns[2:6,] + rec_U_yser_ypcr_IAns[1:5,] - rec_U_yser_ypcr_IAns[2:6,] 
        U_yser_ypcr_IAns[7,]<-          U_yser_ypcr_IAns[7,] + rec_U_yser_ypcr_IAns[6,] - rec_U_yser_ypcr_IAns[7,] + ypcr_asym_U_yser_npcr_WAns + asym_U_yser_ypcr_WAns 
        U_yser_ypcr_IAns[8:n.inf.com,]<-U_yser_ypcr_IAns[8:n.inf.com,] + rec_U_yser_ypcr_IAns[7:(n.inf.com-1),] - rec_U_yser_ypcr_IAns[8:n.inf.com,] 
        U_yser_ypcr_RAns<-              U_yser_ypcr_RAns + rec.ab_U_yser_ypcr_IAns + fp_U_yser_npcr_RAns + ypcr_asym_U_yser_npcr_RAns - sym_U_yser_ypcr_RAns - wan_U_yser_ypcr_RAns  
        U_yser_ypcr_WAns<-              U_yser_ypcr_WAns + (rec_U_yser_ypcr_IAns[n.inf.com,] - rec.ab_U_yser_ypcr_IAns) + wan_U_yser_ypcr_RAns + fp_U_yser_npcr_WAns - inc_U_yser_ypcr_WAns 
        U_yser_ypcr_S<-                 U_yser_ypcr_S + fp_U_yser_npcr_S - inc_U_yser_ypcr_S 
        U_yser_ypcr_IS[1,]<-            U_yser_ypcr_IS[1,] + sym_U_yser_ypcr_S - rec_U_yser_ypcr_IS[1,] 
        U_yser_ypcr_IS[2:6,]<-          U_yser_ypcr_IS[2:6,] + rec_U_yser_ypcr_IS[1:5,] - rec_U_yser_ypcr_IS[2:6,] 
        U_yser_ypcr_IS[7,]<-            U_yser_ypcr_IS[7,] + rec_U_yser_ypcr_IS[6,] - rec_U_yser_ypcr_IS[7,] + sym_U_yser_ypcr_WAns + sym_U_yser_ypcr_WS + sym_U_yser_ypcr_WAps
        U_yser_ypcr_IS[8:n.inf.com,]<-  U_yser_ypcr_IS[8:n.inf.com,] + rec_U_yser_ypcr_IS[7:(n.inf.com-1),] - rec_U_yser_ypcr_IS[8:n.inf.com,]
        U_yser_ypcr_RS<-                U_yser_ypcr_RS + rec.ab_U_yser_ypcr_IS + sym_U_yser_ypcr_RAns + sym_U_yser_ypcr_RAps - wan_U_yser_ypcr_RS - asym_U_yser_ypcr_RS + fp_U_yser_npcr_RS 
        U_yser_ypcr_WS<-                U_yser_ypcr_WS + (rec_U_yser_ypcr_IS[n.inf.com,] - rec.ab_U_yser_ypcr_IS) + wan_U_yser_ypcr_RS + fp_U_yser_npcr_WS - inc_U_yser_ypcr_WS  
        U_yser_ypcr_IAps[1,]<-          U_yser_ypcr_IAps[1,] - rec_U_yser_ypcr_IAps[1,] 
        U_yser_ypcr_IAps[2:6,]<-        U_yser_ypcr_IAps[2:6,] + rec_U_yser_ypcr_IAps[1:5,] - rec_U_yser_ypcr_IAps[2:6,] 
        U_yser_ypcr_IAps[7,]<-          U_yser_ypcr_IAps[7,] + rec_U_yser_ypcr_IAps[6,] - rec_U_yser_ypcr_IAps[7,] + asym_U_yser_ypcr_WAps + asym_U_yser_ypcr_WS + ypcr_asym_U_yser_npcr_WAps + ypcr_asym_U_yser_npcr_WS 
        U_yser_ypcr_IAps[8:n.inf.com,]<-U_yser_ypcr_IAps[8:n.inf.com,] + rec_U_yser_ypcr_IAps[7:(n.inf.com-1),] - rec_U_yser_ypcr_IAps[8:n.inf.com,]
        U_yser_ypcr_RAps<-              U_yser_ypcr_RAps + rec.ab_U_yser_ypcr_IAps + ypcr_asym_U_yser_npcr_RS + ypcr_asym_U_yser_npcr_RAps + fp_U_yser_npcr_RAps + asym_U_yser_ypcr_RS - sym_U_yser_ypcr_RAps - wan_U_yser_ypcr_RAps 
        U_yser_ypcr_WAps<-              U_yser_ypcr_WAps + (rec_U_yser_ypcr_IAps[n.inf.com,] - rec.ab_U_yser_ypcr_IAps) + wan_U_yser_ypcr_RAps + fp_U_yser_npcr_WAps - inc_U_yser_ypcr_WAps 

#### Part G) Calculate cumulative incidences in that time interval ####
        
        
      #(All cumulative incidence variables are a vector with a position for each time interval. This allows me to easily give the results in incidence (for a time interval) and cumulative incidence (all prior time intervals) format)
    
      #1. add up symptomatic cases who have never previously experienced symptomatic COVID-19 (1' outcome)
      #(number of people infected symptomatically for first time)
      tot_first_sym_U<-     sum(sym_U_nser_npcr_S) + sum(sym_U_nser_npcr_RAns) + sum(sym_U_nser_npcr_WAns) + 
                            sum(sym_U_nser_ypcr_S) + sum(sym_U_nser_ypcr_RAns) + sum(sym_U_nser_ypcr_WAns) + 
                            sum(sym_U_yser_npcr_S) + sum(sym_U_yser_npcr_RAns) + sum(sym_U_yser_npcr_WAns) + 
                            sum(sym_U_yser_ypcr_S) + sum(sym_U_yser_ypcr_RAns) + sum(sym_U_yser_ypcr_WAns) 
      cum_sym_U_first[j] <- cum_sym_U_first[j] + tot_first_sym_U
      
      tot_first_sym_V<-     sum(sym_V_nser_npcr_S) + sum(sym_V_nser_npcr_V) + sum(sym_V_nser_npcr_RAns) + sum(sym_V_nser_npcr_WAns) + 
                            sum(sym_V_nser_ypcr_S) + sum(sym_V_nser_ypcr_V) + sum(sym_V_nser_ypcr_RAns) + sum(sym_V_nser_ypcr_WAns) + 
                            sum(sym_V_yser_npcr_S) + sum(sym_V_yser_npcr_V) + sum(sym_V_yser_npcr_RAns) + sum(sym_V_yser_npcr_WAns) + 
                            sum(sym_V_yser_ypcr_S) + sum(sym_V_yser_ypcr_V) + sum(sym_V_yser_ypcr_RAns) + sum(sym_V_yser_ypcr_WAns) 
      cum_sym_V_first[j] <- cum_sym_V_first[j] + tot_first_sym_V
      
      #add up times of infection for the above to get total person-time of those infected in this time interval
      first_sym_U[j] <- first_sym_U[j] + sum(rep(time - timeintervals.start[j], tot_first_sym_U))
      first_sym_V[j] <- first_sym_V[j] + sum(rep(time - timeintervals.start[j], tot_first_sym_V))
      
      #2. add up infections who have never previously experienced an infection (V/S)
      #(number of people infected for first time)
      tot_first_inf_U<-     sum(inc_U_nser_npcr_S) + sum(inc_U_nser_ypcr_S) + sum(inc_U_yser_npcr_S) + sum(inc_U_yser_ypcr_S)
      cum_inf_U_first[j] <- cum_inf_U_first[j] + tot_first_inf_U
      
      tot_first_inf_V<-     sum(inc_V_nser_npcr_S) + sum(inc_V_nser_ypcr_S) + sum(inc_V_yser_npcr_S) + sum(inc_V_yser_ypcr_S) + 
                            sum(inc_V_nser_npcr_V) + sum(inc_V_nser_ypcr_V) + sum(inc_V_yser_npcr_V) + sum(inc_V_yser_ypcr_V) 
      cum_inf_V_first[j] <- cum_inf_V_first[j] + tot_first_inf_V
      
      #add up times of infection for the above to get total person-time of those infected in this time interval
      first_inf_U[j] <- first_inf_U[j] + sum(rep(time - timeintervals.start[j], tot_first_inf_U))
      first_inf_V[j] <- first_inf_V[j] + sum(rep(time - timeintervals.start[j], tot_first_inf_V))
      
      #3. add up total first-asymptomatic infections (number of people infected asymptomatically for first time)
      #asym infections from S/V/RS/WS
      tot_first_asym_U<- sum(asym_U_nser_npcr_S) + sum(asym_U_nser_npcr_RS) + sum(asym_U_nser_npcr_WS) + 
                         sum(asym_U_nser_ypcr_S) + sum(asym_U_nser_ypcr_RS) + sum(asym_U_nser_ypcr_WS) + 
                         sum(asym_U_yser_npcr_S) + sum(asym_U_yser_npcr_RS) + sum(asym_U_yser_npcr_WS) + 
                         sum(asym_U_yser_ypcr_S) + sum(asym_U_yser_ypcr_RS) + sum(asym_U_yser_ypcr_WS)
      cum_asym_U_first[j] <- cum_asym_U_first[j] + tot_first_asym_U
      
      tot_first_asym_V<- sum(asym_V_nser_npcr_S) + sum(asym_V_nser_npcr_V) + sum(asym_V_nser_npcr_RS) + sum(asym_V_nser_npcr_WS) + 
                         sum(asym_V_nser_ypcr_S) + sum(asym_V_nser_ypcr_V) + sum(asym_V_nser_ypcr_RS) + sum(asym_V_nser_ypcr_WS) + 
                         sum(asym_V_yser_npcr_S) + sum(asym_V_yser_npcr_V) + sum(asym_V_yser_npcr_RS) + sum(asym_V_yser_npcr_WS) + 
                         sum(asym_V_yser_ypcr_S) + sum(asym_V_yser_ypcr_V) + sum(asym_V_yser_ypcr_RS) + sum(asym_V_yser_ypcr_WS)
      cum_asym_V_first[j] <- cum_asym_V_first[j] + tot_first_asym_V
      
      #add up times of infection for the above to get total person-time of those infected in this time interval
      first_asym_U[j] <- first_asym_U[j] + sum(rep(time - timeintervals.start[j], tot_first_asym_U))
      first_asym_V[j] <- first_asym_V[j] + sum(rep(time - timeintervals.start[j], tot_first_asym_V))
      
      #4. add up total first infections that are asymptomatic (number of people infected asymptomatically who have never been infected symptomatically or asymptomatically)
      cum_asym_U_first2[j] <- cum_asym_U_first2[j] + sum(asym_U_nser_npcr_S) + sum(asym_U_nser_ypcr_S) + sum(asym_U_yser_npcr_S) + sum(asym_U_yser_ypcr_S)
      cum_asym_V_first2[j] <- cum_asym_V_first2[j] + sum(asym_V_nser_npcr_S) + sum(asym_V_nser_ypcr_S) + sum(asym_V_yser_npcr_S) + sum(asym_V_yser_ypcr_S) + 
                                                     sum(asym_V_nser_npcr_V) + sum(asym_V_nser_ypcr_V) + sum(asym_V_yser_npcr_V) + sum(asym_V_yser_ypcr_V) 
      #person-time for this is calculated for first infection (above, "first_inf")
      
      #5. add up total first infections that are symptomatic (number of people infected symptomatically who have never been infected symptomatically or asymptomatically)
      cum_sym_U_first2[j] <- cum_sym_U_first2[j] + sum(sym_U_nser_npcr_S) + sum(sym_U_nser_ypcr_S) + sum(sym_U_yser_npcr_S) + sum(sym_U_yser_ypcr_S)
      cum_sym_V_first2[j] <- cum_sym_V_first2[j] + sum(sym_V_nser_npcr_S) + sum(sym_V_nser_ypcr_S) + sum(sym_V_yser_npcr_S) + sum(sym_V_yser_ypcr_S) + 
                                                   sum(sym_V_nser_npcr_V) + sum(sym_V_nser_ypcr_V) + sum(sym_V_yser_npcr_V) + sum(sym_V_yser_ypcr_V)  
      #person-time for this is calculated for first infection (above, "first_inf")
      
      #6. PCR: add up total first PCR-detected infections (V_npcr, S_npcr, RAns_npcr, WAns_npcr. All sym, ypcr_asym and fp incidences. From yser and nser.).
      tot_pcr_true_U<- sum(sym_U_nser_npcr_S) + sum(sym_U_yser_npcr_S) + 
                       sum(sym_U_nser_npcr_RAns) + sum(sym_U_yser_npcr_RAns) + 
                       sum(sym_U_nser_npcr_WAns) + sum(sym_U_yser_npcr_WAns) + 
                       sum(ypcr_asym_U_nser_npcr_S) + sum(ypcr_asym_U_yser_npcr_S) + 
                       sum(ypcr_asym_U_nser_npcr_RAns) + sum(ypcr_asym_U_yser_npcr_RAns) + 
                       sum(ypcr_asym_U_nser_npcr_WAns) + sum(ypcr_asym_U_yser_npcr_WAns) 
      tot_pcr_fp_U<-   sum(fp_U_nser_npcr_S) + sum(fp_U_yser_npcr_S) + 
                       sum(fp_U_nser_npcr_RAns) + sum(fp_U_yser_npcr_RAns) + 
                       sum(fp_U_nser_npcr_WAns) + sum(fp_U_yser_npcr_WAns)
      cum_pcr_inf_U_first[j] <- cum_pcr_inf_U_first[j] + tot_pcr_true_U + tot_pcr_fp_U
      
      tot_pcr_true_V<- sum(sym_V_nser_npcr_V) + sum(sym_V_yser_npcr_V) + 
                       sum(sym_V_nser_npcr_S) + sum(sym_V_yser_npcr_S) + 
                       sum(sym_V_nser_npcr_RAns) + sum(sym_V_yser_npcr_RAns) + 
                       sum(sym_V_nser_npcr_WAns) + sum(sym_V_yser_npcr_WAns) + 
                       sum(ypcr_asym_V_nser_npcr_V) + sum(ypcr_asym_V_yser_npcr_V) + 
                       sum(ypcr_asym_V_nser_npcr_S) + sum(ypcr_asym_V_yser_npcr_S) + 
                       sum(ypcr_asym_V_nser_npcr_RAns) + sum(ypcr_asym_V_yser_npcr_RAns) + 
                       sum(ypcr_asym_V_nser_npcr_WAns) + sum(ypcr_asym_V_yser_npcr_WAns) 
      tot_pcr_fp_V<-   sum(fp_V_nser_npcr_V) + sum(fp_V_yser_npcr_V) + 
                       sum(fp_V_nser_npcr_S) + sum(fp_V_yser_npcr_S) + 
                       sum(fp_V_nser_npcr_RAns) + sum(fp_V_yser_npcr_RAns) + 
                       sum(fp_V_nser_npcr_WAns) + sum(fp_V_yser_npcr_WAns)
      cum_pcr_inf_V_first[j] <- cum_pcr_inf_V_first[j] + tot_pcr_true_V + tot_pcr_fp_V
      
      #add up times of infection for the above to get total person-time of those infected in this time interval
      first_pcr_U[j]<- first_pcr_U[j] + sum(rep(time - timeintervals.start[j], tot_pcr_true_U + tot_pcr_fp_U))
      first_pcr_V[j]<- first_pcr_V[j] + sum(rep(time - timeintervals.start[j],  tot_pcr_true_V + tot_pcr_fp_V))
      
      #7. PCR: add up total first PCR-detected asymptomatic infection (inc people who have had a symptomatic infection) (all ypcr_asym from npcr, and false positives from npcr) (assuming all fp's are asymptomatic)
      tot_pcr_asym_U<- sum(ypcr_asym_U_nser_npcr_S) + sum(ypcr_asym_U_yser_npcr_S) + 
                       sum(ypcr_asym_U_nser_npcr_RAns) + sum(ypcr_asym_U_yser_npcr_RAns) + 
                       sum(ypcr_asym_U_nser_npcr_WAns) + sum(ypcr_asym_U_yser_npcr_WAns) +
                       sum(ypcr_asym_U_nser_npcr_RS) + sum(ypcr_asym_U_yser_npcr_RS) + 
                       sum(ypcr_asym_U_nser_npcr_WS) + sum(ypcr_asym_U_yser_npcr_WS)+
                       sum(ypcr_asym_U_nser_npcr_RAps) + sum(ypcr_asym_U_yser_npcr_RAps) + 
                       sum(ypcr_asym_U_nser_npcr_WAps) + sum(ypcr_asym_U_yser_npcr_WAps)
      tot_pcr_asym_fp_U<- tot_pcr_fp_U + #false positives from people who haven't had a symptomatic infection before (S/RAns/WAns)
                          sum(fp_U_nser_npcr_RS) + sum(fp_U_yser_npcr_RS) + #false positives from people who have had a symptomatic infection before
                          sum(fp_U_nser_npcr_WS) + sum(fp_U_yser_npcr_WS) + 
                          sum(fp_U_nser_npcr_RAps) + sum(fp_U_yser_npcr_RAps) + 
                          sum(fp_U_nser_npcr_WAps) + sum(fp_U_yser_npcr_WAps) 
      cum_pcr_asym_U_first[j] <- cum_pcr_asym_U_first[j] + tot_pcr_asym_U + tot_pcr_asym_fp_U
      
      tot_pcr_asym_V<- sum(ypcr_asym_V_nser_npcr_S) + sum(ypcr_asym_V_yser_npcr_S) + 
                       sum(ypcr_asym_V_nser_npcr_RAns) + sum(ypcr_asym_V_yser_npcr_RAns) + 
                       sum(ypcr_asym_V_nser_npcr_WAns) + sum(ypcr_asym_V_yser_npcr_WAns) + 
                       sum(ypcr_asym_V_nser_npcr_V) + sum(ypcr_asym_V_yser_npcr_V) +
                       sum(ypcr_asym_V_nser_npcr_RS) + sum(ypcr_asym_V_yser_npcr_RS) + 
                       sum(ypcr_asym_V_nser_npcr_WS) + sum(ypcr_asym_V_yser_npcr_WS)+
                       sum(ypcr_asym_V_nser_npcr_RAps) + sum(ypcr_asym_V_yser_npcr_RAps) + 
                       sum(ypcr_asym_V_nser_npcr_WAps) + sum(ypcr_asym_V_yser_npcr_WAps)
      tot_pcr_asym_fp_V<- tot_pcr_fp_V + 
                          sum(fp_V_nser_npcr_RS) + sum(fp_V_yser_npcr_RS) + 
                          sum(fp_V_nser_npcr_WS) + sum(fp_V_yser_npcr_WS) +
                          sum(fp_V_nser_npcr_RAps) + sum(fp_V_yser_npcr_RAps) + 
                          sum(fp_V_nser_npcr_WAps) + sum(fp_V_yser_npcr_WAps) 
      cum_pcr_asym_V_first[j] <- cum_pcr_asym_V_first[j] + tot_pcr_asym_V + tot_pcr_asym_fp_V
        
      #add up times of infection for the above to get total person-time of those infected in this time interval
      first_pcr_asym_U[j]<- first_pcr_asym_U[j] + sum(rep(time - timeintervals.start[j], tot_pcr_asym_U + tot_pcr_asym_fp_U))
      first_pcr_asym_V[j]<- first_pcr_asym_V[j] + sum(rep(time - timeintervals.start[j],  tot_pcr_asym_V + tot_pcr_asym_fp_V))
      
      #8. PCR: add up total first PCR-detected infections that are asymptomatic (w/o people who have had a symptomatic infection) (all ypcr_asym from npcr S/V/RAns/WAns, and false positives from npcr S/V)
      tot_pcr_asym2_U<- sum(ypcr_asym_U_nser_npcr_S) + sum(ypcr_asym_U_yser_npcr_S) + 
                        sum(ypcr_asym_U_nser_npcr_RAns) + sum(ypcr_asym_U_yser_npcr_RAns) + 
                        sum(ypcr_asym_U_nser_npcr_WAns) + sum(ypcr_asym_U_yser_npcr_WAns) + 
                        tot_pcr_fp_U
      cum_pcr_asym_U_first2[j] <- cum_pcr_asym_U_first2[j] + tot_pcr_asym2_U
      
      tot_pcr_asym2_V<- sum(ypcr_asym_V_nser_npcr_S) + sum(ypcr_asym_V_yser_npcr_S) + 
                        sum(ypcr_asym_V_nser_npcr_RAns) + sum(ypcr_asym_V_yser_npcr_RAns) + 
                        sum(ypcr_asym_V_nser_npcr_WAns) + sum(ypcr_asym_V_yser_npcr_WAns) + 
                        sum(ypcr_asym_V_nser_npcr_V) + sum(ypcr_asym_V_yser_npcr_V) + 
                        tot_pcr_fp_V
      cum_pcr_asym_V_first2[j] <- cum_pcr_asym_V_first2[j] + tot_pcr_asym2_V
      #for this one i will censor after the first pcr-detected infection
      
      #9. add up all infections 
      cum_inf_U[j] <- cum_inf_U[j] + sum(inc_U_nser_npcr_S) + sum(inc_U_nser_npcr_RAns) + sum(inc_U_nser_npcr_WAns) + sum(inc_U_nser_npcr_RS) + sum(inc_U_nser_npcr_WS) + sum(inc_U_nser_npcr_RAps) + sum(inc_U_nser_npcr_WAps) +
                                     sum(inc_U_nser_ypcr_S) + sum(inc_U_nser_ypcr_RAns) + sum(inc_U_nser_ypcr_WAns) + sum(inc_U_nser_ypcr_RS) + sum(inc_U_nser_ypcr_WS) + sum(inc_U_nser_ypcr_RAps) + sum(inc_U_nser_ypcr_WAps) +
                                     sum(inc_U_yser_npcr_S) + sum(inc_U_yser_npcr_RAns) + sum(inc_U_yser_npcr_WAns) + sum(inc_U_yser_npcr_RS) + sum(inc_U_yser_npcr_WS) + sum(inc_U_yser_npcr_RAps) + sum(inc_U_yser_npcr_WAps) +
                                     sum(inc_U_yser_ypcr_S) + sum(inc_U_yser_ypcr_RAns) + sum(inc_U_yser_ypcr_WAns) + sum(inc_U_yser_ypcr_RS) + sum(inc_U_yser_ypcr_WS) + sum(inc_U_yser_ypcr_RAps) + sum(inc_U_yser_ypcr_WAps)
      cum_inf_V[j] <- cum_inf_V[j] + sum(inc_V_nser_npcr_S) + sum(inc_V_nser_npcr_RAns) + sum(inc_V_nser_npcr_WAns) + sum(inc_V_nser_npcr_RS) + sum(inc_V_nser_npcr_WS) + sum(inc_V_nser_npcr_RAps) + sum(inc_V_nser_npcr_WAps) + sum(inc_V_nser_npcr_V) +
                                     sum(inc_V_nser_ypcr_S) + sum(inc_V_nser_ypcr_RAns) + sum(inc_V_nser_ypcr_WAns) + sum(inc_V_nser_ypcr_RS) + sum(inc_V_nser_ypcr_WS) + sum(inc_V_nser_ypcr_RAps) + sum(inc_V_nser_ypcr_WAps) + sum(inc_V_nser_npcr_V) +
                                     sum(inc_V_yser_npcr_S) + sum(inc_V_yser_npcr_RAns) + sum(inc_V_yser_npcr_WAns) + sum(inc_V_yser_npcr_RS) + sum(inc_V_yser_npcr_WS) + sum(inc_V_yser_npcr_RAps) + sum(inc_V_yser_npcr_WAps) + sum(inc_V_nser_npcr_V) +
                                     sum(inc_V_yser_ypcr_S) + sum(inc_V_yser_ypcr_RAns) + sum(inc_V_yser_ypcr_WAns) + sum(inc_V_yser_ypcr_RS) + sum(inc_V_yser_ypcr_WS) + sum(inc_V_yser_ypcr_RAps) + sum(inc_V_yser_ypcr_WAps) + sum(inc_V_nser_npcr_V)
      
      #10. add up all symptomatic infections 
      cum_sym_U[j] <- cum_sym_U[j] + sum(sym_U_nser_npcr_S) + sum(sym_U_nser_npcr_RAns) + sum(sym_U_nser_npcr_WAns) + sum(sym_U_nser_npcr_RS) + sum(sym_U_nser_npcr_WS) + sum(sym_U_nser_npcr_RAps) + sum(sym_U_nser_npcr_WAps) +
                                     sum(sym_U_nser_ypcr_S) + sum(sym_U_nser_ypcr_RAns) + sum(sym_U_nser_ypcr_WAns) + sum(sym_U_nser_ypcr_RS) + sum(sym_U_nser_ypcr_WS) + sum(sym_U_nser_ypcr_RAps) + sum(sym_U_nser_ypcr_WAps) +
                                     sum(sym_U_yser_npcr_S) + sum(sym_U_yser_npcr_RAns) + sum(sym_U_yser_npcr_WAns) + sum(sym_U_yser_npcr_RS) + sum(sym_U_yser_npcr_WS) + sum(sym_U_yser_npcr_RAps) + sum(sym_U_yser_npcr_WAps) +
                                     sum(sym_U_yser_ypcr_S) + sum(sym_U_yser_ypcr_RAns) + sum(sym_U_yser_ypcr_WAns) + sum(sym_U_yser_ypcr_RS) + sum(sym_U_yser_ypcr_WS) + sum(sym_U_yser_ypcr_RAps) + sum(sym_U_yser_ypcr_WAps)
      cum_sym_V[j] <- cum_sym_V[j] + sum(sym_V_nser_npcr_S) + sum(sym_V_nser_npcr_RAns) + sum(sym_V_nser_npcr_WAns) + sum(sym_V_nser_npcr_RS) + sum(sym_V_nser_npcr_WS) + sum(sym_V_nser_npcr_RAps) + sum(sym_V_nser_npcr_WAps) + sum(sym_V_nser_npcr_V) +
                                     sum(sym_V_nser_ypcr_S) + sum(sym_V_nser_ypcr_RAns) + sum(sym_V_nser_ypcr_WAns) + sum(sym_V_nser_ypcr_RS) + sum(sym_V_nser_ypcr_WS) + sum(sym_V_nser_ypcr_RAps) + sum(sym_V_nser_ypcr_WAps) + sum(sym_V_nser_npcr_V) +
                                     sum(sym_V_yser_npcr_S) + sum(sym_V_yser_npcr_RAns) + sum(sym_V_yser_npcr_WAns) + sum(sym_V_yser_npcr_RS) + sum(sym_V_yser_npcr_WS) + sum(sym_V_yser_npcr_RAps) + sum(sym_V_yser_npcr_WAps) + sum(sym_V_nser_npcr_V) +
                                     sum(sym_V_yser_ypcr_S) + sum(sym_V_yser_ypcr_RAns) + sum(sym_V_yser_ypcr_WAns) + sum(sym_V_yser_ypcr_RS) + sum(sym_V_yser_ypcr_WS) + sum(sym_V_yser_ypcr_RAps) + sum(sym_V_yser_ypcr_WAps) + sum(sym_V_nser_npcr_V)
      

      #11. add up all asymptomatic infections 
      cum_asym_U[j] <- cum_inf_U[j] - cum_sym_U[j]
      cum_asym_V[j] <- cum_inf_V[j] - cum_sym_V[j]
  
      #increment time by dt and loop
      time<-time+dt
      
    } #end of time interval
    
#### Part H) Calculate results (except serology results) ####
    
    
## 1. Person-time calculations ##
      #(convert person-time for those who were infected to years (/365), then add to total person time for those who weren't infected, but were at risk at the start (multiply by the person years in this time interval))
    
    #person time for first case of symptomatic covid 
    first_sym_pt_V[j] <- (first_sym_V[j]/365)+((at.risk.start.first.sym.V-cum_sym_V_first[j])*pers_years[j])
    first_sym_pt_U[j] <- (first_sym_U[j]/365)+((at.risk.start.first.sym.U-cum_sym_U_first[j])*pers_years[j])
    
    #person time for first infection 
    first_inf_pt_V[j] <- (first_inf_V[j]/365)+((at.risk.start.first.inf.V-cum_inf_V_first[j])*pers_years[j])
    first_inf_pt_U[j] <- (first_inf_U[j]/365)+((at.risk.start.first.inf.U-cum_inf_U_first[j])*pers_years[j])
    
    #person time for first asymptomatic infection 
      #(different method to the others, at.risk.start.first.asym.V is the number at risk at the start of the trial, not the time interval. sum(cum_asym_V_first[1:j]) is the number of participants that have been infected asymptomatically ever in the trial up to this point. Therefore at.risk.start.first.asym.V-sum(cum_asym_V_first[1:j]) gives the number who have never been infected. They contribute the maximum person-time in that time interval. People who were infected in a previous time interval do not contribute any time.
    first_asym_pt_V[j] <- (first_asym_V[j]/365)+((at.risk.start.first.asym.V-sum(cum_asym_V_first[1:j]))*pers_years[j])
    first_asym_pt_U[j] <- (first_asym_U[j]/365)+((at.risk.start.first.asym.U-sum(cum_asym_U_first[1:j]))*pers_years[j])
    
    #person time for first PCR-detected infection 
    first_inf_PCR_pt_V[j] <- (first_pcr_V[j]/365)+((at.risk.start.first.PCR.inf.V-cum_pcr_inf_V_first[j])*pers_years[j])
    first_inf_PCR_pt_U[j] <- (first_pcr_U[j]/365)+((at.risk.start.first.PCR.inf.U-cum_pcr_inf_U_first[j])*pers_years[j])
    
    #person time for first PCR-detected asymptomatic infection 
    first_asym_PCR_pt_V[j] <- (first_pcr_asym_V[j]/365)+((at.risk.start.first.PCR.asym.V-cum_pcr_asym_V_first[j])*pers_years[j])
    first_asym_PCR_pt_U[j] <- (first_pcr_asym_U[j]/365)+((at.risk.start.first.PCR.asym.V-cum_pcr_asym_U_first[j])*pers_years[j])
    
## 3. Vaccine efficacy and confidence intervals 
    #(each VE result is a vector with [1] = VE, [2] = LCI, [3] = UCI). Done by running rateratio.test for rates and score test for proportions.) 
    
    #...for first symptomatic IRR, censoring after first symptomatic infection only
    VE_firstsym_res1<-c(1-rateratio.test(c(cum_sym_V_first[j], cum_sym_U_first[j]), c(first_sym_pt_V[j], first_sym_pt_U[j]))$estimate[1],
                        1-rateratio.test(c(cum_sym_V_first[j], cum_sym_U_first[j]), c(first_sym_pt_V[j], first_sym_pt_U[j]))$conf.int[c(2,1)])
    VE_firstsym_res2<-c(1-rateratio.test(c(sum(cum_sym_V_first[1:j]), sum(cum_sym_U_first[1:j])), c(sum(first_sym_pt_V[1:j]), sum(first_sym_pt_U[1:j])))$estimate[1],
                        1-rateratio.test(c(sum(cum_sym_V_first[1:j]), sum(cum_sym_U_first[1:j])), c(sum(first_sym_pt_V[1:j]), sum(first_sym_pt_U[1:j])))$conf.int[c(2,1)])

    #...for first symptomatic IRR, censoring after any first-infection (first infection, that is symptomatic)
    VE_firstsym2_res1<-c(1-rateratio.test(c(cum_sym_V_first2[j], cum_sym_U_first2[j]), c(first_inf_pt_V[j], first_inf_pt_U[j]))$estimate[1],
                        1-rateratio.test(c(cum_sym_V_first2[j], cum_sym_U_first2[j]), c(first_inf_pt_V[j], first_inf_pt_U[j]))$conf.int[c(2,1)])
    VE_firstsym2_res2<-c(1-rateratio.test(c(sum(cum_sym_V_first2[1:j]), sum(cum_sym_U_first2[1:j])), c(sum(first_inf_pt_V[1:j]), sum(first_inf_pt_U[1:j])))$estimate[1],
                        1-rateratio.test(c(sum(cum_sym_V_first2[1:j]), sum(cum_sym_U_first2[1:j])), c(sum(first_inf_pt_V[1:j]), sum(first_inf_pt_U[1:j])))$conf.int[c(2,1)])
    
    #...for first infection IRR 
    VE_firstinf_res1<-c(1-rateratio.test(c(cum_inf_V_first[j], cum_inf_U_first[j]), c(first_inf_pt_V[j], first_inf_pt_U[j]))$estimate[1],
                        1-rateratio.test(c(cum_inf_V_first[j], cum_inf_U_first[j]), c(first_inf_pt_V[j], first_inf_pt_U[j]))$conf.int[c(2,1)])
    VE_firstinf_res2<-c(1-rateratio.test(c(sum(cum_inf_V_first[1:j]), sum(cum_inf_U_first[1:j])), c(sum(first_inf_pt_V[1:j]), sum(first_inf_pt_U[1:j])))$estimate[1],
                        1-rateratio.test(c(sum(cum_inf_V_first[1:j]), sum(cum_inf_U_first[1:j])), c(sum(first_inf_pt_V[1:j]), sum(first_inf_pt_U[1:j])))$conf.int[c(2,1)])
    
    #...for first asymptomatic IRR, censoring after first asymptomatic infection only
    VE_firstasym_res1<-c(1-rateratio.test(c(cum_asym_V_first[j], cum_asym_U_first[j]), c(first_asym_pt_V[j], first_asym_pt_U[j]))$estimate[1],
                        1-rateratio.test(c(cum_asym_V_first[j], cum_asym_U_first[j]), c(first_asym_pt_V[j], first_asym_pt_U[j]))$conf.int[c(2,1)])
    VE_firstasym_res2<-c(1-rateratio.test(c(sum(cum_asym_V_first[1:j]), sum(cum_asym_U_first[1:j])), c(sum(first_asym_pt_V[1:j]), sum(first_asym_pt_U[1:j])))$estimate[1],
                        1-rateratio.test(c(sum(cum_asym_V_first[1:j]), sum(cum_asym_U_first[1:j])), c(sum(first_asym_pt_V[1:j]), sum(first_asym_pt_U[1:j])))$conf.int[c(2,1)])

    #...for first asymptomatic IRR, censoring after any first-infection (first infection, that is asymptomatic)
    VE_firstasym2_res1<-c(1-rateratio.test(c(cum_asym_V_first2[j], cum_asym_U_first2[j]), c(first_inf_pt_V[j], first_inf_pt_U[j]))$estimate[1],
                        1-rateratio.test(c(cum_asym_V_first2[j], cum_asym_U_first2[j]), c(first_inf_pt_V[j], first_inf_pt_U[j]))$conf.int[c(2,1)])
    VE_firstasym2_res2<-c(1-rateratio.test(c(sum(cum_asym_V_first2[1:j]), sum(cum_asym_U_first2[1:j])), c(sum(first_inf_pt_V[1:j]), sum(first_inf_pt_U[1:j])))$estimate[1],
                        1-rateratio.test(c(sum(cum_asym_V_first2[1:j]), sum(cum_asym_U_first2[1:j])), c(sum(first_inf_pt_V[1:j]), sum(first_inf_pt_U[1:j])))$conf.int[c(2,1)])

    #... for first pcr-detected infection IRR
    VE_firstinfPCR_res1<-c(1-rateratio.test(c(cum_pcr_inf_V_first[j], cum_pcr_inf_U_first[j]), c(first_inf_PCR_pt_V[j], first_inf_PCR_pt_U[j]))$estimate[1],
                        1-rateratio.test(c(cum_pcr_inf_V_first[j], cum_pcr_inf_U_first[j]), c(first_inf_PCR_pt_V[j], first_inf_PCR_pt_U[j]))$conf.int[c(2,1)])
    VE_firstinfPCR_res2<-c(1-rateratio.test(c(sum(cum_pcr_inf_V_first[1:j]), sum(cum_pcr_inf_U_first[1:j])), c(sum(first_inf_PCR_pt_V[1:j]), sum(first_inf_PCR_pt_U[1:j])))$estimate[1],
                        1-rateratio.test(c(sum(cum_pcr_inf_V_first[1:j]), sum(cum_pcr_inf_U_first[1:j])), c(sum(first_inf_PCR_pt_V[1:j]), sum(first_inf_PCR_pt_U[1:j])))$conf.int[c(2,1)])
    
   
     #... for first pcr-detected asymptomatic infection IRR, censoring after first PCR-detected asymptomatic infection
    VE_firstasymPCR_res1<-c(1-rateratio.test(c(cum_pcr_asym_V_first[j], cum_pcr_asym_U_first[j]), c(first_asym_PCR_pt_V[j], first_asym_PCR_pt_U[j]))$estimate[1],
                        1-rateratio.test(c(cum_pcr_asym_V_first[j], cum_pcr_asym_U_first[j]), c(first_asym_PCR_pt_V[j], first_asym_PCR_pt_U[j]))$conf.int[c(2,1)])
    VE_firstasymPCR_res2<-c(1-rateratio.test(c(sum(cum_pcr_asym_V_first[1:j]), sum(cum_pcr_asym_U_first[1:j])), c(sum(first_asym_PCR_pt_V[1:j]), sum(first_asym_PCR_pt_U[1:j])))$estimate[1],
                        1-rateratio.test(c(sum(cum_pcr_asym_V_first[1:j]), sum(cum_pcr_asym_U_first[1:j])), c(sum(first_asym_PCR_pt_V[1:j]), sum(first_asym_PCR_pt_U[1:j])))$conf.int[c(2,1)])
    
    #... for first pcr-detected asymptomatic infection IRR, censoring after first PCR-detected infection
    VE_firstasymPCR2_res1<-c(1-rateratio.test(c(cum_pcr_asym_V_first2[j], cum_pcr_asym_U_first2[j]), c(first_inf_PCR_pt_V[j], first_inf_PCR_pt_U[j]))$estimate[1],
                        1-rateratio.test(c(cum_pcr_asym_V_first2[j], cum_pcr_asym_U_first2[j]), c(first_inf_PCR_pt_V[j], first_inf_PCR_pt_U[j]))$conf.int[c(2,1)])
    VE_firstasymPCR2_res2<-c(1-rateratio.test(c(sum(cum_pcr_asym_V_first2[1:j]), sum(cum_pcr_asym_U_first2[1:j])), c(sum(first_inf_PCR_pt_V[1:j]), sum(first_inf_PCR_pt_U[1:j])))$estimate[1],
                        1-rateratio.test(c(sum(cum_pcr_asym_V_first2[1:j]), sum(cum_pcr_asym_U_first2[1:j])), c(sum(first_inf_PCR_pt_V[1:j]), sum(first_inf_PCR_pt_U[1:j])))$conf.int[c(2,1)])
    
    #...for proportion infected RR 
    VE_RR_inf_res1<- 1-ratesci::scoreci(cum_inf_V_first[j],(n*pv*rho),cum_inf_U_first[j],(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]
    VE_RR_inf_res2<- 1-ratesci::scoreci(sum(cum_inf_V_first[1:j]),(n*pv*rho),sum(cum_inf_U_first[1:j]),(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]
    
    #...for proportion asymptomatic RR
    VE_RR_asym_res1<- 1-ratesci::scoreci(cum_asym_V_first[j],(n*pv*rho),cum_asym_U_first[j],(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]
    VE_RR_asym_res2<- 1-ratesci::scoreci(sum(cum_asym_V_first[1:j]),(n*pv*rho), sum(cum_asym_U_first[1:j]),(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]

    #...for proportion symptomatic RR
    VE_RR_sym_res1<- 1-ratesci::scoreci(cum_sym_V_first[j],(n*pv*rho),cum_sym_U_first[j],(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]
    VE_RR_sym_res2<- 1-ratesci::scoreci(sum(cum_sym_V_first[1:j]),(n*pv*rho), sum(cum_sym_U_first[1:j]),(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]
    
    #... for first pcr-detected infection RR
    VE_RR_inf_pcr_res1<- 1-ratesci::scoreci(cum_pcr_inf_V_first[j],(n*pv*rho),cum_pcr_inf_U_first[j],(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]
    VE_RR_inf_pcr_res2<- 1-ratesci::scoreci(sum(cum_pcr_inf_V_first[1:j]),(n*pv*rho), sum(cum_pcr_inf_U_first[1:j]),(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]
    
    #... for first pcr-detected asym RR
    VE_RR_asym_pcr_res1<- 1-ratesci::scoreci(cum_pcr_asym_V_first[j],(n*pv*rho),cum_pcr_asym_U_first[j],(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]
    VE_RR_asym_pcr_res2<- 1-ratesci::scoreci(sum(cum_pcr_asym_V_first[1:j]),(n*pv*rho), sum(cum_pcr_asym_U_first[1:j]),(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]

#### Part I) Seroconversions ####
    
  #At the end of each time interval I move people who have a positive serology test from the serology-negative layer (nser) to the serology-positive layer (yser). This includes the true seroconversions (test sensitivity x N participants in an R compartment) and the false positives ((1-specificity) x positives in all other compartments). 
    
      #1. Shift people positive for antibody test from nser to yser. This includes a) true +ves (R box, probability = sensitivity of test) and b) false +ves (proportion of those not in an R box, determined by 1-specificity)
    #incidences (true seroconversions)  
    ser_V_nser_npcr_RAns[j,]<-rbinom(ncat, V_nser_npcr_RAns, s.sens.asym)
    ser_V_nser_npcr_RS[j,]<-rbinom(ncat, V_nser_npcr_RS, s.sens.sym)
    ser_V_nser_npcr_RAps[j,]<-rbinom(ncat, V_nser_npcr_RAps, s.sens.sym)
    
    ser_V_nser_ypcr_RAns[j,]<-rbinom(ncat, V_nser_ypcr_RAns, s.sens.asym)
    ser_V_nser_ypcr_RS[j,]<-rbinom(ncat, V_nser_ypcr_RS, s.sens.sym)
    ser_V_nser_ypcr_RAps[j,]<-rbinom(ncat, V_nser_ypcr_RAps, s.sens.sym)
    
    ser_U_nser_npcr_RAns[j,]<-rbinom(ncat, U_nser_npcr_RAns, s.sens.asym)
    ser_U_nser_npcr_RS[j,]<-rbinom(ncat, U_nser_npcr_RS, s.sens.sym)
    ser_U_nser_npcr_RAps[j,]<-rbinom(ncat, U_nser_npcr_RAps, s.sens.sym)
    
    ser_U_nser_ypcr_RAns[j,]<-rbinom(ncat, U_nser_ypcr_RAns, s.sens.asym)
    ser_U_nser_ypcr_RS[j,]<-rbinom(ncat, U_nser_ypcr_RS, s.sens.sym)
    ser_U_nser_ypcr_RAps[j,]<-rbinom(ncat, U_nser_ypcr_RAps, s.sens.sym)
    
    #incidences (false positives)
    
    #V_npcr
    ser_V_nser_npcr_V[j,]<-     rbinom(ncat, V_nser_npcr_V, (1-s.specificity))
    ser_V_nser_npcr_IAns1[j,]<-  rbinom(ncat, V_nser_npcr_IAns[1,], (1-s.specificity))
    ser_V_nser_npcr_IAns2[j,]<-  rbinom(ncat, V_nser_npcr_IAns[2,], (1-s.specificity))
    ser_V_nser_npcr_IAns3[j,]<-  rbinom(ncat, V_nser_npcr_IAns[3,], (1-s.specificity))
    ser_V_nser_npcr_IAns4[j,]<-  rbinom(ncat, V_nser_npcr_IAns[4,], (1-s.specificity))
    ser_V_nser_npcr_IAns5[j,]<-  rbinom(ncat, V_nser_npcr_IAns[5,], (1-s.specificity))
    ser_V_nser_npcr_IAns6[j,]<-  rbinom(ncat, V_nser_npcr_IAns[6,], (1-s.specificity))
    ser_V_nser_npcr_IAns7[j,]<-  rbinom(ncat, V_nser_npcr_IAns[7,], (1-s.specificity))
    ser_V_nser_npcr_IAns8[j,]<-  rbinom(ncat, V_nser_npcr_IAns[8,], (1-s.specificity))
    ser_V_nser_npcr_IAns9[j,]<-  rbinom(ncat, V_nser_npcr_IAns[9,], (1-s.specificity))
    ser_V_nser_npcr_IAns10[j,]<-  rbinom(ncat, V_nser_npcr_IAns[10,], (1-s.specificity))
    ser_V_nser_npcr_IAns11[j,]<-  rbinom(ncat, V_nser_npcr_IAns[11,], (1-s.specificity))
    ser_V_nser_npcr_IAns12[j,]<-  rbinom(ncat, V_nser_npcr_IAns[12,], (1-s.specificity))
    ser_V_nser_npcr_WAns[j,]<-  rbinom(ncat, V_nser_npcr_WAns, (1-s.specificity))
    ser_V_nser_npcr_S[j,]<-     rbinom(ncat, V_nser_npcr_S, (1-s.specificity))
    ser_V_nser_npcr_IS1[j,]<-  rbinom(ncat, V_nser_npcr_IS[1,], (1-s.specificity))
    ser_V_nser_npcr_IS2[j,]<-  rbinom(ncat, V_nser_npcr_IS[2,], (1-s.specificity))
    ser_V_nser_npcr_IS3[j,]<-  rbinom(ncat, V_nser_npcr_IS[3,], (1-s.specificity))
    ser_V_nser_npcr_IS4[j,]<-  rbinom(ncat, V_nser_npcr_IS[4,], (1-s.specificity))
    ser_V_nser_npcr_IS5[j,]<-  rbinom(ncat, V_nser_npcr_IS[5,], (1-s.specificity))
    ser_V_nser_npcr_IS6[j,]<-  rbinom(ncat, V_nser_npcr_IS[6,], (1-s.specificity))
    ser_V_nser_npcr_IS7[j,]<-  rbinom(ncat, V_nser_npcr_IS[7,], (1-s.specificity))
    ser_V_nser_npcr_IS8[j,]<-  rbinom(ncat, V_nser_npcr_IS[8,], (1-s.specificity))
    ser_V_nser_npcr_IS9[j,]<-  rbinom(ncat, V_nser_npcr_IS[9,], (1-s.specificity))
    ser_V_nser_npcr_IS10[j,]<-  rbinom(ncat, V_nser_npcr_IS[10,], (1-s.specificity))
    ser_V_nser_npcr_IS11[j,]<-  rbinom(ncat, V_nser_npcr_IS[11,], (1-s.specificity))
    ser_V_nser_npcr_IS12[j,]<-  rbinom(ncat, V_nser_npcr_IS[12,], (1-s.specificity))
    ser_V_nser_npcr_WS[j,]<-    rbinom(ncat, V_nser_npcr_WS, (1-s.specificity))
    ser_V_nser_npcr_IAps1[j,]<-  rbinom(ncat, V_nser_npcr_IAps[1,], (1-s.specificity))
    ser_V_nser_npcr_IAps2[j,]<-  rbinom(ncat, V_nser_npcr_IAps[2,], (1-s.specificity))
    ser_V_nser_npcr_IAps3[j,]<-  rbinom(ncat, V_nser_npcr_IAps[3,], (1-s.specificity))
    ser_V_nser_npcr_IAps4[j,]<-  rbinom(ncat, V_nser_npcr_IAps[4,], (1-s.specificity))
    ser_V_nser_npcr_IAps5[j,]<-  rbinom(ncat, V_nser_npcr_IAps[5,], (1-s.specificity))
    ser_V_nser_npcr_IAps6[j,]<-  rbinom(ncat, V_nser_npcr_IAps[6,], (1-s.specificity))
    ser_V_nser_npcr_IAps7[j,]<-  rbinom(ncat, V_nser_npcr_IAps[7,], (1-s.specificity))
    ser_V_nser_npcr_IAps8[j,]<-  rbinom(ncat, V_nser_npcr_IAps[8,], (1-s.specificity))
    ser_V_nser_npcr_IAps9[j,]<-  rbinom(ncat, V_nser_npcr_IAps[9,], (1-s.specificity))
    ser_V_nser_npcr_IAps10[j,]<-  rbinom(ncat, V_nser_npcr_IAps[10,], (1-s.specificity))
    ser_V_nser_npcr_IAps11[j,]<-  rbinom(ncat, V_nser_npcr_IAps[11,], (1-s.specificity))
    ser_V_nser_npcr_IAps12[j,]<-  rbinom(ncat, V_nser_npcr_IAps[12,], (1-s.specificity))
    ser_V_nser_npcr_WAps[j,]<-  rbinom(ncat, V_nser_npcr_WAps, (1-s.specificity))
    
    #V_ypcr
    ser_V_nser_ypcr_V[j,]<-     rbinom(ncat, V_nser_ypcr_V, (1-s.specificity))
    ser_V_nser_ypcr_IAns1[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[1,], (1-s.specificity))
    ser_V_nser_ypcr_IAns2[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[2,], (1-s.specificity))
    ser_V_nser_ypcr_IAns3[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[3,], (1-s.specificity))
    ser_V_nser_ypcr_IAns4[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[4,], (1-s.specificity))
    ser_V_nser_ypcr_IAns5[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[5,], (1-s.specificity))
    ser_V_nser_ypcr_IAns6[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[6,], (1-s.specificity))
    ser_V_nser_ypcr_IAns7[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[7,], (1-s.specificity))
    ser_V_nser_ypcr_IAns8[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[8,], (1-s.specificity))
    ser_V_nser_ypcr_IAns9[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[9,], (1-s.specificity))
    ser_V_nser_ypcr_IAns10[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[10,], (1-s.specificity))
    ser_V_nser_ypcr_IAns11[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[11,], (1-s.specificity))
    ser_V_nser_ypcr_IAns12[j,]<-  rbinom(ncat, V_nser_ypcr_IAns[12,], (1-s.specificity))
    ser_V_nser_ypcr_WAns[j,]<-  rbinom(ncat, V_nser_ypcr_WAns, (1-s.specificity))
    ser_V_nser_ypcr_S[j,]<-     rbinom(ncat, V_nser_ypcr_S, (1-s.specificity))
    ser_V_nser_ypcr_IS1[j,]<-  rbinom(ncat, V_nser_ypcr_IS[1,], (1-s.specificity))
    ser_V_nser_ypcr_IS2[j,]<-  rbinom(ncat, V_nser_ypcr_IS[2,], (1-s.specificity))
    ser_V_nser_ypcr_IS3[j,]<-  rbinom(ncat, V_nser_ypcr_IS[3,], (1-s.specificity))
    ser_V_nser_ypcr_IS4[j,]<-  rbinom(ncat, V_nser_ypcr_IS[4,], (1-s.specificity))
    ser_V_nser_ypcr_IS5[j,]<-  rbinom(ncat, V_nser_ypcr_IS[5,], (1-s.specificity))
    ser_V_nser_ypcr_IS6[j,]<-  rbinom(ncat, V_nser_ypcr_IS[6,], (1-s.specificity))
    ser_V_nser_ypcr_IS7[j,]<-  rbinom(ncat, V_nser_ypcr_IS[7,], (1-s.specificity))
    ser_V_nser_ypcr_IS8[j,]<-  rbinom(ncat, V_nser_ypcr_IS[8,], (1-s.specificity))
    ser_V_nser_ypcr_IS9[j,]<-  rbinom(ncat, V_nser_ypcr_IS[9,], (1-s.specificity))
    ser_V_nser_ypcr_IS10[j,]<-  rbinom(ncat, V_nser_ypcr_IS[10,], (1-s.specificity))
    ser_V_nser_ypcr_IS11[j,]<-  rbinom(ncat, V_nser_ypcr_IS[11,], (1-s.specificity))
    ser_V_nser_ypcr_IS12[j,]<-  rbinom(ncat, V_nser_ypcr_IS[12,], (1-s.specificity))
    ser_V_nser_ypcr_WS[j,]<-    rbinom(ncat, V_nser_ypcr_WS, (1-s.specificity))
    ser_V_nser_ypcr_IAps1[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[1,], (1-s.specificity))
    ser_V_nser_ypcr_IAps2[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[2,], (1-s.specificity))
    ser_V_nser_ypcr_IAps3[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[3,], (1-s.specificity))
    ser_V_nser_ypcr_IAps4[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[4,], (1-s.specificity))
    ser_V_nser_ypcr_IAps5[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[5,], (1-s.specificity))
    ser_V_nser_ypcr_IAps6[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[6,], (1-s.specificity))
    ser_V_nser_ypcr_IAps7[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[7,], (1-s.specificity))
    ser_V_nser_ypcr_IAps8[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[8,], (1-s.specificity))
    ser_V_nser_ypcr_IAps9[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[9,], (1-s.specificity))
    ser_V_nser_ypcr_IAps10[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[10,], (1-s.specificity))
    ser_V_nser_ypcr_IAps11[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[11,], (1-s.specificity))
    ser_V_nser_ypcr_IAps12[j,]<-  rbinom(ncat, V_nser_ypcr_IAps[12,], (1-s.specificity))
    ser_V_nser_ypcr_WAps[j,]<-  rbinom(ncat, V_nser_ypcr_WAps, (1-s.specificity))
    
    #U_npcr
    ser_U_nser_npcr_IAns1[j,]<-  rbinom(ncat, U_nser_npcr_IAns[1,], (1-s.specificity))
    ser_U_nser_npcr_IAns2[j,]<-  rbinom(ncat, U_nser_npcr_IAns[2,], (1-s.specificity))
    ser_U_nser_npcr_IAns3[j,]<-  rbinom(ncat, U_nser_npcr_IAns[3,], (1-s.specificity))
    ser_U_nser_npcr_IAns4[j,]<-  rbinom(ncat, U_nser_npcr_IAns[4,], (1-s.specificity))
    ser_U_nser_npcr_IAns5[j,]<-  rbinom(ncat, U_nser_npcr_IAns[5,], (1-s.specificity))
    ser_U_nser_npcr_IAns6[j,]<-  rbinom(ncat, U_nser_npcr_IAns[6,], (1-s.specificity))
    ser_U_nser_npcr_IAns7[j,]<-  rbinom(ncat, U_nser_npcr_IAns[7,], (1-s.specificity))
    ser_U_nser_npcr_IAns8[j,]<-  rbinom(ncat, U_nser_npcr_IAns[8,], (1-s.specificity))
    ser_U_nser_npcr_IAns9[j,]<-  rbinom(ncat, U_nser_npcr_IAns[9,], (1-s.specificity))
    ser_U_nser_npcr_IAns10[j,]<-  rbinom(ncat, U_nser_npcr_IAns[10,], (1-s.specificity))
    ser_U_nser_npcr_IAns11[j,]<-  rbinom(ncat, U_nser_npcr_IAns[11,], (1-s.specificity))
    ser_U_nser_npcr_IAns12[j,]<-  rbinom(ncat, U_nser_npcr_IAns[12,], (1-s.specificity))
    ser_U_nser_npcr_WAns[j,]<-  rbinom(ncat, U_nser_npcr_WAns, (1-s.specificity))
    ser_U_nser_npcr_S[j,]<-     rbinom(ncat, U_nser_npcr_S, (1-s.specificity))
    ser_U_nser_npcr_IS1[j,]<-  rbinom(ncat, U_nser_npcr_IS[1,], (1-s.specificity))
    ser_U_nser_npcr_IS2[j,]<-  rbinom(ncat, U_nser_npcr_IS[2,], (1-s.specificity))
    ser_U_nser_npcr_IS3[j,]<-  rbinom(ncat, U_nser_npcr_IS[3,], (1-s.specificity))
    ser_U_nser_npcr_IS4[j,]<-  rbinom(ncat, U_nser_npcr_IS[4,], (1-s.specificity))
    ser_U_nser_npcr_IS5[j,]<-  rbinom(ncat, U_nser_npcr_IS[5,], (1-s.specificity))
    ser_U_nser_npcr_IS6[j,]<-  rbinom(ncat, U_nser_npcr_IS[6,], (1-s.specificity))
    ser_U_nser_npcr_IS7[j,]<-  rbinom(ncat, U_nser_npcr_IS[7,], (1-s.specificity))
    ser_U_nser_npcr_IS8[j,]<-  rbinom(ncat, U_nser_npcr_IS[8,], (1-s.specificity))
    ser_U_nser_npcr_IS9[j,]<-  rbinom(ncat, U_nser_npcr_IS[9,], (1-s.specificity))
    ser_U_nser_npcr_IS10[j,]<-  rbinom(ncat, U_nser_npcr_IS[10,], (1-s.specificity))
    ser_U_nser_npcr_IS11[j,]<-  rbinom(ncat, U_nser_npcr_IS[11,], (1-s.specificity))
    ser_U_nser_npcr_IS12[j,]<-  rbinom(ncat, U_nser_npcr_IS[12,], (1-s.specificity))
    ser_U_nser_npcr_WS[j,]<-    rbinom(ncat, U_nser_npcr_WS, (1-s.specificity))
    ser_U_nser_npcr_IAps1[j,]<-  rbinom(ncat, U_nser_npcr_IAps[1,], (1-s.specificity))
    ser_U_nser_npcr_IAps2[j,]<-  rbinom(ncat, U_nser_npcr_IAps[2,], (1-s.specificity))
    ser_U_nser_npcr_IAps3[j,]<-  rbinom(ncat, U_nser_npcr_IAps[3,], (1-s.specificity))
    ser_U_nser_npcr_IAps4[j,]<-  rbinom(ncat, U_nser_npcr_IAps[4,], (1-s.specificity))
    ser_U_nser_npcr_IAps5[j,]<-  rbinom(ncat, U_nser_npcr_IAps[5,], (1-s.specificity))
    ser_U_nser_npcr_IAps6[j,]<-  rbinom(ncat, U_nser_npcr_IAps[6,], (1-s.specificity))
    ser_U_nser_npcr_IAps7[j,]<-  rbinom(ncat, U_nser_npcr_IAps[7,], (1-s.specificity))
    ser_U_nser_npcr_IAps8[j,]<-  rbinom(ncat, U_nser_npcr_IAps[8,], (1-s.specificity))
    ser_U_nser_npcr_IAps9[j,]<-  rbinom(ncat, U_nser_npcr_IAps[9,], (1-s.specificity))
    ser_U_nser_npcr_IAps10[j,]<-  rbinom(ncat, U_nser_npcr_IAps[10,], (1-s.specificity))
    ser_U_nser_npcr_IAps11[j,]<-  rbinom(ncat, U_nser_npcr_IAps[11,], (1-s.specificity))
    ser_U_nser_npcr_IAps12[j,]<-  rbinom(ncat, U_nser_npcr_IAps[12,], (1-s.specificity))
    ser_U_nser_npcr_WAps[j,]<-  rbinom(ncat, U_nser_npcr_WAps, (1-s.specificity))
    
    #U_ypcr
    ser_U_nser_ypcr_IAns1[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[1,], (1-s.specificity))
    ser_U_nser_ypcr_IAns2[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[2,], (1-s.specificity))
    ser_U_nser_ypcr_IAns3[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[3,], (1-s.specificity))
    ser_U_nser_ypcr_IAns4[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[4,], (1-s.specificity))
    ser_U_nser_ypcr_IAns5[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[5,], (1-s.specificity))
    ser_U_nser_ypcr_IAns6[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[6,], (1-s.specificity))
    ser_U_nser_ypcr_IAns7[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[7,], (1-s.specificity))
    ser_U_nser_ypcr_IAns8[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[8,], (1-s.specificity))
    ser_U_nser_ypcr_IAns9[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[9,], (1-s.specificity))
    ser_U_nser_ypcr_IAns10[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[10,], (1-s.specificity))
    ser_U_nser_ypcr_IAns11[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[11,], (1-s.specificity))
    ser_U_nser_ypcr_IAns12[j,]<-  rbinom(ncat, U_nser_ypcr_IAns[12,], (1-s.specificity))
    ser_U_nser_ypcr_WAns[j,]<-  rbinom(ncat, U_nser_ypcr_WAns, (1-s.specificity))
    ser_U_nser_ypcr_S[j,]<-     rbinom(ncat, U_nser_ypcr_S, (1-s.specificity))
    ser_U_nser_ypcr_IS1[j,]<-  rbinom(ncat, U_nser_ypcr_IS[1,], (1-s.specificity))
    ser_U_nser_ypcr_IS2[j,]<-  rbinom(ncat, U_nser_ypcr_IS[2,], (1-s.specificity))
    ser_U_nser_ypcr_IS3[j,]<-  rbinom(ncat, U_nser_ypcr_IS[3,], (1-s.specificity))
    ser_U_nser_ypcr_IS4[j,]<-  rbinom(ncat, U_nser_ypcr_IS[4,], (1-s.specificity))
    ser_U_nser_ypcr_IS5[j,]<-  rbinom(ncat, U_nser_ypcr_IS[5,], (1-s.specificity))
    ser_U_nser_ypcr_IS6[j,]<-  rbinom(ncat, U_nser_ypcr_IS[6,], (1-s.specificity))
    ser_U_nser_ypcr_IS7[j,]<-  rbinom(ncat, U_nser_ypcr_IS[7,], (1-s.specificity))
    ser_U_nser_ypcr_IS8[j,]<-  rbinom(ncat, U_nser_ypcr_IS[8,], (1-s.specificity))
    ser_U_nser_ypcr_IS9[j,]<-  rbinom(ncat, U_nser_ypcr_IS[9,], (1-s.specificity))
    ser_U_nser_ypcr_IS10[j,]<-  rbinom(ncat, U_nser_ypcr_IS[10,], (1-s.specificity))
    ser_U_nser_ypcr_IS11[j,]<-  rbinom(ncat, U_nser_ypcr_IS[11,], (1-s.specificity))
    ser_U_nser_ypcr_IS12[j,]<-  rbinom(ncat, U_nser_ypcr_IS[12,], (1-s.specificity))
    ser_U_nser_ypcr_WS[j,]<-    rbinom(ncat, U_nser_ypcr_WS, (1-s.specificity))
    ser_U_nser_ypcr_IAps1[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[1,], (1-s.specificity))
    ser_U_nser_ypcr_IAps2[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[2,], (1-s.specificity))
    ser_U_nser_ypcr_IAps3[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[3,], (1-s.specificity))
    ser_U_nser_ypcr_IAps4[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[4,], (1-s.specificity))
    ser_U_nser_ypcr_IAps5[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[5,], (1-s.specificity))
    ser_U_nser_ypcr_IAps6[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[6,], (1-s.specificity))
    ser_U_nser_ypcr_IAps7[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[7,], (1-s.specificity))
    ser_U_nser_ypcr_IAps8[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[8,], (1-s.specificity))
    ser_U_nser_ypcr_IAps9[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[9,], (1-s.specificity))
    ser_U_nser_ypcr_IAps10[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[10,], (1-s.specificity))
    ser_U_nser_ypcr_IAps11[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[11,], (1-s.specificity))
    ser_U_nser_ypcr_IAps12[j,]<-  rbinom(ncat, U_nser_ypcr_IAps[12,], (1-s.specificity))
    ser_U_nser_ypcr_WAps[j,]<-  rbinom(ncat, U_nser_ypcr_WAps, (1-s.specificity))
    
    #update state variables
    
    #Not serology-detected
    #Recovereds (true +ves)

    V_nser_npcr_RAns<- V_nser_npcr_RAns - ser_V_nser_npcr_RAns[j,]
    V_nser_npcr_RS<- V_nser_npcr_RS - ser_V_nser_npcr_RS[j,]
    V_nser_npcr_RAps<- V_nser_npcr_RAps - ser_V_nser_npcr_RAps[j,]
    
    V_nser_ypcr_RAns<- V_nser_ypcr_RAns - ser_V_nser_ypcr_RAns[j,]
    V_nser_ypcr_RS<- V_nser_ypcr_RS - ser_V_nser_ypcr_RS[j,]
    V_nser_ycr_RAps<- V_nser_ypcr_RAps - ser_V_nser_ypcr_RAps[j,]

    U_nser_npcr_RAns<- U_nser_npcr_RAns - ser_U_nser_npcr_RAns[j,]
    U_nser_npcr_RS<- U_nser_npcr_RS - ser_U_nser_npcr_RS[j,]
    U_nser_npcr_RAps<- U_nser_npcr_RAps - ser_U_nser_npcr_RAps[j,]
    
    U_nser_ypcr_RAns<- U_nser_ypcr_RAns - ser_U_nser_ypcr_RAns[j,]
    U_nser_ypcr_RS<- U_nser_ypcr_RS - ser_U_nser_ypcr_RS[j,]
    U_nser_ycr_RAps<- U_nser_ypcr_RAps - ser_U_nser_ypcr_RAps[j,]
    
    #Others (false +ves)
    #V_npcr
    V_nser_npcr_V<-    V_nser_npcr_V - ser_V_nser_npcr_V[j,] 
    V_nser_npcr_IAns[1,]<-  V_nser_npcr_IAns[1,] - ser_V_nser_npcr_IAns1[j,]
    V_nser_npcr_IAns[2,]<-  V_nser_npcr_IAns[2,] - ser_V_nser_npcr_IAns2[j,]
    V_nser_npcr_IAns[3,]<-  V_nser_npcr_IAns[3,] - ser_V_nser_npcr_IAns3[j,]
    V_nser_npcr_IAns[4,]<-  V_nser_npcr_IAns[4,] - ser_V_nser_npcr_IAns4[j,]
    V_nser_npcr_IAns[5,]<-  V_nser_npcr_IAns[5,] - ser_V_nser_npcr_IAns5[j,]
    V_nser_npcr_IAns[6,]<-  V_nser_npcr_IAns[6,] - ser_V_nser_npcr_IAns6[j,]
    V_nser_npcr_IAns[7,]<-  V_nser_npcr_IAns[7,] - ser_V_nser_npcr_IAns7[j,]
    V_nser_npcr_IAns[8,]<-  V_nser_npcr_IAns[8,] - ser_V_nser_npcr_IAns8[j,]
    V_nser_npcr_IAns[9,]<-  V_nser_npcr_IAns[9,] - ser_V_nser_npcr_IAns9[j,]
    V_nser_npcr_IAns[10,]<-  V_nser_npcr_IAns[10,] - ser_V_nser_npcr_IAns10[j,]
    V_nser_npcr_IAns[11,]<-  V_nser_npcr_IAns[11,] - ser_V_nser_npcr_IAns11[j,]
    V_nser_npcr_IAns[12,]<-  V_nser_npcr_IAns[12,] - ser_V_nser_npcr_IAns12[j,]
    V_nser_npcr_WAns<-  V_nser_npcr_WAns - ser_V_nser_npcr_WAns[j,]
    V_nser_npcr_S<-     V_nser_npcr_S - ser_V_nser_npcr_S[j,]
    V_nser_npcr_IS[1,]<-  V_nser_npcr_IS[1,] - ser_V_nser_npcr_IS1[j,]
    V_nser_npcr_IS[2,]<-  V_nser_npcr_IS[2,] - ser_V_nser_npcr_IS2[j,]
    V_nser_npcr_IS[3,]<-  V_nser_npcr_IS[3,] - ser_V_nser_npcr_IS3[j,]
    V_nser_npcr_IS[4,]<-  V_nser_npcr_IS[4,] - ser_V_nser_npcr_IS4[j,]
    V_nser_npcr_IS[5,]<-  V_nser_npcr_IS[5,] - ser_V_nser_npcr_IS5[j,]
    V_nser_npcr_IS[6,]<-  V_nser_npcr_IS[6,] - ser_V_nser_npcr_IS6[j,]
    V_nser_npcr_IS[7,]<-  V_nser_npcr_IS[7,] - ser_V_nser_npcr_IS7[j,]
    V_nser_npcr_IS[8,]<-  V_nser_npcr_IS[8,] - ser_V_nser_npcr_IS8[j,]
    V_nser_npcr_IS[9,]<-  V_nser_npcr_IS[9,] - ser_V_nser_npcr_IS9[j,]
    V_nser_npcr_IS[10,]<-  V_nser_npcr_IS[10,] - ser_V_nser_npcr_IS10[j,]
    V_nser_npcr_IS[11,]<-  V_nser_npcr_IS[11,] - ser_V_nser_npcr_IS11[j,]
    V_nser_npcr_IS[12,]<-  V_nser_npcr_IS[12,] - ser_V_nser_npcr_IS12[j,]
    V_nser_npcr_WS<-    V_nser_npcr_WS - ser_V_nser_npcr_WS[j,]
    V_nser_npcr_IAps[1,]<-  V_nser_npcr_IAps[1,] - ser_V_nser_npcr_IAps1[j,]
    V_nser_npcr_IAps[2,]<-  V_nser_npcr_IAps[2,] - ser_V_nser_npcr_IAps2[j,]
    V_nser_npcr_IAps[3,]<-  V_nser_npcr_IAps[3,] - ser_V_nser_npcr_IAps3[j,]
    V_nser_npcr_IAps[4,]<-  V_nser_npcr_IAps[4,] - ser_V_nser_npcr_IAps4[j,]
    V_nser_npcr_IAps[5,]<-  V_nser_npcr_IAps[5,] - ser_V_nser_npcr_IAps5[j,]
    V_nser_npcr_IAps[6,]<-  V_nser_npcr_IAps[6,] - ser_V_nser_npcr_IAps6[j,]
    V_nser_npcr_IAps[7,]<-  V_nser_npcr_IAps[7,] - ser_V_nser_npcr_IAps7[j,]
    V_nser_npcr_IAps[8,]<-  V_nser_npcr_IAps[8,] - ser_V_nser_npcr_IAps8[j,]
    V_nser_npcr_IAps[9,]<-  V_nser_npcr_IAps[9,] - ser_V_nser_npcr_IAps9[j,]
    V_nser_npcr_IAps[10,]<-  V_nser_npcr_IAps[10,] - ser_V_nser_npcr_IAps10[j,]
    V_nser_npcr_IAps[11,]<-  V_nser_npcr_IAps[11,] - ser_V_nser_npcr_IAps11[j,]
    V_nser_npcr_IAps[12,]<-  V_nser_npcr_IAps[12,] - ser_V_nser_npcr_IAps12[j,]
    V_nser_npcr_WAps<-  V_nser_npcr_WAps - ser_V_nser_npcr_WAps[j,]
    
    #V_ypcr
    V_nser_ypcr_V<-    V_nser_ypcr_V - ser_V_nser_ypcr_V[j,] 
    V_nser_ypcr_IAns[1,]<-  V_nser_ypcr_IAns[1,] - ser_V_nser_ypcr_IAns1[j,]
    V_nser_ypcr_IAns[2,]<-  V_nser_ypcr_IAns[2,] - ser_V_nser_ypcr_IAns2[j,]
    V_nser_ypcr_IAns[3,]<-  V_nser_ypcr_IAns[3,] - ser_V_nser_ypcr_IAns3[j,]
    V_nser_ypcr_IAns[4,]<-  V_nser_ypcr_IAns[4,] - ser_V_nser_ypcr_IAns4[j,]
    V_nser_ypcr_IAns[5,]<-  V_nser_ypcr_IAns[5,] - ser_V_nser_ypcr_IAns5[j,]
    V_nser_ypcr_IAns[6,]<-  V_nser_ypcr_IAns[6,] - ser_V_nser_ypcr_IAns6[j,]
    V_nser_ypcr_IAns[7,]<-  V_nser_ypcr_IAns[7,] - ser_V_nser_ypcr_IAns7[j,]
    V_nser_ypcr_IAns[8,]<-  V_nser_ypcr_IAns[8,] - ser_V_nser_ypcr_IAns8[j,]
    V_nser_ypcr_IAns[9,]<-  V_nser_ypcr_IAns[9,] - ser_V_nser_ypcr_IAns9[j,]
    V_nser_ypcr_IAns[10,]<-  V_nser_ypcr_IAns[10,] - ser_V_nser_ypcr_IAns10[j,]
    V_nser_ypcr_IAns[11,]<-  V_nser_ypcr_IAns[11,] - ser_V_nser_ypcr_IAns11[j,]
    V_nser_ypcr_IAns[12,]<-  V_nser_ypcr_IAns[12,] - ser_V_nser_ypcr_IAns12[j,]
    V_nser_ypcr_WAns<-  V_nser_ypcr_WAns - ser_V_nser_ypcr_WAns[j,]
    V_nser_ypcr_S<-     V_nser_ypcr_S - ser_V_nser_ypcr_S[j,]
    V_nser_ypcr_IS[1,]<-  V_nser_ypcr_IS[1,] - ser_V_nser_ypcr_IS1[j,]
    V_nser_ypcr_IS[2,]<-  V_nser_ypcr_IS[2,] - ser_V_nser_ypcr_IS2[j,]
    V_nser_ypcr_IS[3,]<-  V_nser_ypcr_IS[3,] - ser_V_nser_ypcr_IS3[j,]
    V_nser_ypcr_IS[4,]<-  V_nser_ypcr_IS[4,] - ser_V_nser_ypcr_IS4[j,]
    V_nser_ypcr_IS[5,]<-  V_nser_ypcr_IS[5,] - ser_V_nser_ypcr_IS5[j,]
    V_nser_ypcr_IS[6,]<-  V_nser_ypcr_IS[6,] - ser_V_nser_ypcr_IS6[j,]
    V_nser_ypcr_IS[7,]<-  V_nser_ypcr_IS[7,] - ser_V_nser_ypcr_IS7[j,]
    V_nser_ypcr_IS[8,]<-  V_nser_ypcr_IS[8,] - ser_V_nser_ypcr_IS8[j,]
    V_nser_ypcr_IS[9,]<-  V_nser_ypcr_IS[9,] - ser_V_nser_ypcr_IS9[j,]
    V_nser_ypcr_IS[10,]<-  V_nser_ypcr_IS[10,] - ser_V_nser_ypcr_IS10[j,]
    V_nser_ypcr_IS[11,]<-  V_nser_ypcr_IS[11,] - ser_V_nser_ypcr_IS11[j,]
    V_nser_ypcr_IS[12,]<-  V_nser_ypcr_IS[12,] - ser_V_nser_ypcr_IS12[j,]
    V_nser_ypcr_WS<-    V_nser_ypcr_WS - ser_V_nser_ypcr_WS[j,]
    V_nser_ypcr_IAps[1,]<-  V_nser_ypcr_IAps[1,] - ser_V_nser_ypcr_IAps1[j,]
    V_nser_ypcr_IAps[2,]<-  V_nser_ypcr_IAps[2,] - ser_V_nser_ypcr_IAps2[j,]
    V_nser_ypcr_IAps[3,]<-  V_nser_ypcr_IAps[3,] - ser_V_nser_ypcr_IAps3[j,]
    V_nser_ypcr_IAps[4,]<-  V_nser_ypcr_IAps[4,] - ser_V_nser_ypcr_IAps4[j,]
    V_nser_ypcr_IAps[5,]<-  V_nser_ypcr_IAps[5,] - ser_V_nser_ypcr_IAps5[j,]
    V_nser_ypcr_IAps[6,]<-  V_nser_ypcr_IAps[6,] - ser_V_nser_ypcr_IAps6[j,]
    V_nser_ypcr_IAps[7,]<-  V_nser_ypcr_IAps[7,] - ser_V_nser_ypcr_IAps7[j,]
    V_nser_ypcr_IAps[8,]<-  V_nser_ypcr_IAps[8,] - ser_V_nser_ypcr_IAps8[j,]
    V_nser_ypcr_IAps[9,]<-  V_nser_ypcr_IAps[9,] - ser_V_nser_ypcr_IAps9[j,]
    V_nser_ypcr_IAps[10,]<-  V_nser_ypcr_IAps[10,] - ser_V_nser_ypcr_IAps10[j,]
    V_nser_ypcr_IAps[11,]<-  V_nser_ypcr_IAps[11,] - ser_V_nser_ypcr_IAps11[j,]
    V_nser_ypcr_IAps[12,]<-  V_nser_ypcr_IAps[12,] - ser_V_nser_ypcr_IAps12[j,]
    V_nser_ypcr_WAps<-  V_nser_ypcr_WAps - ser_V_nser_ypcr_WAps[j,]

    #U_npcr
    U_nser_npcr_IAns[1,]<-  U_nser_npcr_IAns[1,] - ser_U_nser_npcr_IAns1[j,]
    U_nser_npcr_IAns[2,]<-  U_nser_npcr_IAns[2,] - ser_U_nser_npcr_IAns2[j,]
    U_nser_npcr_IAns[3,]<-  U_nser_npcr_IAns[3,] - ser_U_nser_npcr_IAns3[j,]
    U_nser_npcr_IAns[4,]<-  U_nser_npcr_IAns[4,] - ser_U_nser_npcr_IAns4[j,]
    U_nser_npcr_IAns[5,]<-  U_nser_npcr_IAns[5,] - ser_U_nser_npcr_IAns5[j,]
    U_nser_npcr_IAns[6,]<-  U_nser_npcr_IAns[6,] - ser_U_nser_npcr_IAns6[j,]
    U_nser_npcr_IAns[7,]<-  U_nser_npcr_IAns[7,] - ser_U_nser_npcr_IAns7[j,]
    U_nser_npcr_IAns[8,]<-  U_nser_npcr_IAns[8,] - ser_U_nser_npcr_IAns8[j,]
    U_nser_npcr_IAns[9,]<-  U_nser_npcr_IAns[9,] - ser_U_nser_npcr_IAns9[j,]
    U_nser_npcr_IAns[10,]<-  U_nser_npcr_IAns[10,] - ser_U_nser_npcr_IAns10[j,]
    U_nser_npcr_IAns[11,]<-  U_nser_npcr_IAns[11,] - ser_U_nser_npcr_IAns11[j,]
    U_nser_npcr_IAns[12,]<-  U_nser_npcr_IAns[12,] - ser_U_nser_npcr_IAns12[j,]
    U_nser_npcr_WAns<-  U_nser_npcr_WAns - ser_U_nser_npcr_WAns[j,]
    U_nser_npcr_S<-     U_nser_npcr_S - ser_U_nser_npcr_S[j,]
    U_nser_npcr_IS[1,]<-  U_nser_npcr_IS[1,] - ser_U_nser_npcr_IS1[j,]
    U_nser_npcr_IS[2,]<-  U_nser_npcr_IS[2,] - ser_U_nser_npcr_IS2[j,]
    U_nser_npcr_IS[3,]<-  U_nser_npcr_IS[3,] - ser_U_nser_npcr_IS3[j,]
    U_nser_npcr_IS[4,]<-  U_nser_npcr_IS[4,] - ser_U_nser_npcr_IS4[j,]
    U_nser_npcr_IS[5,]<-  U_nser_npcr_IS[5,] - ser_U_nser_npcr_IS5[j,]
    U_nser_npcr_IS[6,]<-  U_nser_npcr_IS[6,] - ser_U_nser_npcr_IS6[j,]
    U_nser_npcr_IS[7,]<-  U_nser_npcr_IS[7,] - ser_U_nser_npcr_IS7[j,]
    U_nser_npcr_IS[8,]<-  U_nser_npcr_IS[8,] - ser_U_nser_npcr_IS8[j,]
    U_nser_npcr_IS[9,]<-  U_nser_npcr_IS[9,] - ser_U_nser_npcr_IS9[j,]
    U_nser_npcr_IS[10,]<-  U_nser_npcr_IS[10,] - ser_U_nser_npcr_IS10[j,]
    U_nser_npcr_IS[11,]<-  U_nser_npcr_IS[11,] - ser_U_nser_npcr_IS11[j,]
    U_nser_npcr_IS[12,]<-  U_nser_npcr_IS[12,] - ser_U_nser_npcr_IS12[j,]
    U_nser_npcr_WS<-    U_nser_npcr_WS - ser_U_nser_npcr_WS[j,]
    U_nser_npcr_IAps[1,]<-  U_nser_npcr_IAps[1,] - ser_U_nser_npcr_IAps1[j,]
    U_nser_npcr_IAps[2,]<-  U_nser_npcr_IAps[2,] - ser_U_nser_npcr_IAps2[j,]
    U_nser_npcr_IAps[3,]<-  U_nser_npcr_IAps[3,] - ser_U_nser_npcr_IAps3[j,]
    U_nser_npcr_IAps[4,]<-  U_nser_npcr_IAps[4,] - ser_U_nser_npcr_IAps4[j,]
    U_nser_npcr_IAps[5,]<-  U_nser_npcr_IAps[5,] - ser_U_nser_npcr_IAps5[j,]
    U_nser_npcr_IAps[6,]<-  U_nser_npcr_IAps[6,] - ser_U_nser_npcr_IAps6[j,]
    U_nser_npcr_IAps[7,]<-  U_nser_npcr_IAps[7,] - ser_U_nser_npcr_IAps7[j,]
    U_nser_npcr_IAps[8,]<-  U_nser_npcr_IAps[8,] - ser_U_nser_npcr_IAps8[j,]
    U_nser_npcr_IAps[9,]<-  U_nser_npcr_IAps[9,] - ser_U_nser_npcr_IAps9[j,]
    U_nser_npcr_IAps[10,]<-  U_nser_npcr_IAps[10,] - ser_U_nser_npcr_IAps10[j,]
    U_nser_npcr_IAps[11,]<-  U_nser_npcr_IAps[11,] - ser_U_nser_npcr_IAps11[j,]
    U_nser_npcr_IAps[12,]<-  U_nser_npcr_IAps[12,] - ser_U_nser_npcr_IAps12[j,]
    U_nser_npcr_WAps<-  U_nser_npcr_WAps - ser_U_nser_npcr_WAps[j,]
    
    #U_ypcr
    U_nser_ypcr_IAns[1,]<-  U_nser_ypcr_IAns[1,] - ser_U_nser_ypcr_IAns1[j,]
    U_nser_ypcr_IAns[2,]<-  U_nser_ypcr_IAns[2,] - ser_U_nser_ypcr_IAns2[j,]
    U_nser_ypcr_IAns[3,]<-  U_nser_ypcr_IAns[3,] - ser_U_nser_ypcr_IAns3[j,]
    U_nser_ypcr_IAns[4,]<-  U_nser_ypcr_IAns[4,] - ser_U_nser_ypcr_IAns4[j,]
    U_nser_ypcr_IAns[5,]<-  U_nser_ypcr_IAns[5,] - ser_U_nser_ypcr_IAns5[j,]
    U_nser_ypcr_IAns[6,]<-  U_nser_ypcr_IAns[6,] - ser_U_nser_ypcr_IAns6[j,]
    U_nser_ypcr_IAns[7,]<-  U_nser_ypcr_IAns[7,] - ser_U_nser_ypcr_IAns7[j,]
    U_nser_ypcr_IAns[8,]<-  U_nser_ypcr_IAns[8,] - ser_U_nser_ypcr_IAns8[j,]
    U_nser_ypcr_IAns[9,]<-  U_nser_ypcr_IAns[9,] - ser_U_nser_ypcr_IAns9[j,]
    U_nser_ypcr_IAns[10,]<-  U_nser_ypcr_IAns[10,] - ser_U_nser_ypcr_IAns10[j,]
    U_nser_ypcr_IAns[11,]<-  U_nser_ypcr_IAns[11,] - ser_U_nser_ypcr_IAns11[j,]
    U_nser_ypcr_IAns[12,]<-  U_nser_ypcr_IAns[12,] - ser_U_nser_ypcr_IAns12[j,]
    U_nser_ypcr_WAns<-  U_nser_ypcr_WAns - ser_U_nser_ypcr_WAns[j,]
    U_nser_ypcr_S<-     U_nser_ypcr_S - ser_U_nser_ypcr_S[j,]
    U_nser_ypcr_IS[1,]<-  U_nser_ypcr_IS[1,] - ser_U_nser_ypcr_IS1[j,]
    U_nser_ypcr_IS[2,]<-  U_nser_ypcr_IS[2,] - ser_U_nser_ypcr_IS2[j,]
    U_nser_ypcr_IS[3,]<-  U_nser_ypcr_IS[3,] - ser_U_nser_ypcr_IS3[j,]
    U_nser_ypcr_IS[4,]<-  U_nser_ypcr_IS[4,] - ser_U_nser_ypcr_IS4[j,]
    U_nser_ypcr_IS[5,]<-  U_nser_ypcr_IS[5,] - ser_U_nser_ypcr_IS5[j,]
    U_nser_ypcr_IS[6,]<-  U_nser_ypcr_IS[6,] - ser_U_nser_ypcr_IS6[j,]
    U_nser_ypcr_IS[7,]<-  U_nser_ypcr_IS[7,] - ser_U_nser_ypcr_IS7[j,]
    U_nser_ypcr_IS[8,]<-  U_nser_ypcr_IS[8,] - ser_U_nser_ypcr_IS8[j,]
    U_nser_ypcr_IS[9,]<-  U_nser_ypcr_IS[9,] - ser_U_nser_ypcr_IS9[j,]
    U_nser_ypcr_IS[10,]<-  U_nser_ypcr_IS[10,] - ser_U_nser_ypcr_IS10[j,]
    U_nser_ypcr_IS[11,]<-  U_nser_ypcr_IS[11,] - ser_U_nser_ypcr_IS11[j,]
    U_nser_ypcr_IS[12,]<-  U_nser_ypcr_IS[12,] - ser_U_nser_ypcr_IS12[j,]
    U_nser_ypcr_WS<-    U_nser_ypcr_WS - ser_U_nser_ypcr_WS[j,]
    U_nser_ypcr_IAps[1,]<-  U_nser_ypcr_IAps[1,] - ser_U_nser_ypcr_IAps1[j,]
    U_nser_ypcr_IAps[2,]<-  U_nser_ypcr_IAps[2,] - ser_U_nser_ypcr_IAps2[j,]
    U_nser_ypcr_IAps[3,]<-  U_nser_ypcr_IAps[3,] - ser_U_nser_ypcr_IAps3[j,]
    U_nser_ypcr_IAps[4,]<-  U_nser_ypcr_IAps[4,] - ser_U_nser_ypcr_IAps4[j,]
    U_nser_ypcr_IAps[5,]<-  U_nser_ypcr_IAps[5,] - ser_U_nser_ypcr_IAps5[j,]
    U_nser_ypcr_IAps[6,]<-  U_nser_ypcr_IAps[6,] - ser_U_nser_ypcr_IAps6[j,]
    U_nser_ypcr_IAps[7,]<-  U_nser_ypcr_IAps[7,] - ser_U_nser_ypcr_IAps7[j,]
    U_nser_ypcr_IAps[8,]<-  U_nser_ypcr_IAps[8,] - ser_U_nser_ypcr_IAps8[j,]
    U_nser_ypcr_IAps[9,]<-  U_nser_ypcr_IAps[9,] - ser_U_nser_ypcr_IAps9[j,]
    U_nser_ypcr_IAps[10,]<-  U_nser_ypcr_IAps[10,] - ser_U_nser_ypcr_IAps10[j,]
    U_nser_ypcr_IAps[11,]<-  U_nser_ypcr_IAps[11,] - ser_U_nser_ypcr_IAps11[j,]
    U_nser_ypcr_IAps[12,]<-  U_nser_ypcr_IAps[12,] - ser_U_nser_ypcr_IAps12[j,]
    U_nser_ypcr_WAps<-  U_nser_ypcr_WAps - ser_U_nser_ypcr_WAps[j,]
    
   
    
    #Serology-detected 
    #Recovered (true +ves)

    V_yser_npcr_RAns<- V_yser_npcr_RAns + ser_V_nser_npcr_RAns[j,]
    V_yser_npcr_RS<- V_yser_npcr_RS + ser_V_nser_npcr_RS[j,]
    V_yser_npcr_RAps<- V_yser_npcr_RAps + ser_V_nser_npcr_RAps[j,]
    
    V_yser_ypcr_RAns<- V_yser_ypcr_RAns + ser_V_nser_ypcr_RAns[j,]
    V_yser_ypcr_RS<- V_yser_ypcr_RS + ser_V_nser_ypcr_RS[j,]
    V_yser_ypcr_RAps<- V_yser_ypcr_RAps + ser_V_nser_ypcr_RAps[j,]
    
    U_yser_npcr_RAns<- U_yser_npcr_RAns + ser_U_nser_npcr_RAns[j,]
    U_yser_npcr_RS<- U_yser_npcr_RS + ser_U_nser_npcr_RS[j,]
    U_yser_npcr_RAps<- U_yser_npcr_RAps + ser_U_nser_npcr_RAps[j,]
    
    U_yser_ypcr_RAns<- U_yser_ypcr_RAns + ser_U_nser_ypcr_RAns[j,]
    U_yser_ypcr_RS<- U_yser_ypcr_RS + ser_U_nser_ypcr_RS[j,]
    U_yser_ypcr_RAps<- U_yser_ypcr_RAps + ser_U_nser_ypcr_RAps[j,]


    #Others (false +ves)
    #V_npcr
    V_yser_npcr_V<-    V_yser_npcr_V + ser_V_nser_npcr_V[j,] 
    V_yser_npcr_IAns[1,]<-  V_yser_npcr_IAns[1,] + ser_V_nser_npcr_IAns1[j,]
    V_yser_npcr_IAns[2,]<-  V_yser_npcr_IAns[2,] + ser_V_nser_npcr_IAns2[j,]
    V_yser_npcr_IAns[3,]<-  V_yser_npcr_IAns[3,] + ser_V_nser_npcr_IAns3[j,]
    V_yser_npcr_IAns[4,]<-  V_yser_npcr_IAns[4,] + ser_V_nser_npcr_IAns4[j,]
    V_yser_npcr_IAns[5,]<-  V_yser_npcr_IAns[5,] + ser_V_nser_npcr_IAns5[j,]
    V_yser_npcr_IAns[6,]<-  V_yser_npcr_IAns[6,] + ser_V_nser_npcr_IAns6[j,]
    V_yser_npcr_IAns[7,]<-  V_yser_npcr_IAns[7,] + ser_V_nser_npcr_IAns7[j,]
    V_yser_npcr_IAns[8,]<-  V_yser_npcr_IAns[8,] + ser_V_nser_npcr_IAns8[j,]
    V_yser_npcr_IAns[9,]<-  V_yser_npcr_IAns[9,] + ser_V_nser_npcr_IAns9[j,]
    V_yser_npcr_IAns[10,]<-  V_yser_npcr_IAns[10,] + ser_V_nser_npcr_IAns10[j,]
    V_yser_npcr_IAns[11,]<-  V_yser_npcr_IAns[11,] + ser_V_nser_npcr_IAns11[j,]
    V_yser_npcr_IAns[12,]<-  V_yser_npcr_IAns[12,] + ser_V_nser_npcr_IAns12[j,]
    V_yser_npcr_WAns<-  V_yser_npcr_WAns + ser_V_nser_npcr_WAns[j,]
    V_yser_npcr_S<-     V_yser_npcr_S + ser_V_nser_npcr_S[j,]
    V_yser_npcr_IS[1,]<-  V_yser_npcr_IS[1,] + ser_V_nser_npcr_IS1[j,]
    V_yser_npcr_IS[2,]<-  V_yser_npcr_IS[2,] + ser_V_nser_npcr_IS2[j,]
    V_yser_npcr_IS[3,]<-  V_yser_npcr_IS[3,] + ser_V_nser_npcr_IS3[j,]
    V_yser_npcr_IS[4,]<-  V_yser_npcr_IS[4,] + ser_V_nser_npcr_IS4[j,]
    V_yser_npcr_IS[5,]<-  V_yser_npcr_IS[5,] + ser_V_nser_npcr_IS5[j,]
    V_yser_npcr_IS[6,]<-  V_yser_npcr_IS[6,] + ser_V_nser_npcr_IS6[j,]
    V_yser_npcr_IS[7,]<-  V_yser_npcr_IS[7,] + ser_V_nser_npcr_IS7[j,]
    V_yser_npcr_IS[8,]<-  V_yser_npcr_IS[8,] + ser_V_nser_npcr_IS8[j,]
    V_yser_npcr_IS[9,]<-  V_yser_npcr_IS[9,] + ser_V_nser_npcr_IS9[j,]
    V_yser_npcr_IS[10,]<-  V_yser_npcr_IS[10,] + ser_V_nser_npcr_IS10[j,]
    V_yser_npcr_IS[11,]<-  V_yser_npcr_IS[11,] + ser_V_nser_npcr_IS11[j,]
    V_yser_npcr_IS[12,]<-  V_yser_npcr_IS[12,] + ser_V_nser_npcr_IS12[j,]
    V_yser_npcr_WS<-    V_yser_npcr_WS + ser_V_nser_npcr_WS[j,]
    V_yser_npcr_IAps[1,]<-  V_yser_npcr_IAps[1,] + ser_V_nser_npcr_IAps1[j,]
    V_yser_npcr_IAps[2,]<-  V_yser_npcr_IAps[2,] + ser_V_nser_npcr_IAps2[j,]
    V_yser_npcr_IAps[3,]<-  V_yser_npcr_IAps[3,] + ser_V_nser_npcr_IAps3[j,]
    V_yser_npcr_IAps[4,]<-  V_yser_npcr_IAps[4,] + ser_V_nser_npcr_IAps4[j,]
    V_yser_npcr_IAps[5,]<-  V_yser_npcr_IAps[5,] + ser_V_nser_npcr_IAps5[j,]
    V_yser_npcr_IAps[6,]<-  V_yser_npcr_IAps[6,] + ser_V_nser_npcr_IAps6[j,]
    V_yser_npcr_IAps[7,]<-  V_yser_npcr_IAps[7,] + ser_V_nser_npcr_IAps7[j,]
    V_yser_npcr_IAps[8,]<-  V_yser_npcr_IAps[8,] + ser_V_nser_npcr_IAps8[j,]
    V_yser_npcr_IAps[9,]<-  V_yser_npcr_IAps[9,] + ser_V_nser_npcr_IAps9[j,]
    V_yser_npcr_IAps[10,]<-  V_yser_npcr_IAps[10,] + ser_V_nser_npcr_IAps10[j,]
    V_yser_npcr_IAps[11,]<-  V_yser_npcr_IAps[11,] + ser_V_nser_npcr_IAps11[j,]
    V_yser_npcr_IAps[12,]<-  V_yser_npcr_IAps[12,] + ser_V_nser_npcr_IAps12[j,]
    V_yser_npcr_WAps<-  V_yser_npcr_WAps + ser_V_nser_npcr_WAps[j,]
    
    #V_ypcr
    V_yser_ypcr_V<-    V_yser_ypcr_V + ser_V_nser_ypcr_V[j,] 
    V_yser_ypcr_IAns[1,]<-  V_yser_ypcr_IAns[1,] + ser_V_nser_ypcr_IAns1[j,]
    V_yser_ypcr_IAns[2,]<-  V_yser_ypcr_IAns[2,] + ser_V_nser_ypcr_IAns2[j,]
    V_yser_ypcr_IAns[3,]<-  V_yser_ypcr_IAns[3,] + ser_V_nser_ypcr_IAns3[j,]
    V_yser_ypcr_IAns[4,]<-  V_yser_ypcr_IAns[4,] + ser_V_nser_ypcr_IAns4[j,]
    V_yser_ypcr_IAns[5,]<-  V_yser_ypcr_IAns[5,] + ser_V_nser_ypcr_IAns5[j,]
    V_yser_ypcr_IAns[6,]<-  V_yser_ypcr_IAns[6,] + ser_V_nser_ypcr_IAns6[j,]
    V_yser_ypcr_IAns[7,]<-  V_yser_ypcr_IAns[7,] + ser_V_nser_ypcr_IAns7[j,]
    V_yser_ypcr_IAns[8,]<-  V_yser_ypcr_IAns[8,] + ser_V_nser_ypcr_IAns8[j,]
    V_yser_ypcr_IAns[9,]<-  V_yser_ypcr_IAns[9,] + ser_V_nser_ypcr_IAns9[j,]
    V_yser_ypcr_IAns[10,]<-  V_yser_ypcr_IAns[10,] + ser_V_nser_ypcr_IAns10[j,]
    V_yser_ypcr_IAns[11,]<-  V_yser_ypcr_IAns[11,] + ser_V_nser_ypcr_IAns11[j,]
    V_yser_ypcr_IAns[12,]<-  V_yser_ypcr_IAns[12,] + ser_V_nser_ypcr_IAns12[j,]
    V_yser_ypcr_WAns<-  V_yser_ypcr_WAns + ser_V_nser_ypcr_WAns[j,]
    V_yser_ypcr_S<-     V_yser_ypcr_S + ser_V_nser_ypcr_S[j,]
    V_yser_ypcr_IS[1,]<-  V_yser_ypcr_IS[1,] + ser_V_nser_ypcr_IS1[j,]
    V_yser_ypcr_IS[2,]<-  V_yser_ypcr_IS[2,] + ser_V_nser_ypcr_IS2[j,]
    V_yser_ypcr_IS[3,]<-  V_yser_ypcr_IS[3,] + ser_V_nser_ypcr_IS3[j,]
    V_yser_ypcr_IS[4,]<-  V_yser_ypcr_IS[4,] + ser_V_nser_ypcr_IS4[j,]
    V_yser_ypcr_IS[5,]<-  V_yser_ypcr_IS[5,] + ser_V_nser_ypcr_IS5[j,]
    V_yser_ypcr_IS[6,]<-  V_yser_ypcr_IS[6,] + ser_V_nser_ypcr_IS6[j,]
    V_yser_ypcr_IS[7,]<-  V_yser_ypcr_IS[7,] + ser_V_nser_ypcr_IS7[j,]
    V_yser_ypcr_IS[8,]<-  V_yser_ypcr_IS[8,] + ser_V_nser_ypcr_IS8[j,]
    V_yser_ypcr_IS[9,]<-  V_yser_ypcr_IS[9,] + ser_V_nser_ypcr_IS9[j,]
    V_yser_ypcr_IS[10,]<-  V_yser_ypcr_IS[10,] + ser_V_nser_ypcr_IS10[j,]
    V_yser_ypcr_IS[11,]<-  V_yser_ypcr_IS[11,] + ser_V_nser_ypcr_IS11[j,]
    V_yser_ypcr_IS[12,]<-  V_yser_ypcr_IS[12,] + ser_V_nser_ypcr_IS12[j,]
    V_yser_ypcr_WS<-    V_yser_ypcr_WS + ser_V_nser_ypcr_WS[j,]
    V_yser_ypcr_IAps[1,]<-  V_yser_ypcr_IAps[1,] + ser_V_nser_ypcr_IAps1[j,]
    V_yser_ypcr_IAps[2,]<-  V_yser_ypcr_IAps[2,] + ser_V_nser_ypcr_IAps2[j,]
    V_yser_ypcr_IAps[3,]<-  V_yser_ypcr_IAps[3,] + ser_V_nser_ypcr_IAps3[j,]
    V_yser_ypcr_IAps[4,]<-  V_yser_ypcr_IAps[4,] + ser_V_nser_ypcr_IAps4[j,]
    V_yser_ypcr_IAps[5,]<-  V_yser_ypcr_IAps[5,] + ser_V_nser_ypcr_IAps5[j,]
    V_yser_ypcr_IAps[6,]<-  V_yser_ypcr_IAps[6,] + ser_V_nser_ypcr_IAps6[j,]
    V_yser_ypcr_IAps[7,]<-  V_yser_ypcr_IAps[7,] + ser_V_nser_ypcr_IAps7[j,]
    V_yser_ypcr_IAps[8,]<-  V_yser_ypcr_IAps[8,] + ser_V_nser_ypcr_IAps8[j,]
    V_yser_ypcr_IAps[9,]<-  V_yser_ypcr_IAps[9,] + ser_V_nser_ypcr_IAps9[j,]
    V_yser_ypcr_IAps[10,]<-  V_yser_ypcr_IAps[10,] + ser_V_nser_ypcr_IAps10[j,]
    V_yser_ypcr_IAps[11,]<-  V_yser_ypcr_IAps[11,] + ser_V_nser_ypcr_IAps11[j,]
    V_yser_ypcr_IAps[12,]<-  V_yser_ypcr_IAps[12,] + ser_V_nser_ypcr_IAps12[j,]
    V_yser_ypcr_WAps<-  V_yser_ypcr_WAps + ser_V_nser_ypcr_WAps[j,]
    
    #U_npcr
    U_yser_npcr_IAns[1,]<-  U_yser_npcr_IAns[1,] + ser_U_nser_npcr_IAns1[j,]
    U_yser_npcr_IAns[2,]<-  U_yser_npcr_IAns[2,] + ser_U_nser_npcr_IAns2[j,]
    U_yser_npcr_IAns[3,]<-  U_yser_npcr_IAns[3,] + ser_U_nser_npcr_IAns3[j,]
    U_yser_npcr_IAns[4,]<-  U_yser_npcr_IAns[4,] + ser_U_nser_npcr_IAns4[j,]
    U_yser_npcr_IAns[5,]<-  U_yser_npcr_IAns[5,] + ser_U_nser_npcr_IAns5[j,]
    U_yser_npcr_IAns[6,]<-  U_yser_npcr_IAns[6,] + ser_U_nser_npcr_IAns6[j,]
    U_yser_npcr_IAns[7,]<-  U_yser_npcr_IAns[7,] + ser_U_nser_npcr_IAns7[j,]
    U_yser_npcr_IAns[8,]<-  U_yser_npcr_IAns[8,] + ser_U_nser_npcr_IAns8[j,]
    U_yser_npcr_IAns[9,]<-  U_yser_npcr_IAns[9,] + ser_U_nser_npcr_IAns9[j,]
    U_yser_npcr_IAns[10,]<-  U_yser_npcr_IAns[10,] + ser_U_nser_npcr_IAns10[j,]
    U_yser_npcr_IAns[11,]<-  U_yser_npcr_IAns[11,] + ser_U_nser_npcr_IAns11[j,]
    U_yser_npcr_IAns[12,]<-  U_yser_npcr_IAns[12,] + ser_U_nser_npcr_IAns12[j,]
    U_yser_npcr_WAns<-  U_yser_npcr_WAns + ser_U_nser_npcr_WAns[j,]
    U_yser_npcr_S<-     U_yser_npcr_S + ser_U_nser_npcr_S[j,]
    U_yser_npcr_IS[1,]<-  U_yser_npcr_IS[1,] + ser_U_nser_npcr_IS1[j,]
    U_yser_npcr_IS[2,]<-  U_yser_npcr_IS[2,] + ser_U_nser_npcr_IS2[j,]
    U_yser_npcr_IS[3,]<-  U_yser_npcr_IS[3,] + ser_U_nser_npcr_IS3[j,]
    U_yser_npcr_IS[4,]<-  U_yser_npcr_IS[4,] + ser_U_nser_npcr_IS4[j,]
    U_yser_npcr_IS[5,]<-  U_yser_npcr_IS[5,] + ser_U_nser_npcr_IS5[j,]
    U_yser_npcr_IS[6,]<-  U_yser_npcr_IS[6,] + ser_U_nser_npcr_IS6[j,]
    U_yser_npcr_IS[7,]<-  U_yser_npcr_IS[7,] + ser_U_nser_npcr_IS7[j,]
    U_yser_npcr_IS[8,]<-  U_yser_npcr_IS[8,] + ser_U_nser_npcr_IS8[j,]
    U_yser_npcr_IS[9,]<-  U_yser_npcr_IS[9,] + ser_U_nser_npcr_IS9[j,]
    U_yser_npcr_IS[10,]<-  U_yser_npcr_IS[10,] + ser_U_nser_npcr_IS10[j,]
    U_yser_npcr_IS[11,]<-  U_yser_npcr_IS[11,] + ser_U_nser_npcr_IS11[j,]
    U_yser_npcr_IS[12,]<-  U_yser_npcr_IS[12,] + ser_U_nser_npcr_IS12[j,]
    U_yser_npcr_WS<-    U_yser_npcr_WS + ser_U_nser_npcr_WS[j,]
    U_yser_npcr_IAps[1,]<-  U_yser_npcr_IAps[1,] + ser_U_nser_npcr_IAps1[j,]
    U_yser_npcr_IAps[2,]<-  U_yser_npcr_IAps[2,] + ser_U_nser_npcr_IAps2[j,]
    U_yser_npcr_IAps[3,]<-  U_yser_npcr_IAps[3,] + ser_U_nser_npcr_IAps3[j,]
    U_yser_npcr_IAps[4,]<-  U_yser_npcr_IAps[4,] + ser_U_nser_npcr_IAps4[j,]
    U_yser_npcr_IAps[5,]<-  U_yser_npcr_IAps[5,] + ser_U_nser_npcr_IAps5[j,]
    U_yser_npcr_IAps[6,]<-  U_yser_npcr_IAps[6,] + ser_U_nser_npcr_IAps6[j,]
    U_yser_npcr_IAps[7,]<-  U_yser_npcr_IAps[7,] + ser_U_nser_npcr_IAps7[j,]
    U_yser_npcr_IAps[8,]<-  U_yser_npcr_IAps[8,] + ser_U_nser_npcr_IAps8[j,]
    U_yser_npcr_IAps[9,]<-  U_yser_npcr_IAps[9,] + ser_U_nser_npcr_IAps9[j,]
    U_yser_npcr_IAps[10,]<-  U_yser_npcr_IAps[10,] + ser_U_nser_npcr_IAps10[j,]
    U_yser_npcr_IAps[11,]<-  U_yser_npcr_IAps[11,] + ser_U_nser_npcr_IAps11[j,]
    U_yser_npcr_IAps[12,]<-  U_yser_npcr_IAps[12,] + ser_U_nser_npcr_IAps12[j,]
    U_yser_npcr_WAps<-  U_yser_npcr_WAps + ser_U_nser_npcr_WAps[j,]
    
    #U_ypcr
    U_yser_ypcr_IAns[1,]<-  U_yser_ypcr_IAns[1,] + ser_U_nser_ypcr_IAns1[j,]
    U_yser_ypcr_IAns[2,]<-  U_yser_ypcr_IAns[2,] + ser_U_nser_ypcr_IAns2[j,]
    U_yser_ypcr_IAns[3,]<-  U_yser_ypcr_IAns[3,] + ser_U_nser_ypcr_IAns3[j,]
    U_yser_ypcr_IAns[4,]<-  U_yser_ypcr_IAns[4,] + ser_U_nser_ypcr_IAns4[j,]
    U_yser_ypcr_IAns[5,]<-  U_yser_ypcr_IAns[5,] + ser_U_nser_ypcr_IAns5[j,]
    U_yser_ypcr_IAns[6,]<-  U_yser_ypcr_IAns[6,] + ser_U_nser_ypcr_IAns6[j,]
    U_yser_ypcr_IAns[7,]<-  U_yser_ypcr_IAns[7,] + ser_U_nser_ypcr_IAns7[j,]
    U_yser_ypcr_IAns[8,]<-  U_yser_ypcr_IAns[8,] + ser_U_nser_ypcr_IAns8[j,]
    U_yser_ypcr_IAns[9,]<-  U_yser_ypcr_IAns[9,] + ser_U_nser_ypcr_IAns9[j,]
    U_yser_ypcr_IAns[10,]<-  U_yser_ypcr_IAns[10,] + ser_U_nser_ypcr_IAns10[j,]
    U_yser_ypcr_IAns[11,]<-  U_yser_ypcr_IAns[11,] + ser_U_nser_ypcr_IAns11[j,]
    U_yser_ypcr_IAns[12,]<-  U_yser_ypcr_IAns[12,] + ser_U_nser_ypcr_IAns12[j,]
    U_yser_ypcr_WAns<-  U_yser_ypcr_WAns + ser_U_nser_ypcr_WAns[j,]
    U_yser_ypcr_S<-     U_yser_ypcr_S + ser_U_nser_ypcr_S[j,]
    U_yser_ypcr_IS[1,]<-  U_yser_ypcr_IS[1,] + ser_U_nser_ypcr_IS1[j,]
    U_yser_ypcr_IS[2,]<-  U_yser_ypcr_IS[2,] + ser_U_nser_ypcr_IS2[j,]
    U_yser_ypcr_IS[3,]<-  U_yser_ypcr_IS[3,] + ser_U_nser_ypcr_IS3[j,]
    U_yser_ypcr_IS[4,]<-  U_yser_ypcr_IS[4,] + ser_U_nser_ypcr_IS4[j,]
    U_yser_ypcr_IS[5,]<-  U_yser_ypcr_IS[5,] + ser_U_nser_ypcr_IS5[j,]
    U_yser_ypcr_IS[6,]<-  U_yser_ypcr_IS[6,] + ser_U_nser_ypcr_IS6[j,]
    U_yser_ypcr_IS[7,]<-  U_yser_ypcr_IS[7,] + ser_U_nser_ypcr_IS7[j,]
    U_yser_ypcr_IS[8,]<-  U_yser_ypcr_IS[8,] + ser_U_nser_ypcr_IS8[j,]
    U_yser_ypcr_IS[9,]<-  U_yser_ypcr_IS[9,] + ser_U_nser_ypcr_IS9[j,]
    U_yser_ypcr_IS[10,]<-  U_yser_ypcr_IS[10,] + ser_U_nser_ypcr_IS10[j,]
    U_yser_ypcr_IS[11,]<-  U_yser_ypcr_IS[11,] + ser_U_nser_ypcr_IS11[j,]
    U_yser_ypcr_IS[12,]<-  U_yser_ypcr_IS[12,] + ser_U_nser_ypcr_IS12[j,]
    U_yser_ypcr_WS<-    U_yser_ypcr_WS + ser_U_nser_ypcr_WS[j,]
    U_yser_ypcr_IAps[1,]<-  U_yser_ypcr_IAps[1,] + ser_U_nser_ypcr_IAps1[j,]
    U_yser_ypcr_IAps[2,]<-  U_yser_ypcr_IAps[2,] + ser_U_nser_ypcr_IAps2[j,]
    U_yser_ypcr_IAps[3,]<-  U_yser_ypcr_IAps[3,] + ser_U_nser_ypcr_IAps3[j,]
    U_yser_ypcr_IAps[4,]<-  U_yser_ypcr_IAps[4,] + ser_U_nser_ypcr_IAps4[j,]
    U_yser_ypcr_IAps[5,]<-  U_yser_ypcr_IAps[5,] + ser_U_nser_ypcr_IAps5[j,]
    U_yser_ypcr_IAps[6,]<-  U_yser_ypcr_IAps[6,] + ser_U_nser_ypcr_IAps6[j,]
    U_yser_ypcr_IAps[7,]<-  U_yser_ypcr_IAps[7,] + ser_U_nser_ypcr_IAps7[j,]
    U_yser_ypcr_IAps[8,]<-  U_yser_ypcr_IAps[8,] + ser_U_nser_ypcr_IAps8[j,]
    U_yser_ypcr_IAps[9,]<-  U_yser_ypcr_IAps[9,] + ser_U_nser_ypcr_IAps9[j,]
    U_yser_ypcr_IAps[10,]<-  U_yser_ypcr_IAps[10,] + ser_U_nser_ypcr_IAps10[j,]
    U_yser_ypcr_IAps[11,]<-  U_yser_ypcr_IAps[11,] + ser_U_nser_ypcr_IAps11[j,]
    U_yser_ypcr_IAps[12,]<-  U_yser_ypcr_IAps[12,] + ser_U_nser_ypcr_IAps12[j,]
    U_yser_ypcr_WAps<-  U_yser_ypcr_WAps + ser_U_nser_ypcr_WAps[j,]
    
  

#### Part J) Serology results ####
    
    #Asymptomatic seropositives: S/V/IAns/WAns = FP, RAns = TP
    #(assuming someone who has previously had COVID symptoms would be taken as a symptomatic case, so RAps = symptomatic seroconversion) 
     cum_asym_U_ser[j]<- sum(ser_U_nser_npcr_S[j,])+sum(ser_U_nser_npcr_IAns1[j,])+sum(ser_U_nser_npcr_IAns2[j,])+sum(ser_U_nser_npcr_IAns3[j,])+sum(ser_U_nser_npcr_IAns4[j,])+sum(ser_U_nser_npcr_IAns5[j,])+sum(ser_U_nser_npcr_IAns6[j,])+sum(ser_U_nser_npcr_IAns7[j,])+sum(ser_U_nser_npcr_IAns8[j,])+sum(ser_U_nser_npcr_IAns9[j,])+sum(ser_U_nser_npcr_IAns10[j,])+sum(ser_U_nser_npcr_IAns11[j,])+sum(ser_U_nser_npcr_IAns12[j,])+sum(ser_U_nser_npcr_RAns[j,])+sum(ser_U_nser_npcr_WAns[j,])+
                     sum(ser_U_nser_ypcr_S[j,])+sum(ser_U_nser_ypcr_IAns1[j,])+sum(ser_U_nser_ypcr_IAns2[j,])+sum(ser_U_nser_ypcr_IAns3[j,])+sum(ser_U_nser_ypcr_IAns4[j,])+sum(ser_U_nser_ypcr_IAns5[j,])+sum(ser_U_nser_ypcr_IAns6[j,])+sum(ser_U_nser_ypcr_IAns7[j,])+sum(ser_U_nser_ypcr_IAns8[j,])+sum(ser_U_nser_ypcr_IAns9[j,])+sum(ser_U_nser_ypcr_IAns10[j,])+sum(ser_U_nser_ypcr_IAns11[j,])+sum(ser_U_nser_ypcr_IAns12[j,])+sum(ser_U_nser_ypcr_RAns[j,])+sum(ser_U_nser_ypcr_WAns[j,])
    
     cum_asym_V_ser[j]<- sum(ser_V_nser_npcr_V[j,])+sum(ser_V_nser_npcr_S[j,])+sum(ser_V_nser_npcr_IAns1[j,])+sum(ser_V_nser_npcr_IAns2[j,])+sum(ser_V_nser_npcr_IAns3[j,])+sum(ser_V_nser_npcr_IAns4[j,])+sum(ser_V_nser_npcr_IAns5[j,])+sum(ser_V_nser_npcr_IAns6[j,])+sum(ser_V_nser_npcr_IAns7[j,])+sum(ser_V_nser_npcr_IAns8[j,])+sum(ser_V_nser_npcr_IAns9[j,])+sum(ser_V_nser_npcr_IAns10[j,])+sum(ser_V_nser_npcr_IAns11[j,])+sum(ser_V_nser_npcr_IAns12[j,])+sum(ser_V_nser_npcr_RAns[j,])+sum(ser_V_nser_npcr_WAns[j,])+
                     sum(ser_V_nser_ypcr_V[j,])+sum(ser_V_nser_ypcr_S[j,])+sum(ser_V_nser_ypcr_IAns1[j,])+sum(ser_V_nser_ypcr_IAns2[j,])+sum(ser_V_nser_ypcr_IAns3[j,])+sum(ser_V_nser_ypcr_IAns4[j,])+sum(ser_V_nser_ypcr_IAns5[j,])+sum(ser_V_nser_ypcr_IAns6[j,])+sum(ser_V_nser_ypcr_IAns7[j,])+sum(ser_V_nser_ypcr_IAns8[j,])+sum(ser_V_nser_ypcr_IAns9[j,])+sum(ser_V_nser_ypcr_IAns10[j,])+sum(ser_V_nser_ypcr_IAns11[j,])+sum(ser_V_nser_ypcr_IAns12[j,])+sum(ser_V_nser_ypcr_RAns[j,])+sum(ser_V_nser_ypcr_WAns[j,])
       
    #Symptomatic seropositives: IS/WS/IAps/WAps = FP, RS/RAps = TP
    cum_sym_U_ser[j]<- sum(ser_U_nser_npcr_IS1[j,])+sum(ser_U_nser_npcr_IS2[j,])+sum(ser_U_nser_npcr_IS3[j,])+sum(ser_U_nser_npcr_IS4[j,])+sum(ser_U_nser_npcr_IS5[j,])+sum(ser_U_nser_npcr_IS6[j,])+sum(ser_U_nser_npcr_IS7[j,])+sum(ser_U_nser_npcr_IS8[j,])+sum(ser_U_nser_npcr_IS9[j,])+sum(ser_U_nser_npcr_IS10[j,])+sum(ser_U_nser_npcr_IS11[j,])+sum(ser_U_nser_npcr_IS12[j,])+sum(ser_U_nser_npcr_RS[j,])+sum(ser_U_nser_npcr_WS[j,])+sum(ser_U_nser_npcr_IAps1[j,])+sum(ser_U_nser_npcr_IAps2[j,])+sum(ser_U_nser_npcr_IAps3[j,])+sum(ser_U_nser_npcr_IAps4[j,])+sum(ser_U_nser_npcr_IAps5[j,])+sum(ser_U_nser_npcr_IAps6[j,])+sum(ser_U_nser_npcr_IAps7[j,])+sum(ser_U_nser_npcr_IAps8[j,])+sum(ser_U_nser_npcr_IAps9[j,])+sum(ser_U_nser_npcr_IAps10[j,])+sum(ser_U_nser_npcr_IAps11[j,])+sum(ser_U_nser_npcr_IAps12[j,])+sum(ser_U_nser_npcr_RAps[j,])+sum(ser_U_nser_npcr_WAps[j,])+
      sum(ser_U_nser_ypcr_IS1[j,])+sum(ser_U_nser_ypcr_IS2[j,])+sum(ser_U_nser_ypcr_IS3[j,])+sum(ser_U_nser_ypcr_IS4[j,])+sum(ser_U_nser_ypcr_IS5[j,])+sum(ser_U_nser_ypcr_IS6[j,])+sum(ser_U_nser_ypcr_IS7[j,])+sum(ser_U_nser_ypcr_IS8[j,])+sum(ser_U_nser_ypcr_IS9[j,])+sum(ser_U_nser_ypcr_IS10[j,])+sum(ser_U_nser_ypcr_IS11[j,])+sum(ser_U_nser_ypcr_IS12[j,])+sum(ser_U_nser_ypcr_RS[j,])+sum(ser_U_nser_ypcr_WS[j,])+sum(ser_U_nser_ypcr_IAps1[j,])+sum(ser_U_nser_ypcr_IAps2[j,])+sum(ser_U_nser_ypcr_IAps3[j,])+sum(ser_U_nser_ypcr_IAps4[j,])+sum(ser_U_nser_ypcr_IAps5[j,])+sum(ser_U_nser_ypcr_IAps6[j,])+sum(ser_U_nser_ypcr_IAps7[j,])+sum(ser_U_nser_ypcr_IAps8[j,])+sum(ser_U_nser_ypcr_IAps9[j,])+sum(ser_U_nser_ypcr_IAps10[j,])+sum(ser_U_nser_ypcr_IAps11[j,])+sum(ser_U_nser_ypcr_IAps12[j,])+sum(ser_U_nser_ypcr_RAps[j,])+sum(ser_U_nser_ypcr_WAps[j,])
  
    cum_sym_V_ser[j]<- sum(ser_V_nser_npcr_IS1[j,])+sum(ser_V_nser_npcr_IS2[j,])+sum(ser_V_nser_npcr_IS3[j,])+sum(ser_V_nser_npcr_IS4[j,])+sum(ser_V_nser_npcr_IS5[j,])+sum(ser_V_nser_npcr_IS6[j,])+sum(ser_V_nser_npcr_IS7[j,])+sum(ser_V_nser_npcr_IS8[j,])+sum(ser_V_nser_npcr_IS9[j,])+sum(ser_V_nser_npcr_IS10[j,])+sum(ser_V_nser_npcr_IS11[j,])+sum(ser_V_nser_npcr_IS12[j,])+sum(ser_V_nser_npcr_RS[j,])+sum(ser_V_nser_npcr_WS[j,])+sum(ser_V_nser_npcr_IAps1[j,])+sum(ser_V_nser_npcr_IAps2[j,])+sum(ser_V_nser_npcr_IAps3[j,])+sum(ser_V_nser_npcr_IAps4[j,])+sum(ser_V_nser_npcr_IAps5[j,])+sum(ser_V_nser_npcr_IAps6[j,])+sum(ser_V_nser_npcr_IAps7[j,])+sum(ser_V_nser_npcr_IAps8[j,])+sum(ser_V_nser_npcr_IAps9[j,])+sum(ser_V_nser_npcr_IAps10[j,])+sum(ser_V_nser_npcr_IAps11[j,])+sum(ser_V_nser_npcr_IAps12[j,])+sum(ser_V_nser_npcr_RAps[j,])+sum(ser_V_nser_npcr_WAps[j,])+
      sum(ser_V_nser_ypcr_IS1[j,])+sum(ser_V_nser_ypcr_IS2[j,])+sum(ser_V_nser_ypcr_IS3[j,])+sum(ser_V_nser_ypcr_IS4[j,])+sum(ser_V_nser_ypcr_IS5[j,])+sum(ser_V_nser_ypcr_IS6[j,])+sum(ser_V_nser_ypcr_IS7[j,])+sum(ser_V_nser_ypcr_IS8[j,])+sum(ser_V_nser_ypcr_IS9[j,])+sum(ser_V_nser_ypcr_IS10[j,])+sum(ser_V_nser_ypcr_IS11[j,])+sum(ser_V_nser_ypcr_IS12[j,])+sum(ser_V_nser_ypcr_RS[j,])+sum(ser_V_nser_ypcr_WS[j,])+sum(ser_V_nser_ypcr_IAps1[j,])+sum(ser_V_nser_ypcr_IAps2[j,])+sum(ser_V_nser_ypcr_IAps3[j,])+sum(ser_V_nser_ypcr_IAps4[j,])+sum(ser_V_nser_ypcr_IAps5[j,])+sum(ser_V_nser_ypcr_IAps6[j,])+sum(ser_V_nser_ypcr_IAps7[j,])+sum(ser_V_nser_ypcr_IAps8[j,])+sum(ser_V_nser_ypcr_IAps9[j,])+sum(ser_V_nser_ypcr_IAps10[j,])+sum(ser_V_nser_ypcr_IAps11[j,])+sum(ser_V_nser_ypcr_IAps12[j,])+sum(ser_V_nser_ypcr_RAps[j,])+sum(ser_V_nser_ypcr_WAps[j,])
      
    
    #All seropositives
    cum_inf_U_ser[j] <- cum_asym_U_ser[j] + cum_sym_U_ser[j]#total placebo
    cum_inf_V_ser[j] <- cum_asym_V_ser[j] + cum_sym_V_ser[j]#total vaccine

    #Seropositives as proportions (proportion who seroconvert in that time interval)
    sero.prop_U[j] <- cum_inf_U_ser[j]/(n*(1-pv)*rho)#total
    sero.prop_V[j] <- cum_inf_V_ser[j]/(n*pv*rho)
    
    sero.prop.sym_U[j] <- cum_sym_U_ser[j]/(n*(1-pv)*rho)#symp
    sero.prop.sym_V[j] <- cum_sym_V_ser[j]/(n*pv*rho)
    
    sero.prop.asym_U[j] <- cum_asym_U_ser[j]/(n*(1-pv)*rho)#asymp
    sero.prop.asym_V[j] <- cum_asym_V_ser[j]/(n*pv*rho)
    
    #VE and CI 
    #inf
    VE_sero_res1<- 1-ratesci::scoreci(cum_inf_V_ser[j],(n*pv*rho),cum_inf_U_ser[j],(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)] #VE incidence (just this time interval)
    VE_sero_res2<- 1-ratesci::scoreci(sum(cum_inf_V_ser[1:j]),(n*pv*rho),sum(cum_inf_U_ser[1:j]),(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)] #VE cumulative incidence (all prior intervals)

    #asym
    VE_sero_asym_res1<- 1-ratesci::scoreci(cum_asym_V_ser[j],(n*pv*rho),cum_asym_U_ser[j],(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]
    VE_sero_asym_res2<- 1-ratesci::scoreci(sum(cum_asym_V_ser[1:j]),(n*pv*rho),sum(cum_asym_U_ser[1:j]),(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)] 

    #sym
    VE_sero_sym_res1<- 1-ratesci::scoreci(cum_sym_V_ser[j],(n*pv*rho),cum_sym_U_ser[j],(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)]
    VE_sero_sym_res2<- 1-ratesci::scoreci(sum(cum_sym_V_ser[1:j]),(n*pv*rho),sum(cum_sym_U_ser[1:j]),(n*(1-pv)*rho), contrast = "RR", distrib = "bin", skew = FALSE)$estimates[c(2,3,1)] 

#### Part K) Collate model results ####
 
## (1) Incidence results ##
    
    ### True ###
    #1) Primary outcome: number, incidence rate and VE of 1st case of symptomatic COVID.
    
    #a: First symptomatic infection (even if had an asym previously) (how it's measured in the trials)
    model_output_1a <- c(cum_sym_V_first[j], cum_sym_U_first[j], (cum_sym_V_first[j]/first_sym_pt_V[j])*100, (cum_sym_U_first[j]/first_sym_pt_U[j])*100, VE_firstsym_res1[1], VE_firstsym_res1[2], VE_firstsym_res1[3])#7 (7)
    colnam1a<- c("Num. first symptom s-ve (vaccine)", "Num. first symptom s-ve (placebo)", "First Symp. incidence s-ve (vaccine)", "First Symp. incidence s-ve (placebo)", "VE sym IRR s-ve (first case)", "VE sym IRR s-ve (first case) LCI", "VE sym IRR s-ve (first case) UCI")
    
    #b: First infection that is symptomatic (people who have already been infected asymptomatically don't count) (this VE should be accurate)
    model_output_1b <- c(cum_sym_V_first2[j], cum_sym_U_first2[j], (cum_sym_V_first2[j]/first_inf_pt_V[j])*100, (cum_sym_U_first[j]/first_inf_pt_U[j])*100, VE_firstsym2_res1[1], VE_firstsym2_res1[2], VE_firstsym2_res1[3])#7 (14)
    colnam1b<- c("Num. first symptom s-ve (vaccine) 2", "Num. first symptom s-ve (placebo) 2", "First Symp. incidence s-ve (vaccine) 2", "First Symp. incidence s-ve (placebo) 2", "VE sym IRR s-ve (first case) 2", "VE sym IRR s-ve (first case) 2 LCI", "VE sym IRR s-ve (first case) 2 UCI")
    
    #2) Number, incidence rate and VE of 1st asymptomatic infection
    
    #a: First asymptomatic infection (even if had a sym previously) (how it's measured in the trials)
    model_output_2a <- c(cum_asym_V_first[j], cum_asym_U_first[j], (cum_asym_V_first[j]/first_asym_pt_V[j])*100 , (cum_asym_U_first[j]/first_asym_pt_U[j])*100, VE_firstasym_res1[1], VE_firstasym_res1[2], VE_firstasym_res1[3])#7 (21)
    colnam2a<- c("Num. first asym. in s-ve (vaccine)", "Num. first asym. in s-ve (placebo)", "First asym. incidence in s-ve (vaccine)", "First asym. incidence in s-ve (placebo)", "VE asym IRR s-ve (first case)", "VE asym IRR s-ve (first case) LCI", "VE asym IRR s-ve (first case) UCI")
    
    #b: First infection that is asymptomatic (people who have already been infected symptomatically don't count) (this VE should be accurate)
    model_output_2b <- c(cum_asym_V_first2[j], cum_asym_U_first2[j], (cum_asym_V_first2[j]/first_inf_pt_V[j])*100 , (cum_asym_U_first[j]/first_inf_pt_U[j])*100, VE_firstasym2_res1[1], VE_firstasym2_res1[2], VE_firstasym2_res1[3])#7 (28)
    colnam2b<- c("Num. first asym. in s-ve (vaccine) 2", "Num. first asym. in s-ve (placebo) 2", "First asym. incidence in s-ve (vaccine) 2", "First asym. incidence in s-ve (placebo) 2", "VE asym IRR s-ve (first case) 2", "VE asym IRR s-ve (first case) 2 LCI", "VE asym IRR s-ve (first case) 2 UCI")

    #3) Number, incidence rate and VE of 1st infection
    model_output_3 <- c(cum_inf_V_first[j], cum_inf_U_first[j], (cum_inf_V_first[j]/first_inf_pt_V[j])*100, (cum_inf_U_first[j]/first_inf_pt_U[j])*100, VE_firstinf_res1[1], VE_firstinf_res1[2], VE_firstinf_res1[3])#7 (35)
    colnam3<- c("Num. first infection in s-ve (vaccine)", "Num. first infection in s-ve (placebo)", "First infection incidence in s-ve (vaccine)", "First infection incidence in s-ve (placebo)", "VE inf IRR s-ve (first case)", "VE inf IRR s-ve (first case) LCI", "VE inf IRR s-ve (first case) UCI")                  
            
    #4) Risk ratio outcomes: Cumulative proportion infected/asymptomatic/symptomatic, and VE.
    model_output_4 <- c(cum_inf_V_first[j]/(n*pv*rho), cum_inf_U_first[j]/(n*pv*rho), VE_RR_inf_res1[1], VE_RR_inf_res1[2], VE_RR_inf_res1[3], cum_asym_V_first[j]/(n*pv*rho), cum_asym_U_first[j]/(n*(1-pv)*rho), VE_RR_asym_res1[1], VE_RR_asym_res1[2], VE_RR_asym_res1[3], cum_sym_V_first[j]/(n*pv*rho), cum_sym_U_first[j]/(n*(1-pv)*rho), VE_RR_sym_res1[1], VE_RR_sym_res1[2], VE_RR_sym_res1[3])#15 (50)
    colnam4<- c("Prop. infection in s-ve (vaccine)", "Prop. infection in s-ve (placebo)", "VE inf RR s-ve","VE inf RR s-ve LCI", "VE inf RR s-ve UCI", "Prop. asym. in s-ve (vaccine)", "Prop. asym. in s-ve (placebo)", "VE asym RR s-ve", "VE asym RR s-ve LCI", "VE asym RR s-ve UCI", "Prop. sym. in s-ve (vaccine)", "Prop. sym. in s-ve (placebo)", "VE sym RR s-ve", "VE sym RR s-ve LCI", "VE sym RR s-ve UCI")
    
    #5) Total number of symptomatic, asymptomatic, and overall infections
    model_output_5 <- c(sum(cum_inf_V[j]), sum(cum_inf_U[j]), sum(cum_asym_V[j]), sum(cum_asym_U[j]), sum(cum_sym_V[j]), sum(cum_sym_U[j]))#6 (56)
    colnam5<- c("Total infections (vaccine)", "Total infections (placebo)", "Total asym (vaccine)", "Total asym (placebo)", "Total sym (vaccine)", "Total sym (placebo)")
    
    #6) Total incidence rate of symptomatic, asymptomatic, and overall infections
    model_output_6 <- c(sum(cum_inf_V[j]), sum(cum_inf_U[j]), sum(cum_asym_V[j]), sum(cum_asym_U[j]), sum(cum_sym_V[j]), sum(cum_sym_U[j]))*100/pers_years[j]#6 (62)
    colnam6<- c("Total infection incidence (vaccine)", "Total infection incidence (placebo)", "Total asym incidence (vaccine)", "Total asym incidence (placebo)", "Total sym incidence (vaccine)", "Total sym incidence (placebo)")
    
    ### Serology ###
    
    #7) Seroprevalence risk ratio outcomes: cumulative number seroconverted, proportion seroconverted, and VE (inf/asym/sym)
    
    model_output_7 <- c(cum_inf_V_ser[j], cum_inf_U_ser[j], sero.prop_V[j], sero.prop_U[j], VE_sero_res1[1], VE_sero_res1[2], VE_sero_res1[2], 
                         cum_asym_V_ser[j], cum_asym_U_ser[j], sero.prop.asym_V[j], sero.prop.asym_U[j], VE_sero_asym_res1[1], VE_sero_asym_res1[2], VE_sero_asym_res1[3], 
                        cum_sym_V_ser[j], cum_sym_U_ser[j], sero.prop.sym_V[j], sero.prop.sym_U[j], VE_sero_sym_res1[1], VE_sero_sym_res1[2], VE_sero_sym_res1[3])#21 (83)
    colnam7<- c("Num. seroconversions s-ve (vaccine)", "Num. seroconversions s-ve (placebo)","Prop. seroconvert s-ve (vaccine)", "Prop. seroconvert s-ve (placebo)", "VE serocon", "VE serocon LCI", "VE serocon UCI", 
                "Num. seroconversions asym. s-ve (vaccine)", "Num. seroconversions asym. s-ve (placebo)", "Prop. seroconvert asymp. s-ve (vaccine)", "Prop. seroconvert asymp. s-ve (placebo)", "VE asymp. serocon", "VE asymp. serocon LCI", "VE asymp. serocon UCI", 
                "Num. seroconversions sym. s-ve (vaccine)", "Num. seroconversions sym. s-ve (placebo)", "Prop. seroconvert symp. s-ve (vaccine)", "Prop. seroconvert symp. s-ve (placebo)", "VE symp. serocon", "VE symp. serocon LCI", "VE symp. serocon UCI")#incidence results: proportion who seroconvert in that time interval, cumulative inc results, all seroconversions up to then

    ### PCR ###
    #8) Number, incidence rate and VE of 1st PCR-detected asymptomatic infection
    
    #a: First PCR-detected asymptomatic infection (even if had a sym previously) (how it's measured in the trials)
    model_output_8a <- c(cum_pcr_asym_V_first[j], cum_pcr_asym_U_first[j], (cum_pcr_asym_V_first[j]/first_asym_PCR_pt_V[j])*100 , (cum_pcr_asym_U_first[j]/first_asym_PCR_pt_U[j])*100, VE_firstasymPCR_res1[1], VE_firstasymPCR_res1[2], VE_firstasymPCR_res1[3])#7 (90)
    colnam8a<- c("Num. first PCR asym s-ve (vaccine)", "Num. first PCR asym s-ve (placebo)", "First PCR asym. incidence in s-ve (vaccine)", "First PCR asym. incidence in s-ve (placebo)", "VE asym PCR IRR (first case)", "VE asym PCR IRR (first case) LCI", "VE asym PCR IRR (first case) UCI")
    
    #b: First PCR-detected infection that is asymptomatic (people who have already been infected symptomatically don't count) (this VE should be accurate)
    model_output_8b <- c(cum_pcr_asym_V_first2[j], cum_pcr_asym_U_first2[j], (cum_pcr_asym_V_first2[j]/first_inf_PCR_pt_V[j])*100 , (cum_pcr_asym_U_first2[j]/first_inf_PCR_pt_U[j])*100, VE_firstasymPCR2_res1[1], VE_firstasymPCR2_res1[2], VE_firstasymPCR2_res1[3])#7 (97)
    colnam8b<- c("Num. first PCR asym s-ve (vaccine) 2", "Num. first PCR asym s-ve (placebo) 2", "First PCR asym. incidence in s-ve (vaccine) 2", "First PCR asym. incidence in s-ve (placebo) 2", "VE asym PCR IRR (first case) 2", "VE asym PCR IRR (first case) 2 LCI", "VE asym PCR IRR (first case) 2 UCI")
    
    #9) Number, incidence rate and VE of 1st PCR-detected infection
    model_output_9 <- c(cum_pcr_inf_V_first[j], cum_pcr_inf_U_first[j], (cum_pcr_inf_V_first[j]/first_inf_PCR_pt_V[j])*100 , (cum_pcr_inf_U_first[j]/first_inf_PCR_pt_U[j])*100, VE_firstinfPCR_res1[1], VE_firstinfPCR_res1[2], VE_firstinfPCR_res1[3])#7 (104)
    colnam9<- c("Num. first PCR s-ve (vaccine) 2", "Num. first PCR s-ve (placebo) 2", "First PCR incidence in s-ve (vaccine) 2", "First PCR incidence in s-ve (placebo) 2", "VE inf PCR IRR (first case)", "VE inf PCR IRR (first case) LCI", "VE inf PCR IRR (first case) UCI")
    
    #10) PCR risk ratio outcomes: asym/inf VE.
    model_output_10 <- c(VE_RR_asym_pcr_res1[1], VE_RR_asym_pcr_res1[2], VE_RR_asym_pcr_res1[3], VE_RR_inf_pcr_res1[1], VE_RR_inf_pcr_res1[2], VE_RR_inf_pcr_res1[3])#6 (110)

    colnam10<- c("VE asym PCR 1-RR","VE asym PCR 1-RR LCI","VE asym PCR 1-RR UCI",
                "VE inf PCR 1-RR","VE inf PCR 1-RR LCI","VE inf PCR 1-RR UCI")
    
## (2) Cumulative incidence results ##
    #(same as above, in same order)
    model_output_1a.c <- c(sum(cum_sym_V_first[1:j]), sum(cum_sym_U_first[1:j]), (sum(cum_sym_V_first[1:j])/sum(first_sym_pt_V[1:j]))*100, (sum(cum_sym_U_first[1:j])/sum(first_sym_pt_U[1:j]))*100, VE_firstsym_res2[1], VE_firstsym_res2[2], VE_firstsym_res2[3])#7 (7)
    model_output_1b.c <- c(sum(cum_sym_V_first2[1:j]), sum(cum_sym_U_first2[1:j]), (sum(cum_sym_V_first2[1:j])/sum(first_inf_pt_V[1:j]))*100, (sum(cum_sym_U_first[1:j])/sum(first_inf_pt_U[1:j]))*100, VE_firstsym2_res2[1], VE_firstsym2_res2[2], VE_firstsym2_res2[3])#7 (14)
    model_output_2a.c <- c(sum(cum_asym_V_first[1:j]), sum(cum_asym_U_first[1:j]), (sum(cum_asym_V_first[1:j])/sum(first_asym_pt_V[1:j]))*100 , (sum(cum_asym_U_first[1:j])/sum(first_asym_pt_U[1:j]))*100, VE_firstasym_res2[1], VE_firstasym_res2[2], VE_firstasym_res2[3])#7 (21)
    model_output_2b.c <- c(sum(cum_asym_V_first2[1:j]), sum(cum_asym_U_first2[1:j]), (sum(cum_asym_V_first2[1:j])/sum(first_inf_pt_V[1:j]))*100 , (sum(cum_asym_U_first[1:j])/sum(first_inf_pt_U[1:j]))*100, VE_firstasym2_res2[1], VE_firstasym2_res2[2], VE_firstasym2_res2[3])#7 (28)
    model_output_3.c <- c(sum(cum_inf_V_first[1:j]), sum(cum_inf_U_first[1:j]), (sum(cum_inf_V_first[1:j])/sum(first_inf_pt_V[1:j]))*100, (sum(cum_inf_U_first[1:j])/sum(first_inf_pt_U[1:j]))*100, VE_firstinf_res2[1], VE_firstinf_res2[2], VE_firstinf_res2[3])#7 (35)
    model_output_4.c <- c(sum(cum_inf_V_first[1:j])/(n*pv*rho), sum(cum_inf_U_first[1:j])/(n*pv*rho), VE_RR_inf_res2[1], VE_RR_inf_res2[2], VE_RR_inf_res2[3], sum(cum_asym_V_first[1:j])/(n*pv*rho), sum(cum_asym_U_first[1:j])/(n*(1-pv)*rho), VE_RR_asym_res2[1], VE_RR_asym_res2[2], VE_RR_asym_res2[3], sum(cum_sym_V_first[1:j])/(n*pv*rho), sum(cum_sym_U_first[1:j])/(n*(1-pv)*rho), VE_RR_sym_res2[1], VE_RR_sym_res2[2], VE_RR_sym_res2[3])#15 (50)
    model_output_5.c <- c(sum(cum_inf_V[1:j]), sum(cum_inf_U[1:j]), sum(cum_asym_V[1:j]), sum(cum_asym_U[1:j]), sum(cum_sym_V[1:j]), sum(cum_sym_U[1:j]))#6 (56)
    model_output_6.c <- c(sum(cum_inf_V[1:j]), sum(cum_inf_U[1:j]), sum(cum_asym_V[1:j]), sum(cum_asym_U[1:j]), sum(cum_sym_V[1:j]), sum(cum_sym_U[1:j]))*100/sum(pers_years[1:j])#6 (62)
    model_output_7.c <- c(sum(cum_inf_V_ser[1:j]), sum(cum_inf_U_ser[1:j]), sum(sero.prop_V[1:j]), sum(sero.prop_U[1:j]), VE_sero_res2[1], VE_sero_res2[2], VE_sero_res2[2], sum(cum_asym_V_ser[1:j]), sum(cum_asym_U_ser[1:j]), sum(sero.prop.asym_V[1:j]), sum(sero.prop.asym_U[1:j]), VE_sero_asym_res2[1], VE_sero_asym_res2[2], VE_sero_asym_res2[3], sum(cum_sym_V_ser[1:j]), sum(cum_sym_U_ser[1:j]), sum(sero.prop.sym_V[1:j]), sum(sero.prop.sym_U[1:j]), VE_sero_sym_res2[1], VE_sero_sym_res2[2], VE_sero_sym_res2[3])
    model_output_8a.c <- c(sum(cum_pcr_asym_V_first[1:j]), sum(cum_pcr_asym_U_first[1:j]), (sum(cum_pcr_asym_V_first[1:j])/sum(first_asym_PCR_pt_V[1:j]))*100 , (sum(cum_pcr_asym_U_first[1:j])/sum(first_asym_PCR_pt_U[1:j]))*100, VE_firstasymPCR_res2[1], VE_firstasymPCR_res2[2], VE_firstasymPCR_res2[3])#7 (90)
    model_output_8b.c <- c(sum(cum_pcr_asym_V_first2[1:j]), sum(cum_pcr_asym_U_first2[1:j]), (sum(cum_pcr_asym_V_first2[1:j])/sum(first_inf_PCR_pt_V[1:j]))*100 , (sum(cum_pcr_asym_U_first2[1:j])/sum(first_inf_PCR_pt_U[1:j]))*100, VE_firstasymPCR2_res2[1], VE_firstasymPCR2_res2[2], VE_firstasymPCR2_res2[3])#7 (97)
    model_output_9.c <- c(sum(cum_pcr_inf_V_first[1:j]), sum(cum_pcr_inf_U_first[1:j]), (sum(cum_pcr_inf_V_first[1:j])/sum(first_inf_PCR_pt_V[1:j]))*100 , (sum(cum_pcr_inf_U_first[1:j])/sum(first_inf_PCR_pt_U[1:j]))*100, VE_firstinfPCR_res2[1], VE_firstinfPCR_res2[2], VE_firstinfPCR_res2[3])#7 (104)
    model_output_10.c <- c(VE_RR_asym_pcr_res2[1], VE_RR_asym_pcr_res2[2], VE_RR_asym_pcr_res2[3], VE_RR_inf_pcr_res2[1], VE_RR_inf_pcr_res2[2], VE_RR_inf_pcr_res2[3])#6 (110)
    
    #store model results
    
    res[j,]<-c(model_output_1a, model_output_1b, model_output_2a, model_output_2b, model_output_3, model_output_4, model_output_5, model_output_6, model_output_7, model_output_8a, model_output_8b, model_output_9, model_output_10)
    res2[j,]<- c(model_output_1a.c, model_output_1b.c, model_output_2a.c, model_output_2b.c, model_output_3.c, model_output_4.c, model_output_5.c, model_output_6.c, model_output_7.c, model_output_8a.c, model_output_8b.c, model_output_9.c, model_output_10.c)  
    
    j<-j+1 #move onto next time interval
    
  }

  #add col and row names
  colnames(res)<-colnames(res2)<-c(colnam1a, colnam1b, colnam2a, colnam2b, colnam3, colnam4, colnam5, colnam6, colnam7, colnam8a, colnam8b, colnam9, colnam10)
      
  #rownames(res)<-rownames(res2)<-c("Month 1", "Month 2", "Month 6", "Month 12", "Month 24")
  #return model results 
  return(list(res, res2))
}
```

```{r run model, eval=F, message=FALSE}
model_run()
```

```{r colnames }
colnam<- c("Num. first symptom s-ve (vaccine)", "Num. first symptom s-ve (placebo)", "First Symp. incidence s-ve (vaccine)", "First Symp. incidence s-ve (placebo)", "VE sym IRR s-ve (first case)", "VE sym IRR s-ve (first case) LCI", "VE sym IRR s-ve (first case) UCI",
"Num. first symptom s-ve (vaccine) 2", "Num. first symptom s-ve (placebo) 2", "First Symp. incidence s-ve (vaccine) 2", "First Symp. incidence s-ve (placebo) 2", "VE sym IRR s-ve (first case) 2", "VE sym IRR s-ve (first case) 2 LCI", "VE sym IRR s-ve (first case) 2 UCI",
"Num. first asym. in s-ve (vaccine)", "Num. first asym. in s-ve (placebo)", "First asym. incidence in s-ve (vaccine)", "First asym. incidence in s-ve (placebo)", "VE asym IRR s-ve (first case)", "VE asym IRR s-ve (first case) LCI", "VE asym IRR s-ve (first case) UCI",
"Num. first asym. in s-ve (vaccine) 2", "Num. first asym. in s-ve (placebo) 2", "First asym. incidence in s-ve (vaccine) 2", "First asym. incidence in s-ve (placebo) 2", "VE asym IRR s-ve (first case) 2", "VE asym IRR s-ve (first case) 2 LCI", "VE asym IRR s-ve (first case) 2 UCI",
"Num. first infection in s-ve (vaccine)", "Num. first infection in s-ve (placebo)", "First infection incidence in s-ve (vaccine)", "First infection incidence in s-ve (placebo)", "VE inf IRR s-ve (first case)", "VE inf IRR s-ve (first case) LCI", "VE inf IRR s-ve (first case) UCI",
"Prop. infection in s-ve (vaccine)", "Prop. infection in s-ve (placebo)", "VE inf RR s-ve","VE inf RR s-ve LCI", "VE inf RR s-ve UCI", "Prop. asym. in s-ve (vaccine)", "Prop. asym. in s-ve (placebo)", "VE asym RR s-ve", "VE asym RR s-ve LCI", "VE asym RR s-ve UCI", "Prop. sym. in s-ve (vaccine)", "Prop. sym. in s-ve (placebo)", "VE sym RR s-ve", "VE sym RR s-ve LCI", "VE sym RR s-ve UCI",
"Total infections (vaccine)", "Total infections (placebo)", "Total asym (vaccine)", "Total asym (placebo)", "Total sym (vaccine)", "Total sym (placebo)",
"Total infection incidence (vaccine)", "Total infection incidence (placebo)", "Total asym incidence (vaccine)", "Total asym incidence (placebo)", "Total sym incidence (vaccine)", "Total sym incidence (placebo)",
"Num. seroconversions s-ve (vaccine)", "Num. seroconversions s-ve (placebo)","Prop. seroconvert s-ve (vaccine)", "Prop. seroconvert s-ve (placebo)", "VE serocon", "VE serocon LCI", "VE serocon UCI", 
"Num. seroconversions asym. s-ve (vaccine)", "Num. seroconversions asym. s-ve (placebo)", "Prop. seroconvert asymp. s-ve (vaccine)", "Prop. seroconvert asymp. s-ve (placebo)", "VE asymp. serocon", "VE asymp. serocon LCI", "VE asymp. serocon UCI", 
"Num. seroconversions sym. s-ve (vaccine)", "Num. seroconversions sym. s-ve (placebo)", "Prop. seroconvert symp. s-ve (vaccine)", "Prop. seroconvert symp. s-ve (placebo)", "VE symp. serocon", "VE symp. serocon LCI", "VE symp. serocon UCI",
"Num. first PCR asym s-ve (vaccine)", "Num. first PCR asym s-ve (placebo)", "First PCR asym. incidence in s-ve (vaccine)", "First PCR asym. incidence in s-ve (placebo)", "VE asym PCR IRR (first case)", "VE asym PCR IRR (first case) LCI", "VE asym PCR IRR (first case) UCI",
"Num. first PCR asym s-ve (vaccine) 2", "Num. first PCR asym s-ve (placebo) 2", "First PCR asym. incidence in s-ve (vaccine) 2", "First PCR asym. incidence in s-ve (placebo) 2", "VE asym PCR IRR (first case) 2", "VE asym PCR IRR (first case) 2 LCI", "VE asym PCR IRR (first case) 2 UCI",
"Num. first PCR s-ve (vaccine) 2", "Num. first PCR s-ve (placebo) 2", "First PCR incidence in s-ve (vaccine) 2", "First PCR incidence in s-ve (placebo) 2", "VE inf PCR IRR (first case)", "VE inf PCR IRR (first case) LCI", "VE inf PCR IRR (first case) UCI",
"VE asym PCR 1-RR","VE asym PCR 1-RR LCI","VE asym PCR 1-RR UCI","VE inf PCR 1-RR","VE inf PCR 1-RR LCI","VE inf PCR 1-RR UCI")
```
